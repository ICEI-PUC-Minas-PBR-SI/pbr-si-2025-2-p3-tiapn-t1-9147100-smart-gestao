
--- ðŸš€ [GLOBAL SETUP] Iniciando ambiente de teste ---
â³ Iniciando servidor Smart GestÃ£o (startServer)...
ConexÃ£o com o MongoDB estabelecida com sucesso.
âœ… [1/3] ConexÃ£o com o banco de dados estabelecida!
Verificando permissÃµes de sistema...
PermissÃµes de sistema jÃ¡ existem. Nenhuma aÃ§Ã£o necessÃ¡ria.
âœ… [2/3] PermissÃµes do sistema validadas/inicializadas.
âœ… [3/3] Servidor rodando na porta 5000
--- âœ… [GLOBAL SETUP] Ambiente pronto e servidor iniciado ---
(node:29184) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
POST /api/clients 201 37.749 ms - 326
[LOG] AÃ§Ã£o: CREATE_CLIENT | UsuÃ¡rio: 691688ce8fc29bed10811d6e
GET /api/clients 200 29.750 ms - 582
PUT /api/clients/691688cf8fc29bed10811d7e 200 49.831 ms - 357
[LOG] AÃ§Ã£o: UPDATE_CLIENT | UsuÃ¡rio: 691688ce8fc29bed10811d6e
DELETE /api/clients/691688cf8fc29bed10811d7e 200 43.264 ms - 70
GET /api/clients/691688cf8fc29bed10811d7e 404 2.033 ms - 175
[LOG] AÃ§Ã£o: DELETE_CLIENT | UsuÃ¡rio: 691688ce8fc29bed10811d6e
DELETE /api/clients/691688cf8fc29bed10811d7e 404 39.459 ms - 68
PASS Testes/2-features/clients.test.js
  7. MÃ³dulo de Clientes/Fornecedores
    âˆš deve CRIAR um novo cliente com sucesso (84 ms)
    âˆš deve LISTAR os clientes da empresa (35 ms)
    âˆš deve ATUALIZAR um cliente existente (56 ms)
    âˆš deve EXCLUIR um cliente existente (63 ms)

[LOG] AÃ§Ã£o: DELETE_CLIENT | UsuÃ¡rio: 691688ce8fc29bed10811d6e
[LOG] AÃ§Ã£o: CREATE_GOAL | UsuÃ¡rio: 691688ce8fc29bed10811d6e
POST /api/goals 201 46.536 ms - 404
GET /api/goals 200 26.127 ms - 406
[LOG] AÃ§Ã£o: UPDATE_GOAL | UsuÃ¡rio: 691688ce8fc29bed10811d6e
PUT /api/goals/691688cf8fc29bed10811d94 200 56.805 ms - 414
[LOG] AÃ§Ã£o: DELETE_GOAL | UsuÃ¡rio: 691688ce8fc29bed10811d6e
DELETE /api/goals/691688cf8fc29bed10811d94 200 57.057 ms - 67
GET /api/goals/691688cf8fc29bed10811d94 404 37.530 ms - 64
DELETE /api/goals/691688cf8fc29bed10811d94 404 37.157 ms - 64
PASS Testes/2-features/goals.test.js
  5. MÃ³dulo de Metas (CRUD)
    âˆš deve CRIAR uma nova meta com sucesso (62 ms)
    âˆš deve LISTAR as metas do usuÃ¡rio logado (29 ms)
    âˆš deve ATUALIZAR uma meta existente (62 ms)
    âˆš deve EXCLUIR uma meta existente (111 ms)

[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 691688ce8fc29bed10811d6e
POST /api/transactions 201 45.645 ms - 468
POST /api/transactions 400 24.572 ms - 277
[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 691688ce8fc29bed10811d6e
[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 691688ce8fc29bed10811d6e
GET /api/transactions 200 58.535 ms - 855
GET /api/transactions/691688d08fc29bed10811dab 200 40.793 ms - 452
[LOG] AÃ§Ã£o: UPDATE_TRANSACTION | UsuÃ¡rio: 691688ce8fc29bed10811d6e
PUT /api/transactions/691688d08fc29bed10811dab 200 59.773 ms - 452
[LOG] AÃ§Ã£o: UPDATE_TRANSACTION | UsuÃ¡rio: 691688ce8fc29bed10811d6e
[LOG] AÃ§Ã£o: DELETE_TRANSACTION | UsuÃ¡rio: 691688ce8fc29bed10811d6e
DELETE /api/transactions/691688d08fc29bed10811dab 200 61.614 ms - 73
[LOG] AÃ§Ã£o: DELETE_TRANSACTION | UsuÃ¡rio: 691688ce8fc29bed10811d6e
GET /api/transactions/691688d08fc29bed10811dab 404 37.497 ms - 71
DELETE /api/transactions/691688d08fc29bed10811dab 404 40.401 ms - 71
PASS Testes/2-features/transactions.test.js
  4. MÃ³dulo de TransaÃ§Ãµes (CRUD)
    âˆš deve CRIAR uma nova transaÃ§Ã£o com sucesso (60 ms)
    âˆš deve falhar ao tentar criar uma transaÃ§Ã£o com dados invÃ¡lidos (37 ms)
    âˆš deve LISTAR as transaÃ§Ãµes do usuÃ¡rio logado (67 ms)
    âˆš deve OBTER uma transaÃ§Ã£o especÃ­fica pelo ID (45 ms)
    âˆš deve ATUALIZAR uma transaÃ§Ã£o existente (64 ms)
    âˆš deve EXCLUIR uma transaÃ§Ã£o existente (105 ms)

[LOG] AÃ§Ã£o: DELETE_TRANSACTION | UsuÃ¡rio: 691688ce8fc29bed10811d6e
[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 691688ce8fc29bed10811d6e
POST /api/transactions 201 44.785 ms - 446
[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 691688ce8fc29bed10811d6e
POST /api/transactions/691688d08fc29bed10811dd1/upload 200 65.474 ms - 514
[LOG] AÃ§Ã£o: UPLOAD_ATTACHMENT | UsuÃ¡rio: 691688ce8fc29bed10811d6e
DELETE /api/transactions/691688d08fc29bed10811dd1/upload 200 53.372 ms - 442
[LOG] AÃ§Ã£o: DELETE_ATTACHMENT | UsuÃ¡rio: 691688ce8fc29bed10811d6e
[LOG] AÃ§Ã£o: DELETE_TRANSACTION | UsuÃ¡rio: 691688ce8fc29bed10811d6e
DELETE /api/transactions/691688d08fc29bed10811dd1 200 58.879 ms - 73
[LOG] AÃ§Ã£o: DELETE_TRANSACTION | UsuÃ¡rio: 691688ce8fc29bed10811d6e
[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 691688ce8fc29bed10811d6e
POST /api/transactions 201 46.104 ms - 444
[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 691688ce8fc29bed10811d6e
POST /api/transactions/691688d08fc29bed10811deb/upload 200 55.896 ms - 512
[LOG] AÃ§Ã£o: UPLOAD_ATTACHMENT | UsuÃ¡rio: 691688ce8fc29bed10811d6e
DELETE /api/transactions/691688d08fc29bed10811deb/upload 200 62.101 ms - 440
[LOG] AÃ§Ã£o: DELETE_ATTACHMENT | UsuÃ¡rio: 691688ce8fc29bed10811d6e
[LOG] AÃ§Ã£o: DELETE_TRANSACTION | UsuÃ¡rio: 691688ce8fc29bed10811d6e
DELETE /api/transactions/691688d08fc29bed10811deb 200 56.350 ms - 73
[LOG] AÃ§Ã£o: DELETE_TRANSACTION | UsuÃ¡rio: 691688ce8fc29bed10811d6e
[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 691688ce8fc29bed10811d6e
POST /api/transactions 201 46.175 ms - 444
[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 691688ce8fc29bed10811d6e
POST /api/transactions/691688d18fc29bed10811e05/upload 200 58.075 ms - 512
[LOG] AÃ§Ã£o: UPLOAD_ATTACHMENT | UsuÃ¡rio: 691688ce8fc29bed10811d6e
DELETE /api/transactions/691688d18fc29bed10811e05/upload 200 54.766 ms - 440
[LOG] AÃ§Ã£o: DELETE_ATTACHMENT | UsuÃ¡rio: 691688ce8fc29bed10811d6e
[LOG] AÃ§Ã£o: DELETE_TRANSACTION | UsuÃ¡rio: 691688ce8fc29bed10811d6e
DELETE /api/transactions/691688d18fc29bed10811e05 200 60.848 ms - 73
[LOG] AÃ§Ã£o: DELETE_TRANSACTION | UsuÃ¡rio: 691688ce8fc29bed10811d6e
[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 691688ce8fc29bed10811d6e
POST /api/transactions 201 46.826 ms - 445
[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 691688ce8fc29bed10811d6e
POST /api/transactions/691688d18fc29bed10811e1f/upload 200 57.653 ms - 514
[LOG] AÃ§Ã£o: UPLOAD_ATTACHMENT | UsuÃ¡rio: 691688ce8fc29bed10811d6e
DELETE /api/transactions/691688d18fc29bed10811e1f/upload 200 55.814 ms - 441
[LOG] AÃ§Ã£o: DELETE_ATTACHMENT | UsuÃ¡rio: 691688ce8fc29bed10811d6e
[LOG] AÃ§Ã£o: DELETE_TRANSACTION | UsuÃ¡rio: 691688ce8fc29bed10811d6e
DELETE /api/transactions/691688d18fc29bed10811e1f 200 58.561 ms - 73
[LOG] AÃ§Ã£o: DELETE_TRANSACTION | UsuÃ¡rio: 691688ce8fc29bed10811d6e
POST /api/transactions/60d5f1f77c3d4a001f5e8e1z/upload 500 17.075 ms - 368
FAIL Testes/2-features/uploads.test.js
  Feature: Uploads
    Upload de PDF
      âˆš Deve permitir o upload de um anexo (PDF) para uma transaÃ§Ã£o (77 ms)
      âˆš Deve permitir a exclusÃ£o de um anexo (PDF) de uma transaÃ§Ã£o (57 ms)
    Upload de Imagem (PNG)
      âˆš Deve permitir o upload de um anexo de imagem (.png) para uma transaÃ§Ã£o (61 ms)
      âˆš Deve permitir a exclusÃ£o de um anexo de imagem (.png) (66 ms)
    Upload de Imagem (JPG)
      âˆš Deve permitir o upload de um anexo de imagem (.jpg) para uma transaÃ§Ã£o (64 ms)
      âˆš Deve permitir a exclusÃ£o de um anexo de imagem (.jpg) (59 ms)
    Upload de Imagem (JPEG)
      âˆš Deve permitir o upload de um anexo de imagem (.jpeg) para uma transaÃ§Ã£o (63 ms)
      âˆš Deve permitir a exclusÃ£o de um anexo de imagem (.jpeg) (60 ms)
    CenÃ¡rios de Erro e Estruturais
      Ã— Deve retornar 404 ao tentar fazer upload para uma transaÃ§Ã£o inexistente (82 ms)

  â— Feature: Uploads â€º CenÃ¡rios de Erro e Estruturais â€º Deve retornar 404 ao tentar fazer upload para uma transaÃ§Ã£o inexistente

    expect(received).rejects.toThrow(expected)

    Expected substring: "Request failed with status code 404"
    Received message:   "Request failed with status code 500"

          180 |             form.append('attachment', fs.createReadStream(filePath));
          181 |
        > 182 |             await expect(
              |             ^
          183 |                 axios.post(
          184 |                     `${apiUrl}/transactions/${invalidId}/upload`,
          185 |                     form,

      at settle (node_modules/axios/lib/core/settle.js:19:12)
      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:793:11)
      at Axios.request (node_modules/axios/lib/core/Axios.js:45:41)
      at Object.<anonymous> (Testes/2-features/uploads.test.js:182:13)
      at Object.toThrow (node_modules/expect/build/index.js:2155:20)
      at Object.toThrow (Testes/2-features/uploads.test.js:188:23)

Test Suites: 1 failed, 3 passed, 4 total
Tests:       1 failed, 22 passed, 23 total
Snapshots:   0 total
Time:        3.205 s
Ran all test suites matching Testes/2-features/.

--- ðŸ§¹ [GLOBAL TEARDOWN] Finalizando ambiente de teste ---
[LOG] AÃ§Ã£o: UPLOAD_ATTACHMENT | UsuÃ¡rio: 691688ce8fc29bed10811d6e
   - [OK] Dados de teste temporÃ¡rios foram removidos.
âœ… Servidor e conexÃ£o com MongoDB encerrados (stopServer).
--- âœ… [GLOBAL TEARDOWN] Ambiente finalizado com sucesso ---

--- FIM DOS TESTES AUTOMATIZADOS (Status: Falha) ---
