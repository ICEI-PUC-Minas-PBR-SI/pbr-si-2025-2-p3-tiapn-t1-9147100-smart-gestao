
--- üöÄ [GLOBAL SETUP] Iniciando ambiente de teste ---
Verificando permiss√µes de sistema...
Permiss√µes de sistema j√° existem. Nenhuma a√ß√£o necess√°ria.
‚è≥ Iniciando servidor Smart Gest√£o (startServer)...
Conex√£o com o MongoDB estabelecida com sucesso.
‚úÖ [1/1] Conex√£o com o banco de dados estabelecida!
‚ö†Ô∏è  Aviso: Porta 5000 est√° em uso. Tentando porta 5001...
‚úÖ Servidor rodando na porta 5001
--- ‚úÖ [GLOBAL SETUP] Ambiente pronto e servidor iniciado ---
(node:6540) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
FAIL Testes/1-auth/auth.test.js
  6. M√≥dulo de Autentica√ß√£o e Sess√£o (Stateful)
    √ó deve criar um SessionToken no banco de dados ap√≥s o login (6 ms)
    √ó deve invalidar o SessionToken no banco de dados ap√≥s o logout

  ‚óè 6. M√≥dulo de Autentica√ß√£o e Sess√£o (Stateful) ‚Ä∫ deve criar um SessionToken no banco de dados ap√≥s o login

    TypeError: Invalid URL

      31 |    */
      32 |   test('deve criar um SessionToken no banco de dados ap√≥s o login', async () => {
    > 33 |     const loginResponse = await axios.post(`${API_URL}/auth/login`, {
         |                                       ^
      34 |       email: userA.email,
      35 |       password: userA.password,
      36 |     });

      at dispatchHttpRequest (node_modules/axios/lib/adapters/http.js:408:20)
      at node_modules/axios/lib/adapters/http.js:249:5
      at wrapAsync (node_modules/axios/lib/adapters/http.js:229:10)
      at http (node_modules/axios/lib/adapters/http.js:314:10)
      at Axios.dispatchRequest (node_modules/axios/lib/core/dispatchRequest.js:51:10)
      at Axios._request (node_modules/axios/lib/core/Axios.js:185:33)
      at Axios.request (node_modules/axios/lib/core/Axios.js:40:25)
      at Axios.httpMethod [as post] (node_modules/axios/lib/core/Axios.js:224:19)
      at Function.wrap (node_modules/axios/lib/helpers/bind.js:12:15)
      at Object.<anonymous> (Testes/1-auth/auth.test.js:33:39)

  ‚óè 6. M√≥dulo de Autentica√ß√£o e Sess√£o (Stateful) ‚Ä∫ deve invalidar o SessionToken no banco de dados ap√≥s o logout

    TypeError: Invalid URL

      49 |   test('deve invalidar o SessionToken no banco de dados ap√≥s o logout', async () => {
      50 |     // 1. Realiza o login para obter um refresh token v√°lido
    > 51 |     const loginResponse = await axios.post(`${API_URL}/auth/login`, {
         |                                       ^
      52 |       email: userA.email,
      53 |       password: userA.password,
      54 |     });

      at dispatchHttpRequest (node_modules/axios/lib/adapters/http.js:408:20)
      at node_modules/axios/lib/adapters/http.js:249:5
      at wrapAsync (node_modules/axios/lib/adapters/http.js:229:10)
      at http (node_modules/axios/lib/adapters/http.js:314:10)
      at Axios.dispatchRequest (node_modules/axios/lib/core/dispatchRequest.js:51:10)
      at Axios._request (node_modules/axios/lib/core/Axios.js:185:33)
      at Axios.request (node_modules/axios/lib/core/Axios.js:40:25)
      at Axios.httpMethod [as post] (node_modules/axios/lib/core/Axios.js:224:19)
      at Function.wrap (node_modules/axios/lib/helpers/bind.js:12:15)
      at Object.<anonymous> (Testes/1-auth/auth.test.js:51:39)

  console.log
    
    --- Teste: Solicitar reset para e-mail inv√°lido ---

      at Object.<anonymous> (Testes/1-auth/password.test.js:33:13)

  console.log
    
    --- Teste: Gerar token de reset com sucesso ---

      at Object.<anonymous> (Testes/1-auth/password.test.js:51:13)

  console.log
    
    --- Teste: Resetar senha com token v√°lido ---

      at Object.<anonymous> (Testes/1-auth/password.test.js:70:13)

FAIL Testes/1-auth/password.test.js
  9. M√≥dulo de Recupera√ß√£o de Senha
    √ó deve falhar ao solicitar reset para um e-mail inexistente (21 ms)
    √ó deve gerar e salvar um token de reset para um e-mail v√°lido (1 ms)
    √ó deve resetar a senha com um token v√°lido e permitir login com a nova senha (2 ms)

  ‚óè 9. M√≥dulo de Recupera√ß√£o de Senha ‚Ä∫ deve falhar ao solicitar reset para um e-mail inexistente

    TypeError: Cannot read properties of undefined (reading 'status')

      38 |       fail('A solicita√ß√£o de reset para um e-mail inv√°lido deveria ter falhado.');
      39 |     } catch (error) {
    > 40 |       expect(error.response.status).toBe(404);
         |                             ^
      41 |       expect(error.response.data.message).toBe('Usu√°rio n√£o encontrado.');
      42 |       console.log('‚úÖ Falhou como esperado para e-mail inexistente (Status 404).');
      43 |     }

      at Object.<anonymous> (Testes/1-auth/password.test.js:40:29)

  ‚óè 9. M√≥dulo de Recupera√ß√£o de Senha ‚Ä∫ deve gerar e salvar um token de reset para um e-mail v√°lido

    TypeError: Invalid URL

      50 |   test('deve gerar e salvar um token de reset para um e-mail v√°lido', async () => {
      51 |     console.log('\n--- Teste: Gerar token de reset com sucesso ---');
    > 52 |     const response = await axios.post(`${API_URL}/auth/forgot-password`, {
         |                                  ^
      53 |       email: userA.email,
      54 |     });
      55 |

      at dispatchHttpRequest (node_modules/axios/lib/adapters/http.js:408:20)
      at node_modules/axios/lib/adapters/http.js:249:5
      at wrapAsync (node_modules/axios/lib/adapters/http.js:229:10)
      at http (node_modules/axios/lib/adapters/http.js:314:10)
      at Axios.dispatchRequest (node_modules/axios/lib/core/dispatchRequest.js:51:10)
      at Axios._request (node_modules/axios/lib/core/Axios.js:185:33)
      at Axios.request (node_modules/axios/lib/core/Axios.js:40:25)
      at Axios.httpMethod [as post] (node_modules/axios/lib/core/Axios.js:224:19)
      at Function.wrap (node_modules/axios/lib/helpers/bind.js:12:15)
      at Object.<anonymous> (Testes/1-auth/password.test.js:52:34)

  ‚óè 9. M√≥dulo de Recupera√ß√£o de Senha ‚Ä∫ deve resetar a senha com um token v√°lido e permitir login com a nova senha

    TypeError: Invalid URL

      70 |     console.log('\n--- Teste: Resetar senha com token v√°lido ---');
      71 |     // 1. Solicitar o token
    > 72 |     const forgotResponse = await axios.post(`${API_URL}/auth/forgot-password`, {
         |                                        ^
      73 |       email: userA.email,
      74 |     });
      75 |     const { resetToken } = forgotResponse.data.data; // O token √© retornado para fins de teste

      at dispatchHttpRequest (node_modules/axios/lib/adapters/http.js:408:20)
      at node_modules/axios/lib/adapters/http.js:249:5
      at wrapAsync (node_modules/axios/lib/adapters/http.js:229:10)
      at http (node_modules/axios/lib/adapters/http.js:314:10)
      at Axios.dispatchRequest (node_modules/axios/lib/core/dispatchRequest.js:51:10)
      at Axios._request (node_modules/axios/lib/core/Axios.js:185:33)
      at Axios.request (node_modules/axios/lib/core/Axios.js:40:25)
      at Axios.httpMethod [as post] (node_modules/axios/lib/core/Axios.js:224:19)
      at Function.wrap (node_modules/axios/lib/helpers/bind.js:12:15)
      at Object.<anonymous> (Testes/1-auth/password.test.js:72:40)

PASS Testes/2-features/alerts.test.js
  6. M√≥dulo de Alertas de Metas
    ‚àö RF-006: deve criar um alerta quando uma despesa ultrapassa a meta da categoria (456 ms)

FAIL Testes/2-features/clients.test.js
  7. M√≥dulo de Clientes/Fornecedores
    √ó deve CRIAR um novo cliente com sucesso (4 ms)
    √ó deve LISTAR os clientes da empresa
    √ó deve ATUALIZAR um cliente existente
    √ó deve EXCLUIR um cliente existente

  ‚óè 7. M√≥dulo de Clientes/Fornecedores ‚Ä∫ deve CRIAR um novo cliente com sucesso

    TypeError: Invalid URL

      43 |     };
      44 |
    > 45 |     const response = await axios.post(`${API_URL}/clients`, newClient, {
         |                                  ^
      46 |       headers: { Authorization: `Bearer ${userToken}` },
      47 |     });
      48 |

      at dispatchHttpRequest (node_modules/axios/lib/adapters/http.js:408:20)
      at node_modules/axios/lib/adapters/http.js:249:5
      at wrapAsync (node_modules/axios/lib/adapters/http.js:229:10)
      at http (node_modules/axios/lib/adapters/http.js:314:10)
      at Axios.dispatchRequest (node_modules/axios/lib/core/dispatchRequest.js:51:10)
      at Axios._request (node_modules/axios/lib/core/Axios.js:185:33)
      at Axios.request (node_modules/axios/lib/core/Axios.js:40:25)
      at Axios.httpMethod [as post] (node_modules/axios/lib/core/Axios.js:224:19)
      at Function.wrap (node_modules/axios/lib/helpers/bind.js:12:15)
      at Object.<anonymous> (Testes/2-features/clients.test.js:45:34)

  ‚óè 7. M√≥dulo de Clientes/Fornecedores ‚Ä∫ deve LISTAR os clientes da empresa

    TypeError: Invalid URL

      54 |
      55 |   test('deve LISTAR os clientes da empresa', async () => {
    > 56 |     const response = await axios.get(`${API_URL}/clients`, {
         |                                  ^
      57 |       headers: { Authorization: `Bearer ${userToken}` },
      58 |     });
      59 |

      at dispatchHttpRequest (node_modules/axios/lib/adapters/http.js:408:20)
      at node_modules/axios/lib/adapters/http.js:249:5
      at wrapAsync (node_modules/axios/lib/adapters/http.js:229:10)
      at http (node_modules/axios/lib/adapters/http.js:314:10)
      at Axios.dispatchRequest (node_modules/axios/lib/core/dispatchRequest.js:51:10)
      at Axios._request (node_modules/axios/lib/core/Axios.js:185:33)
      at Axios.request (node_modules/axios/lib/core/Axios.js:40:25)
      at Axios.<computed> [as get] (node_modules/axios/lib/core/Axios.js:211:17)
      at Function.wrap [as get] (node_modules/axios/lib/helpers/bind.js:12:15)
      at Object.<anonymous> (Testes/2-features/clients.test.js:56:34)

  ‚óè 7. M√≥dulo de Clientes/Fornecedores ‚Ä∫ deve ATUALIZAR um cliente existente

    TypeError: Invalid URL

      69 |     };
      70 |
    > 71 |     const response = await axios.put(`${API_URL}/clients/${createdClientId}`, updatedData, {
         |                                  ^
      72 |       headers: { Authorization: `Bearer ${userToken}` },
      73 |     });
      74 |

      at dispatchHttpRequest (node_modules/axios/lib/adapters/http.js:408:20)
      at node_modules/axios/lib/adapters/http.js:249:5
      at wrapAsync (node_modules/axios/lib/adapters/http.js:229:10)
      at http (node_modules/axios/lib/adapters/http.js:314:10)
      at Axios.dispatchRequest (node_modules/axios/lib/core/dispatchRequest.js:51:10)
      at Axios._request (node_modules/axios/lib/core/Axios.js:185:33)
      at Axios.request (node_modules/axios/lib/core/Axios.js:40:25)
      at Axios.httpMethod [as put] (node_modules/axios/lib/core/Axios.js:224:19)
      at Function.wrap [as put] (node_modules/axios/lib/helpers/bind.js:12:15)
      at Object.<anonymous> (Testes/2-features/clients.test.js:71:34)

  ‚óè 7. M√≥dulo de Clientes/Fornecedores ‚Ä∫ deve EXCLUIR um cliente existente

    TypeError: Invalid URL

      78 |
      79 |   test('deve EXCLUIR um cliente existente', async () => {
    > 80 |     const response = await axios.delete(`${API_URL}/clients/${createdClientId}`, {
         |                                        ^
      81 |       headers: { Authorization: `Bearer ${userToken}` },
      82 |     });
      83 |

      at dispatchHttpRequest (node_modules/axios/lib/adapters/http.js:408:20)
      at node_modules/axios/lib/adapters/http.js:249:5
      at wrapAsync (node_modules/axios/lib/adapters/http.js:229:10)
      at http (node_modules/axios/lib/adapters/http.js:314:10)
      at Axios.dispatchRequest (node_modules/axios/lib/core/dispatchRequest.js:51:10)
      at Axios._request (node_modules/axios/lib/core/Axios.js:185:33)
      at Axios.request (node_modules/axios/lib/core/Axios.js:40:25)
      at Axios.<computed> [as delete] (node_modules/axios/lib/core/Axios.js:211:17)
      at Function.wrap [as delete] (node_modules/axios/lib/helpers/bind.js:12:15)
      at Object.<anonymous> (Testes/2-features/clients.test.js:80:40)

FAIL Testes/2-features/goals.test.js
  5. M√≥dulo de Metas (CRUD)
    √ó deve CRIAR uma nova meta com sucesso (4 ms)
    √ó deve LISTAR as metas do usu√°rio logado (1 ms)
    √ó deve ATUALIZAR uma meta existente (1 ms)
    √ó deve EXCLUIR uma meta existente

  ‚óè 5. M√≥dulo de Metas (CRUD) ‚Ä∫ deve CRIAR uma nova meta com sucesso

    TypeError: Invalid URL

      44 |         };
      45 |
    > 46 |         const response = await axios.post(`${API_URL}/goals`, goalData, {
         |                                      ^
      47 |             headers: { Authorization: `Bearer ${userToken}` }
      48 |         });
      49 |

      at dispatchHttpRequest (node_modules/axios/lib/adapters/http.js:408:20)
      at node_modules/axios/lib/adapters/http.js:249:5
      at wrapAsync (node_modules/axios/lib/adapters/http.js:229:10)
      at http (node_modules/axios/lib/adapters/http.js:314:10)
      at Axios.dispatchRequest (node_modules/axios/lib/core/dispatchRequest.js:51:10)
      at Axios._request (node_modules/axios/lib/core/Axios.js:185:33)
      at Axios.request (node_modules/axios/lib/core/Axios.js:40:25)
      at Axios.httpMethod [as post] (node_modules/axios/lib/core/Axios.js:224:19)
      at Function.wrap (node_modules/axios/lib/helpers/bind.js:12:15)
      at Object.<anonymous> (Testes/2-features/goals.test.js:46:38)

  ‚óè 5. M√≥dulo de Metas (CRUD) ‚Ä∫ deve LISTAR as metas do usu√°rio logado

    expect(received).toBeDefined()

    Received: undefined

      57 |
      58 |     test('deve LISTAR as metas do usu√°rio logado', async () => {
    > 59 |         expect(createdGoalId).toBeDefined();
         |                               ^
      60 |
      61 |         const response = await axios.get(`${API_URL}/goals`, {
      62 |             headers: { Authorization: `Bearer ${userToken}` }

      at Object.<anonymous> (Testes/2-features/goals.test.js:59:31)

  ‚óè 5. M√≥dulo de Metas (CRUD) ‚Ä∫ deve ATUALIZAR uma meta existente

    expect(received).toBeDefined()

    Received: undefined

      70 |
      71 |     test('deve ATUALIZAR uma meta existente', async () => {
    > 72 |         expect(createdGoalId).toBeDefined();
         |                               ^
      73 |
      74 |         const updatedData = {
      75 |             title: 'Economizar para novo maquin√°rio (URGENTE)',

      at Object.<anonymous> (Testes/2-features/goals.test.js:72:31)

  ‚óè 5. M√≥dulo de Metas (CRUD) ‚Ä∫ deve EXCLUIR uma meta existente

    expect(received).toBeDefined()

    Received: undefined

      87 |
      88 |     test('deve EXCLUIR uma meta existente', async () => {
    > 89 |         expect(createdGoalId).toBeDefined();
         |                               ^
      90 |
      91 |         const response = await axios.delete(`${API_URL}/goals/${createdGoalId}`, {
      92 |             headers: { Authorization: `Bearer ${userToken}` }

      at Object.<anonymous> (Testes/2-features/goals.test.js:89:31)

FAIL Testes/2-features/transactions.test.js
  4. M√≥dulo de Transa√ß√µes (CRUD)
    √ó deve CRIAR uma nova transa√ß√£o com sucesso (5 ms)
    √ó deve falhar ao tentar criar uma transa√ß√£o com dados inv√°lidos (1 ms)
    √ó deve LISTAR as transa√ß√µes do usu√°rio logado (2 ms)
    √ó deve OBTER uma transa√ß√£o espec√≠fica pelo ID (1 ms)
    √ó deve ATUALIZAR uma transa√ß√£o existente (1 ms)
    √ó deve EXCLUIR uma transa√ß√£o existente (1 ms)

  ‚óè 4. M√≥dulo de Transa√ß√µes (CRUD) ‚Ä∫ deve CRIAR uma nova transa√ß√£o com sucesso

    TypeError: Invalid URL

      53 |         };
      54 |
    > 55 |         const response = await axios.post(`${API_URL}/transactions`, transactionData, {
         |                                      ^
      56 |             headers: { Authorization: `Bearer ${userToken}` }
      57 |         });
      58 |

      at dispatchHttpRequest (node_modules/axios/lib/adapters/http.js:408:20)
      at node_modules/axios/lib/adapters/http.js:249:5
      at wrapAsync (node_modules/axios/lib/adapters/http.js:229:10)
      at http (node_modules/axios/lib/adapters/http.js:314:10)
      at Axios.dispatchRequest (node_modules/axios/lib/core/dispatchRequest.js:51:10)
      at Axios._request (node_modules/axios/lib/core/Axios.js:185:33)
      at Axios.request (node_modules/axios/lib/core/Axios.js:40:25)
      at Axios.httpMethod [as post] (node_modules/axios/lib/core/Axios.js:224:19)
      at Function.wrap (node_modules/axios/lib/helpers/bind.js:12:15)
      at Object.<anonymous> (Testes/2-features/transactions.test.js:55:38)

  ‚óè 4. M√≥dulo de Transa√ß√µes (CRUD) ‚Ä∫ deve falhar ao tentar criar uma transa√ß√£o com dados inv√°lidos

    TypeError: Cannot read properties of undefined (reading 'status')

      85 |             fail('A cria√ß√£o de transa√ß√£o com dados inv√°lidos deveria ter falhado.');
      86 |         } catch (error) {
    > 87 |             expect(error.response.status).toBe(400);
         |                                   ^
      88 |         }
      89 |     });
      90 |

      at Object.<anonymous> (Testes/2-features/transactions.test.js:87:35)

  ‚óè 4. M√≥dulo de Transa√ß√µes (CRUD) ‚Ä∫ deve LISTAR as transa√ß√µes do usu√°rio logado

    expect(received).toBeDefined()

    Received: undefined

      91 |     test('deve LISTAR as transa√ß√µes do usu√°rio logado', async () => {
      92 |         // Este teste depende que o anterior tenha criado uma transa√ß√£o
    > 93 |         expect(createdTransactionId).toBeDefined();
         |                                      ^
      94 |
      95 |         const response = await axios.get(`${API_URL}/transactions`, {
      96 |             headers: { Authorization: `Bearer ${userToken}` }

      at Object.<anonymous> (Testes/2-features/transactions.test.js:93:38)

  ‚óè 4. M√≥dulo de Transa√ß√µes (CRUD) ‚Ä∫ deve OBTER uma transa√ß√£o espec√≠fica pelo ID

    expect(received).toBeDefined()

    Received: undefined

      107 |
      108 |     test('deve OBTER uma transa√ß√£o espec√≠fica pelo ID', async () => {
    > 109 |         expect(createdTransactionId).toBeDefined();
          |                                      ^
      110 |
      111 |         const response = await axios.get(`${API_URL}/transactions/${createdTransactionId}`, {
      112 |             headers: { Authorization: `Bearer ${userToken}` }

      at Object.<anonymous> (Testes/2-features/transactions.test.js:109:38)

  ‚óè 4. M√≥dulo de Transa√ß√µes (CRUD) ‚Ä∫ deve ATUALIZAR uma transa√ß√£o existente

    expect(received).toBeDefined()

    Received: undefined

      119 |
      120 |     test('deve ATUALIZAR uma transa√ß√£o existente', async () => {
    > 121 |         expect(createdTransactionId).toBeDefined();
          |                                      ^
      122 |
      123 |         const updatedData = {
      124 |             description: 'Venda de consultoria (Valor Atualizado)',

      at Object.<anonymous> (Testes/2-features/transactions.test.js:121:38)

  ‚óè 4. M√≥dulo de Transa√ß√µes (CRUD) ‚Ä∫ deve EXCLUIR uma transa√ß√£o existente

    expect(received).toBeDefined()

    Received: undefined

      137 |
      138 |     test('deve EXCLUIR uma transa√ß√£o existente', async () => {
    > 139 |         expect(createdTransactionId).toBeDefined();
          |                                      ^
      140 |
      141 |         const response = await axios.delete(`${API_URL}/transactions/${createdTransactionId}`, {
      142 |             headers: { Authorization: `Bearer ${userToken}` }

      at Object.<anonymous> (Testes/2-features/transactions.test.js:139:38)

FAIL Testes/2-features/uploads.test.js
  Feature: Uploads
    Upload de PDF
      √ó Deve permitir o upload de um anexo (PDF) para uma transa√ß√£o
      √ó Deve permitir a exclus√£o de um anexo (PDF) de uma transa√ß√£o (1 ms)
    Upload de Imagem (PNG)
      √ó Deve permitir o upload de um anexo de imagem (.png) para uma transa√ß√£o (1 ms)
      √ó Deve permitir a exclus√£o de um anexo de imagem (.png)
    Upload de Imagem (JPG)
      √ó Deve permitir o upload de um anexo de imagem (.jpg) para uma transa√ß√£o
      √ó Deve permitir a exclus√£o de um anexo de imagem (.jpg) (1 ms)
    Upload de Imagem (JPEG)
      √ó Deve permitir o upload de um anexo de imagem (.jpeg) para uma transa√ß√£o (1 ms)
      √ó Deve permitir a exclus√£o de um anexo de imagem (.jpeg)
    Cen√°rios de Erro e Estruturais
      √ó Deve retornar 404 ao tentar fazer upload para uma transa√ß√£o inexistente (6 ms)

  ‚óè Feature: Uploads ‚Ä∫ Upload de PDF ‚Ä∫ Deve permitir o upload de um anexo (PDF) para uma transa√ß√£o

    TypeError: Invalid URL

      40 |
      41 |         beforeAll(async () => {
    > 42 |             const response = await axios.post(
         |                                          ^
      43 |                 `${apiUrl}/transactions`,
      44 |                 {
      45 |                     description: 'Transa√ß√£o para Teste de Upload de PDF',

      at dispatchHttpRequest (node_modules/axios/lib/adapters/http.js:408:20)
      at node_modules/axios/lib/adapters/http.js:249:5
      at wrapAsync (node_modules/axios/lib/adapters/http.js:229:10)
      at http (node_modules/axios/lib/adapters/http.js:314:10)
      at Axios.dispatchRequest (node_modules/axios/lib/core/dispatchRequest.js:51:10)
      at Axios._request (node_modules/axios/lib/core/Axios.js:185:33)
      at Axios.request (node_modules/axios/lib/core/Axios.js:40:25)
      at Axios.httpMethod [as post] (node_modules/axios/lib/core/Axios.js:224:19)
      at Function.wrap (node_modules/axios/lib/helpers/bind.js:12:15)
      at Object.<anonymous> (Testes/2-features/uploads.test.js:42:42)

  ‚óè Feature: Uploads ‚Ä∫ Upload de PDF ‚Ä∫ Deve permitir a exclus√£o de um anexo (PDF) de uma transa√ß√£o

    TypeError: Invalid URL

      40 |
      41 |         beforeAll(async () => {
    > 42 |             const response = await axios.post(
         |                                          ^
      43 |                 `${apiUrl}/transactions`,
      44 |                 {
      45 |                     description: 'Transa√ß√£o para Teste de Upload de PDF',

      at dispatchHttpRequest (node_modules/axios/lib/adapters/http.js:408:20)
      at node_modules/axios/lib/adapters/http.js:249:5
      at wrapAsync (node_modules/axios/lib/adapters/http.js:229:10)
      at http (node_modules/axios/lib/adapters/http.js:314:10)
      at Axios.dispatchRequest (node_modules/axios/lib/core/dispatchRequest.js:51:10)
      at Axios._request (node_modules/axios/lib/core/Axios.js:185:33)
      at Axios.request (node_modules/axios/lib/core/Axios.js:40:25)
      at Axios.httpMethod [as post] (node_modules/axios/lib/core/Axios.js:224:19)
      at Function.wrap (node_modules/axios/lib/helpers/bind.js:12:15)
      at Object.<anonymous> (Testes/2-features/uploads.test.js:42:42)

  ‚óè Feature: Uploads ‚Ä∫ Upload de Imagem (PNG) ‚Ä∫ Deve permitir o upload de um anexo de imagem (.png) para uma transa√ß√£o

    TypeError: Invalid URL

      115 |
      116 |         beforeAll(async () => {
    > 117 |             const response = await axios.post(
          |                                          ^
      118 |                 `${apiUrl}/transactions`,
      119 |                 {
      120 |                     description: `Transa√ß√£o para Teste de Upload de ${name}`,

      at dispatchHttpRequest (node_modules/axios/lib/adapters/http.js:408:20)
      at node_modules/axios/lib/adapters/http.js:249:5
      at wrapAsync (node_modules/axios/lib/adapters/http.js:229:10)
      at http (node_modules/axios/lib/adapters/http.js:314:10)
      at Axios.dispatchRequest (node_modules/axios/lib/core/dispatchRequest.js:51:10)
      at Axios._request (node_modules/axios/lib/core/Axios.js:185:33)
      at Axios.request (node_modules/axios/lib/core/Axios.js:40:25)
      at Axios.httpMethod [as post] (node_modules/axios/lib/core/Axios.js:224:19)
      at Function.wrap (node_modules/axios/lib/helpers/bind.js:12:15)
      at Object.<anonymous> (Testes/2-features/uploads.test.js:117:42)

  ‚óè Feature: Uploads ‚Ä∫ Upload de Imagem (PNG) ‚Ä∫ Deve permitir a exclus√£o de um anexo de imagem (.png)

    TypeError: Invalid URL

      115 |
      116 |         beforeAll(async () => {
    > 117 |             const response = await axios.post(
          |                                          ^
      118 |                 `${apiUrl}/transactions`,
      119 |                 {
      120 |                     description: `Transa√ß√£o para Teste de Upload de ${name}`,

      at dispatchHttpRequest (node_modules/axios/lib/adapters/http.js:408:20)
      at node_modules/axios/lib/adapters/http.js:249:5
      at wrapAsync (node_modules/axios/lib/adapters/http.js:229:10)
      at http (node_modules/axios/lib/adapters/http.js:314:10)
      at Axios.dispatchRequest (node_modules/axios/lib/core/dispatchRequest.js:51:10)
      at Axios._request (node_modules/axios/lib/core/Axios.js:185:33)
      at Axios.request (node_modules/axios/lib/core/Axios.js:40:25)
      at Axios.httpMethod [as post] (node_modules/axios/lib/core/Axios.js:224:19)
      at Function.wrap (node_modules/axios/lib/helpers/bind.js:12:15)
      at Object.<anonymous> (Testes/2-features/uploads.test.js:117:42)

  ‚óè Feature: Uploads ‚Ä∫ Upload de Imagem (JPG) ‚Ä∫ Deve permitir o upload de um anexo de imagem (.jpg) para uma transa√ß√£o

    TypeError: Invalid URL

      115 |
      116 |         beforeAll(async () => {
    > 117 |             const response = await axios.post(
          |                                          ^
      118 |                 `${apiUrl}/transactions`,
      119 |                 {
      120 |                     description: `Transa√ß√£o para Teste de Upload de ${name}`,

      at dispatchHttpRequest (node_modules/axios/lib/adapters/http.js:408:20)
      at node_modules/axios/lib/adapters/http.js:249:5
      at wrapAsync (node_modules/axios/lib/adapters/http.js:229:10)
      at http (node_modules/axios/lib/adapters/http.js:314:10)
      at Axios.dispatchRequest (node_modules/axios/lib/core/dispatchRequest.js:51:10)
      at Axios._request (node_modules/axios/lib/core/Axios.js:185:33)
      at Axios.request (node_modules/axios/lib/core/Axios.js:40:25)
      at Axios.httpMethod [as post] (node_modules/axios/lib/core/Axios.js:224:19)
      at Function.wrap (node_modules/axios/lib/helpers/bind.js:12:15)
      at Object.<anonymous> (Testes/2-features/uploads.test.js:117:42)

  ‚óè Feature: Uploads ‚Ä∫ Upload de Imagem (JPG) ‚Ä∫ Deve permitir a exclus√£o de um anexo de imagem (.jpg)

    TypeError: Invalid URL

      115 |
      116 |         beforeAll(async () => {
    > 117 |             const response = await axios.post(
          |                                          ^
      118 |                 `${apiUrl}/transactions`,
      119 |                 {
      120 |                     description: `Transa√ß√£o para Teste de Upload de ${name}`,

      at dispatchHttpRequest (node_modules/axios/lib/adapters/http.js:408:20)
      at node_modules/axios/lib/adapters/http.js:249:5
      at wrapAsync (node_modules/axios/lib/adapters/http.js:229:10)
      at http (node_modules/axios/lib/adapters/http.js:314:10)
      at Axios.dispatchRequest (node_modules/axios/lib/core/dispatchRequest.js:51:10)
      at Axios._request (node_modules/axios/lib/core/Axios.js:185:33)
      at Axios.request (node_modules/axios/lib/core/Axios.js:40:25)
      at Axios.httpMethod [as post] (node_modules/axios/lib/core/Axios.js:224:19)
      at Function.wrap (node_modules/axios/lib/helpers/bind.js:12:15)
      at Object.<anonymous> (Testes/2-features/uploads.test.js:117:42)

  ‚óè Feature: Uploads ‚Ä∫ Upload de Imagem (JPEG) ‚Ä∫ Deve permitir o upload de um anexo de imagem (.jpeg) para uma transa√ß√£o

    TypeError: Invalid URL

      115 |
      116 |         beforeAll(async () => {
    > 117 |             const response = await axios.post(
          |                                          ^
      118 |                 `${apiUrl}/transactions`,
      119 |                 {
      120 |                     description: `Transa√ß√£o para Teste de Upload de ${name}`,

      at dispatchHttpRequest (node_modules/axios/lib/adapters/http.js:408:20)
      at node_modules/axios/lib/adapters/http.js:249:5
      at wrapAsync (node_modules/axios/lib/adapters/http.js:229:10)
      at http (node_modules/axios/lib/adapters/http.js:314:10)
      at Axios.dispatchRequest (node_modules/axios/lib/core/dispatchRequest.js:51:10)
      at Axios._request (node_modules/axios/lib/core/Axios.js:185:33)
      at Axios.request (node_modules/axios/lib/core/Axios.js:40:25)
      at Axios.httpMethod [as post] (node_modules/axios/lib/core/Axios.js:224:19)
      at Function.wrap (node_modules/axios/lib/helpers/bind.js:12:15)
      at Object.<anonymous> (Testes/2-features/uploads.test.js:117:42)

  ‚óè Feature: Uploads ‚Ä∫ Upload de Imagem (JPEG) ‚Ä∫ Deve permitir a exclus√£o de um anexo de imagem (.jpeg)

    TypeError: Invalid URL

      115 |
      116 |         beforeAll(async () => {
    > 117 |             const response = await axios.post(
          |                                          ^
      118 |                 `${apiUrl}/transactions`,
      119 |                 {
      120 |                     description: `Transa√ß√£o para Teste de Upload de ${name}`,

      at dispatchHttpRequest (node_modules/axios/lib/adapters/http.js:408:20)
      at node_modules/axios/lib/adapters/http.js:249:5
      at wrapAsync (node_modules/axios/lib/adapters/http.js:229:10)
      at http (node_modules/axios/lib/adapters/http.js:314:10)
      at Axios.dispatchRequest (node_modules/axios/lib/core/dispatchRequest.js:51:10)
      at Axios._request (node_modules/axios/lib/core/Axios.js:185:33)
      at Axios.request (node_modules/axios/lib/core/Axios.js:40:25)
      at Axios.httpMethod [as post] (node_modules/axios/lib/core/Axios.js:224:19)
      at Function.wrap (node_modules/axios/lib/helpers/bind.js:12:15)
      at Object.<anonymous> (Testes/2-features/uploads.test.js:117:42)

  ‚óè Feature: Uploads ‚Ä∫ Cen√°rios de Erro e Estruturais ‚Ä∫ Deve retornar 404 ao tentar fazer upload para uma transa√ß√£o inexistente

    expect(received).rejects.toThrow(expected)

    Expected substring: "Request failed with status code 404"
    Received message:   "Invalid URL"

          183 |
          184 |             await expect(
        > 185 |                 axios.post(
              |                       ^
          186 |                     `${apiUrl}/transactions/${invalidId}/upload`,
          187 |                     form,
          188 |                     { headers: { ...form.getHeaders(), Authorization: `Bearer ${companyA.token}` } }

      at dispatchHttpRequest (node_modules/axios/lib/adapters/http.js:408:20)
      at node_modules/axios/lib/adapters/http.js:249:5
      at wrapAsync (node_modules/axios/lib/adapters/http.js:229:10)
      at http (node_modules/axios/lib/adapters/http.js:314:10)
      at Axios.dispatchRequest (node_modules/axios/lib/core/dispatchRequest.js:51:10)
      at Axios._request (node_modules/axios/lib/core/Axios.js:185:33)
      at Axios.request (node_modules/axios/lib/core/Axios.js:40:25)
      at Axios.httpMethod [as post] (node_modules/axios/lib/core/Axios.js:224:19)
      at Function.wrap (node_modules/axios/lib/helpers/bind.js:12:15)
      at Object.<anonymous> (Testes/2-features/uploads.test.js:185:23)
      at Object.toThrow (node_modules/expect/build/index.js:2155:20)
      at Object.<anonymous> (Testes/2-features/uploads.test.js:190:23)

  console.log
    
    --- Configurando 3 empresas para o teste multi-tenant ---

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:35:17)

  console.log
    
    --- Limpando dados de teste (Teardown) ---

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:148:17)

FAIL Testes/3-security/multi-tenant.test.js
  3. Teste de Isolamento de Dados (Multi-Tenant)
    √ó deve criar uma transa√ß√£o para cada empresa
    √ó deve impedir que uma empresa acesse a transa√ß√£o de outra
    √ó deve garantir que cada empresa liste apenas suas pr√≥prias transa√ß√µes

  ‚óè 3. Teste de Isolamento de Dados (Multi-Tenant) ‚Ä∫ deve criar uma transa√ß√£o para cada empresa

    TypeError: Invalid URL

      46 |
      47 |             // Cadastrar
    > 48 |             await axios.post(`${API_URL}/auth/register`, companyData);
         |                         ^
      49 |
      50 |             // Logar para obter o token
      51 |             const loginResponse = await axios.post(`${API_URL}/auth/login`, {

      at dispatchHttpRequest (node_modules/axios/lib/adapters/http.js:408:20)
      at node_modules/axios/lib/adapters/http.js:249:5
      at wrapAsync (node_modules/axios/lib/adapters/http.js:229:10)
      at http (node_modules/axios/lib/adapters/http.js:314:10)
      at Axios.dispatchRequest (node_modules/axios/lib/core/dispatchRequest.js:51:10)
      at Axios._request (node_modules/axios/lib/core/Axios.js:185:33)
      at Axios.request (node_modules/axios/lib/core/Axios.js:40:25)
      at Axios.httpMethod [as post] (node_modules/axios/lib/core/Axios.js:224:19)
      at Function.wrap (node_modules/axios/lib/helpers/bind.js:12:15)
      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:48:25)

  ‚óè 3. Teste de Isolamento de Dados (Multi-Tenant) ‚Ä∫ deve impedir que uma empresa acesse a transa√ß√£o de outra

    TypeError: Invalid URL

      46 |
      47 |             // Cadastrar
    > 48 |             await axios.post(`${API_URL}/auth/register`, companyData);
         |                         ^
      49 |
      50 |             // Logar para obter o token
      51 |             const loginResponse = await axios.post(`${API_URL}/auth/login`, {

      at dispatchHttpRequest (node_modules/axios/lib/adapters/http.js:408:20)
      at node_modules/axios/lib/adapters/http.js:249:5
      at wrapAsync (node_modules/axios/lib/adapters/http.js:229:10)
      at http (node_modules/axios/lib/adapters/http.js:314:10)
      at Axios.dispatchRequest (node_modules/axios/lib/core/dispatchRequest.js:51:10)
      at Axios._request (node_modules/axios/lib/core/Axios.js:185:33)
      at Axios.request (node_modules/axios/lib/core/Axios.js:40:25)
      at Axios.httpMethod [as post] (node_modules/axios/lib/core/Axios.js:224:19)
      at Function.wrap (node_modules/axios/lib/helpers/bind.js:12:15)
      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:48:25)

  ‚óè 3. Teste de Isolamento de Dados (Multi-Tenant) ‚Ä∫ deve garantir que cada empresa liste apenas suas pr√≥prias transa√ß√µes

    TypeError: Invalid URL

      46 |
      47 |             // Cadastrar
    > 48 |             await axios.post(`${API_URL}/auth/register`, companyData);
         |                         ^
      49 |
      50 |             // Logar para obter o token
      51 |             const loginResponse = await axios.post(`${API_URL}/auth/login`, {

      at dispatchHttpRequest (node_modules/axios/lib/adapters/http.js:408:20)
      at node_modules/axios/lib/adapters/http.js:249:5
      at wrapAsync (node_modules/axios/lib/adapters/http.js:229:10)
      at http (node_modules/axios/lib/adapters/http.js:314:10)
      at Axios.dispatchRequest (node_modules/axios/lib/core/dispatchRequest.js:51:10)
      at Axios._request (node_modules/axios/lib/core/Axios.js:185:33)
      at Axios.request (node_modules/axios/lib/core/Axios.js:40:25)
      at Axios.httpMethod [as post] (node_modules/axios/lib/core/Axios.js:224:19)
      at Function.wrap (node_modules/axios/lib/helpers/bind.js:12:15)
      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:48:25)

  console.log
    
    --- üõ°Ô∏è  Teste de Persist√™ncia: Verificando dados manuais... ---

      at Object.<anonymous> (Testes/3-security/persistence.test.js:27:13)

FAIL Testes/3-security/persistence.test.js (10.521 s)
  Security: Persist√™ncia de Dados Manuais
    √ó deve garantir que os usu√°rios de teste manuais permane√ßam no banco ap√≥s a execu√ß√£o de `npm test` (10015 ms)

  ‚óè Security: Persist√™ncia de Dados Manuais ‚Ä∫ deve garantir que os usu√°rios de teste manuais permane√ßam no banco ap√≥s a execu√ß√£o de `npm test`

    MongooseError: Operation `users.findOne()` buffering timed out after 10000ms

      at Timeout.<anonymous> (node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:187:23)

FAIL Testes/4-reports/reports.test.js
  8. M√≥dulo de Relat√≥rios
    √ó deve gerar um PDF v√°lido para o RELAT√ìRIO DE TRANSA√á√ïES (3 ms)
    √ó deve gerar um PDF v√°lido para o RELAT√ìRIO DE CLIENTES
    √ó deve gerar um PDF v√°lido para a FATURA

  ‚óè 8. M√≥dulo de Relat√≥rios ‚Ä∫ deve gerar um PDF v√°lido para o RELAT√ìRIO DE TRANSA√á√ïES

    TypeError: Invalid URL

      22 |
      23 |   test('deve gerar um PDF v√°lido para o RELAT√ìRIO DE TRANSA√á√ïES', async () => {
    > 24 |     const response = await axios.get(`${API_URL}/reports/export/transactions-pdf`, {
         |                                  ^
      25 |       headers: { Authorization: `Bearer ${companyA.token}` },
      26 |     });
      27 |

      at dispatchHttpRequest (node_modules/axios/lib/adapters/http.js:408:20)
      at node_modules/axios/lib/adapters/http.js:249:5
      at wrapAsync (node_modules/axios/lib/adapters/http.js:229:10)
      at http (node_modules/axios/lib/adapters/http.js:314:10)
      at Axios.dispatchRequest (node_modules/axios/lib/core/dispatchRequest.js:51:10)
      at Axios._request (node_modules/axios/lib/core/Axios.js:185:33)
      at Axios.request (node_modules/axios/lib/core/Axios.js:40:25)
      at Axios.<computed> [as get] (node_modules/axios/lib/core/Axios.js:211:17)
      at Function.wrap [as get] (node_modules/axios/lib/helpers/bind.js:12:15)
      at Object.<anonymous> (Testes/4-reports/reports.test.js:24:34)

  ‚óè 8. M√≥dulo de Relat√≥rios ‚Ä∫ deve gerar um PDF v√°lido para o RELAT√ìRIO DE CLIENTES

    TypeError: Invalid URL

      31 |
      32 |   test('deve gerar um PDF v√°lido para o RELAT√ìRIO DE CLIENTES', async () => {
    > 33 |     const response = await axios.get(`${API_URL}/reports/export/clients-pdf`, {
         |                                  ^
      34 |       headers: { Authorization: `Bearer ${companyA.token}` },
      35 |     });
      36 |

      at dispatchHttpRequest (node_modules/axios/lib/adapters/http.js:408:20)
      at node_modules/axios/lib/adapters/http.js:249:5
      at wrapAsync (node_modules/axios/lib/adapters/http.js:229:10)
      at http (node_modules/axios/lib/adapters/http.js:314:10)
      at Axios.dispatchRequest (node_modules/axios/lib/core/dispatchRequest.js:51:10)
      at Axios._request (node_modules/axios/lib/core/Axios.js:185:33)
      at Axios.request (node_modules/axios/lib/core/Axios.js:40:25)
      at Axios.<computed> [as get] (node_modules/axios/lib/core/Axios.js:211:17)
      at Function.wrap [as get] (node_modules/axios/lib/helpers/bind.js:12:15)
      at Object.<anonymous> (Testes/4-reports/reports.test.js:33:34)

  ‚óè 8. M√≥dulo de Relat√≥rios ‚Ä∫ deve gerar um PDF v√°lido para a FATURA

    TypeError: Invalid URL

      40 |
      41 |   test('deve gerar um PDF v√°lido para a FATURA', async () => {
    > 42 |     const response = await axios.get(`${API_URL}/reports/export/invoice/${companyA.testTransaction._id}`, {
         |                                  ^
      43 |       headers: { Authorization: `Bearer ${companyA.token}` },
      44 |     });
      45 |

      at dispatchHttpRequest (node_modules/axios/lib/adapters/http.js:408:20)
      at node_modules/axios/lib/adapters/http.js:249:5
      at wrapAsync (node_modules/axios/lib/adapters/http.js:229:10)
      at http (node_modules/axios/lib/adapters/http.js:314:10)
      at Axios.dispatchRequest (node_modules/axios/lib/core/dispatchRequest.js:51:10)
      at Axios._request (node_modules/axios/lib/core/Axios.js:185:33)
      at Axios.request (node_modules/axios/lib/core/Axios.js:40:25)
      at Axios.<computed> [as get] (node_modules/axios/lib/core/Axios.js:211:17)
      at Function.wrap [as get] (node_modules/axios/lib/helpers/bind.js:12:15)
      at Object.<anonymous> (Testes/4-reports/reports.test.js:42:34)

Test Suites: 9 failed, 1 passed, 10 total
Tests:       35 failed, 1 passed, 36 total
Snapshots:   0 total
Time:        12.793 s
Ran all test suites.

--- üßπ [GLOBAL TEARDOWN] Finalizando ambiente de teste ---
   - [OK] Dados de teste tempor√°rios foram removidos.
‚úÖ Servidor e conex√£o com MongoDB encerrados (stopServer).
--- ‚úÖ [GLOBAL TEARDOWN] Ambiente finalizado com sucesso ---
