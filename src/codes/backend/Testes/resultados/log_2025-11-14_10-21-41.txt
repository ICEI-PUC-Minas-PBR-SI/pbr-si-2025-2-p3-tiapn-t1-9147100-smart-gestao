> smart-gestao-backend@1.0.0 test:all
> cross-env NODE_OPTIONS=--experimental-vm-modules jest --config ./Testes/config/jest.config.cjs

Determining test suites to run...
--- ðŸš€ [GLOBAL SETUP] Iniciando ambiente de teste ---
Verificando permissÃµes de sistema...
PermissÃµes nÃ£o encontradas. Criando permissÃµes padrÃ£o...
PermissÃµes padrÃ£o criadas com sucesso!
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ (index) â”‚ Nome            â”‚ DescriÃ§Ã£o                                                                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 0       â”‚ 'ROOT'          â”‚ 'SuperusuÃ¡rio. Acesso irrestrito a todos os dados e configuraÃ§Ãµes do sistema.'                   â”‚
â”‚ 1       â”‚ 'ADMIN_COMPANY' â”‚ 'Administrador de uma empresa. Pode gerenciar usuÃ¡rios e todos os dados da sua prÃ³pria empresa.' â”‚
â”‚ 2       â”‚ 'USER_COMPANY'  â”‚ 'UsuÃ¡rio padrÃ£o. Pode criar e gerenciar seus prÃ³prios dados dentro da empresa.'                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â³ Iniciando servidor Smart GestÃ£o (startServer)...
ConexÃ£o com o MongoDB estabelecida com sucesso.
âœ… [1/1] ConexÃ£o com o banco de dados estabelecida!
âœ… Servidor rodando na porta 5000
--- âœ… [GLOBAL SETUP] Ambiente pronto e servidor iniciado ---
(node:9788) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
(node:23864) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
(node:2836) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
(node:752) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
(node:14660) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
(node:2232) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
POST /api/auth/login 200 133.839 ms - 688
POST /api/auth/login 200 114.633 ms - 688
  console.log

    --- Teste: Solicitar reset para e-mail invÃ¡lido ---

      at Object.log (Testes/1-auth/password.test.js:25:13)

POST /api/auth/login 200 120.477 ms - 688
POST /api/auth/forgot-password 404 14.197 ms - 69
  console.log
    âœ… Falhou como esperado para e-mail inexistente (Status 404).

      at Object.log (Testes/1-auth/password.test.js:34:15)

  console.log

    --- Teste: Gerar token de reset com sucesso ---

      at Object.log (Testes/1-auth/password.test.js:39:13)

[LOG] AÃ§Ã£o: LOGIN_USER | UsuÃ¡rio: N/A
POST /api/auth/logout 200 20.757 ms - 108
POST /api/auth/forgot-password 200 102.251 ms - 164
  console.log
    âœ… Token de reset gerado e salvo no banco de dados.

      at Object.log (Testes/1-auth/password.test.js:49:13)

  console.log

    --- Teste: Resetar senha com token vÃ¡lido ---

      at Object.log (Testes/1-auth/password.test.js:53:13)

[LOG] AÃ§Ã£o: LOGIN_USER | UsuÃ¡rio: N/A
 PASS  Testes/1-auth/auth.test.js
  6. MÃ³dulo de AutenticaÃ§Ã£o e SessÃ£o (Stateful)
    âˆš deve criar um SessionToken no banco de dados apÃ³s o login (186 ms)
    âˆš deve invalidar o SessionToken no banco de dados apÃ³s o logout (131 ms)

[LOG] AÃ§Ã£o: LOGOUT_USER | UsuÃ¡rio: N/A
POST /api/auth/forgot-password 200 27.877 ms - 164
POST /api/auth/reset-password/b34170e5e3db64191d5b36fc7f371795b3160745d77ee72d6728646d0db2184e 200 122.954 ms - 68
  console.log
    âœ… Senha resetada com sucesso via API.

      at Object.log (Testes/1-auth/password.test.js:70:13)

POST /api/auth/reset-password/b34170e5e3db64191d5b36fc7f371795b3160745d77ee72d6728646d0db2184e 400 12.670 ms - 72
  console.log
    âœ… Token de reset foi invalidado no banco.

      at Object.log (Testes/1-auth/password.test.js:74:13)

POST /api/auth/login 200 100.930 ms - 688
 FAIL  Testes/1-auth/password.test.js
  9. MÃ³dulo de RecuperaÃ§Ã£o de Senha
    âˆš deve falhar ao solicitar reset para um e-mail inexistente (168 ms)
    âˆš deve gerar e salvar um token de reset para um e-mail vÃ¡lido (109 ms)
    Ã— deve resetar a senha com um token vÃ¡lido e permitir login com a nova senha (284 ms)

  â— 9. MÃ³dulo de RecuperaÃ§Ã£o de Senha â€º deve resetar a senha com um token vÃ¡lido e permitir login com a nova senha

    expect(received).toHaveProperty(path)

    Expected path: "token"
    Received path: []

    Received value: {"data": {"refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiI2OTE3MzNkMjA1OTIxZDY4NGRhZWQyYjkiLCJpYXQiOjE3NjMxMjgyNzYsImV4cCI6MTc2MzczMzA3Nn0.azTakJSGLaQ8QNADWLBPlQlO5dVrsMjRYZ9WN8UxbPY", "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiI2OTE3MzNkMjA1OTIxZDY4NGRhZWQyYjkiLCJyb2xlIjoiNjkxNzMzZDIwNTkyMWQ2ODRkYWVkMmI0IiwiY29tcGFueUlkIjoiNjkxNzMzZDIwNTkyMWQ2ODRkYWVkMmI3IiwiaWF0IjoxNzYzMTI4Mjc2LCJleHAiOjE3NjMxMjkxNzZ9.Zn2ujD15WT7-wmfVHf5-9duF3UvPA9RKUvov4q5bP1w", "user": {"companyId": "691733d205921d684daed2b7", "email": "usera_1763128274244@test.com", "id": "691733d205921d684daed2b9", "name": "UsuÃ¡rio A"}}, "message": "OperaÃ§Ã£o realizada com sucesso.", "success": true}

      81 |
      82 |     expect(loginResponse.status).toBe(200);
    > 83 |     expect(loginResponse.data).toHaveProperty('token');
         |                                ^
      84 |     console.log('âœ… Login com a nova senha realizado com sucesso.');
      85 |   });
      86 | });

      at Object.toHaveProperty (Testes/1-auth/password.test.js:83:32)

[LOG] AÃ§Ã£o: LOGIN_USER | UsuÃ¡rio: N/A
POST /api/clients 201 37.210 ms - 329
[LOG] AÃ§Ã£o: CREATE_CLIENT | UsuÃ¡rio: 69172cbc0ad9206dc6b1c5b3
GET /api/clients 200 27.087 ms - 575
PUT /api/clients/69172cbd0ad9206dc6b1c5c3 200 47.889 ms - 331
[LOG] AÃ§Ã£o: UPDATE_CLIENT | UsuÃ¡rio: 69172cbc0ad9206dc6b1c5b3
DELETE /api/clients/69172cbd0ad9206dc6b1c5c3 200 42.286 ms - 70
 PASS  Testes/2-features/clients.test.js
  7. MÃ³dulo de Clientes/Fornecedores
    âˆš deve CRIAR um novo cliente com sucesso (77 ms)
    âˆš deve LISTAR os clientes da empresa (31 ms)
    âˆš deve ATUALIZAR um cliente existente (55 ms)
    âˆš deve EXCLUIR um cliente existente (46 ms)

[LOG] AÃ§Ã£o: DELETE_CLIENT | UsuÃ¡rio: 69172cbc0ad9206dc6b1c5b3
POST /api/goals 201 49.158 ms - 404
[LOG] AÃ§Ã£o: CREATE_GOAL | UsuÃ¡rio: 69172cbc0ad9206dc6b1c5b3
GET /api/goals 200 26.649 ms - 406
PUT /api/goals/69172cbd0ad9206dc6b1c5d7 200 59.571 ms - 414
[LOG] AÃ§Ã£o: UPDATE_GOAL | UsuÃ¡rio: 69172cbc0ad9206dc6b1c5b3
DELETE /api/goals/69172cbd0ad9206dc6b1c5d7 200 58.408 ms - 67
[LOG] AÃ§Ã£o: DELETE_GOAL | UsuÃ¡rio: 69172cbc0ad9206dc6b1c5b3
GET /api/goals/null 404 14.322 ms - 53
 PASS  Testes/2-features/goals.test.js
  5. MÃ³dulo de Metas (CRUD)
    âˆš deve CRIAR uma nova meta com sucesso (64 ms)
    âˆš deve LISTAR as metas do usuÃ¡rio logado (29 ms)
    âˆš deve ATUALIZAR uma meta existente (64 ms)
    âˆš deve EXCLUIR uma meta existente (93 ms)

POST /api/transactions 201 45.303 ms - 467
[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 69172cbc0ad9206dc6b1c5b3
POST /api/transactions 400 13.960 ms - 277
[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 69172cbc0ad9206dc6b1c5b3
GET /api/transactions 200 25.440 ms - 854
GET /api/transactions/69172cbd0ad9206dc6b1c5ef 200 37.006 ms - 451
PUT /api/transactions/69172cbd0ad9206dc6b1c5ef 200 57.345 ms - 452
[LOG] AÃ§Ã£o: UPDATE_TRANSACTION | UsuÃ¡rio: 69172cbc0ad9206dc6b1c5b3
DELETE /api/transactions/69172cbd0ad9206dc6b1c5ef 200 57.274 ms - 73
[LOG] AÃ§Ã£o: DELETE_TRANSACTION | UsuÃ¡rio: 69172cbc0ad9206dc6b1c5b3
GET /api/transactions/69172cbd0ad9206dc6b1c5ef 404 37.536 ms - 71
 PASS  Testes/2-features/transactions.test.js
  4. MÃ³dulo de TransaÃ§Ãµes (CRUD)
    âˆš deve CRIAR uma nova transaÃ§Ã£o com sucesso (56 ms)
    âˆš deve falhar ao tentar criar uma transaÃ§Ã£o com dados invÃ¡lidos (31 ms)
    âˆš deve LISTAR as transaÃ§Ãµes do usuÃ¡rio logado (30 ms)
    âˆš deve OBTER uma transaÃ§Ã£o especÃ­fica pelo ID (40 ms)
    âˆš deve ATUALIZAR uma transaÃ§Ã£o existente (62 ms)
    âˆš deve EXCLUIR uma transaÃ§Ã£o existente (103 ms)

POST /api/transactions 201 44.584 ms - 446
[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 69172cbc0ad9206dc6b1c5b3
POST /api/transactions/69172cbe0ad9206dc6b1c610/upload 200 63.621 ms - 514
[LOG] AÃ§Ã£o: UPLOAD_ATTACHMENT | UsuÃ¡rio: 69172cbc0ad9206dc6b1c5b3
DELETE /api/transactions/69172cbe0ad9206dc6b1c610/upload 200 54.551 ms - 442
[LOG] AÃ§Ã£o: DELETE_ATTACHMENT | UsuÃ¡rio: 69172cbc0ad9206dc6b1c5b3
DELETE /api/transactions/69172cbe0ad9206dc6b1c610 200 59.257 ms - 73
[LOG] AÃ§Ã£o: DELETE_TRANSACTION | UsuÃ¡rio: 69172cbc0ad9206dc6b1c5b3
POST /api/transactions 201 45.511 ms - 444
[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 69172cbc0ad9206dc6b1c5b3
POST /api/transactions/69172cbe0ad9206dc6b1c62a/upload 200 56.006 ms - 512
[LOG] AÃ§Ã£o: UPLOAD_ATTACHMENT | UsuÃ¡rio: 69172cbc0ad9206dc6b1c5b3
DELETE /api/transactions/69172cbe0ad9206dc6b1c62a/upload 200 53.918 ms - 440
[LOG] AÃ§Ã£o: DELETE_ATTACHMENT | UsuÃ¡rio: 69172cbc0ad9206dc6b1c5b3
DELETE /api/transactions/69172cbe0ad9206dc6b1c62a 200 56.037 ms - 73
[LOG] AÃ§Ã£o: DELETE_TRANSACTION | UsuÃ¡rio: 69172cbc0ad9206dc6b1c5b3
POST /api/transactions 201 43.729 ms - 444
[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 69172cbc0ad9206dc6b1c5b3
POST /api/transactions/69172cbe0ad9206dc6b1c644/upload 200 55.845 ms - 512
[LOG] AÃ§Ã£o: UPLOAD_ATTACHMENT | UsuÃ¡rio: 69172cbc0ad9206dc6b1c5b3
DELETE /api/transactions/69172cbe0ad9206dc6b1c644/upload 200 53.341 ms - 440
[LOG] AÃ§Ã£o: DELETE_ATTACHMENT | UsuÃ¡rio: 69172cbc0ad9206dc6b1c5b3
DELETE /api/transactions/69172cbe0ad9206dc6b1c644 200 59.274 ms - 73
[LOG] AÃ§Ã£o: DELETE_TRANSACTION | UsuÃ¡rio: 69172cbc0ad9206dc6b1c5b3
POST /api/transactions 201 45.267 ms - 445
[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 69172cbc0ad9206dc6b1c5b3
POST /api/transactions/69172cbf0ad9206dc6b1c65e/upload 200 53.905 ms - 514
[LOG] AÃ§Ã£o: UPLOAD_ATTACHMENT | UsuÃ¡rio: 69172cbc0ad9206dc6b1c5b3
DELETE /api/transactions/69172cbf0ad9206dc6b1c65e/upload 200 54.124 ms - 441
[LOG] AÃ§Ã£o: DELETE_ATTACHMENT | UsuÃ¡rio: 69172cbc0ad9206dc6b1c5b3
DELETE /api/transactions/69172cbf0ad9206dc6b1c65e 200 57.366 ms - 73
[LOG] AÃ§Ã£o: DELETE_TRANSACTION | UsuÃ¡rio: 69172cbc0ad9206dc6b1c5b3
POST /api/transactions/60d5f1f77c3d4a001f5e8e1z/upload 404 13.229 ms - 53
 PASS  Testes/2-features/uploads.test.js
  Feature: Uploads
    Upload de PDF
      âˆš Deve permitir o upload de um anexo (PDF) para uma transaÃ§Ã£o (71 ms)
      âˆš Deve permitir a exclusÃ£o de um anexo (PDF) de uma transaÃ§Ã£o (59 ms)
    Upload de Imagem (PNG)
      âˆš Deve permitir o upload de um anexo de imagem (.png) para uma transaÃ§Ã£o (61 ms)
      âˆš Deve permitir a exclusÃ£o de um anexo de imagem (.png) (58 ms)
    Upload de Imagem (JPG)
      âˆš Deve permitir o upload de um anexo de imagem (.jpg) para uma transaÃ§Ã£o (60 ms)
      âˆš Deve permitir a exclusÃ£o de um anexo de imagem (.jpg) (59 ms)
    Upload de Imagem (JPEG)
      âˆš Deve permitir o upload de um anexo de imagem (.jpeg) para uma transaÃ§Ã£o (60 ms)
      âˆš Deve permitir a exclusÃ£o de um anexo de imagem (.jpeg) (58 ms)
    CenÃ¡rios de Erro e Estruturais
      âˆš Deve retornar 404 ao tentar fazer upload para uma transaÃ§Ã£o inexistente (31 ms)

  console.log

    --- Configurando 3 empresas para o teste multi-tenant ---

      at Object.log (Testes/3-security/multi-tenant.test.js:35:17)

POST /api/auth/register 201 146.368 ms - 354
[LOG] AÃ§Ã£o: REGISTER_COMPANY_USER | UsuÃ¡rio: N/A
POST /api/auth/login 200 119.575 ms - 698
  console.log
    âœ… Empresa 1 (Empresa Teste 1763127689522) cadastrada e logada.

      at Object.log (Testes/3-security/multi-tenant.test.js:64:21)

[LOG] AÃ§Ã£o: LOGIN_USER | UsuÃ¡rio: N/A
 FAIL  Testes/3-security/persistence.test.js
  â— Test suite failed to run

    ReferenceError: jest is not defined

      24 | describe('Security: PersistÃªncia de Dados Manuais', () => {
      25 |     // Aumenta o timeout padrÃ£o do Jest, pois este teste executa outros processos.
    > 26 |     jest.setTimeout(60000); // 60 segundos
         |     ^
      27 |
      28 |     it('deve garantir que os usuÃ¡rios de teste manuais permaneÃ§am no banco apÃ³s a execuÃ§Ã£o de `npm test`', async () => {
      29 |         const manualTestEmails = [

      at jest (Testes/3-security/persistence.test.js:26:5)
      at describe (Testes/3-security/persistence.test.js:24:1)

POST /api/auth/register 201 155.905 ms - 354
[LOG] AÃ§Ã£o: REGISTER_COMPANY_USER | UsuÃ¡rio: N/A
POST /api/auth/login 200 94.127 ms - 698
  console.log
    âœ… Empresa 2 (Empresa Teste 1763127689860) cadastrada e logada.

      at Object.log (Testes/3-security/multi-tenant.test.js:64:21)

[LOG] AÃ§Ã£o: LOGIN_USER | UsuÃ¡rio: N/A
POST /api/auth/register 201 140.108 ms - 354
[LOG] AÃ§Ã£o: REGISTER_COMPANY_USER | UsuÃ¡rio: N/A
POST /api/auth/login 200 98.822 ms - 698
  console.log
    âœ… Empresa 3 (Empresa Teste 1763127690118) cadastrada e logada.

      at Object.log (Testes/3-security/multi-tenant.test.js:64:21)

  console.log
    --- ConfiguraÃ§Ã£o multi-tenant concluÃ­da ---

      at Object.log (Testes/3-security/multi-tenant.test.js:66:17)

  console.log

    --- Criando transaÃ§Ãµes individuais para cada empresa ---

      at Object.log (Testes/3-security/multi-tenant.test.js:71:17)

[LOG] AÃ§Ã£o: LOGIN_USER | UsuÃ¡rio: N/A
POST /api/transactions 201 49.967 ms - 437
[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 69173189108c25a39a5731f2
  console.log
    TransaÃ§Ã£o criada para Empresa Teste 1763127689522. ID: 6917318a108c25a39a573218

      at Object.log (Testes/3-security/multi-tenant.test.js:92:21)

[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 69173189108c25a39a5731f2
POST /api/transactions 201 45.046 ms - 436
[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 6917318a108c25a39a573200
  console.log
    TransaÃ§Ã£o criada para Empresa Teste 1763127689860. ID: 6917318a108c25a39a57321f

      at Object.log (Testes/3-security/multi-tenant.test.js:92:21)

[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 6917318a108c25a39a573200
POST /api/transactions 201 47.007 ms - 429
[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 6917318a108c25a39a57320e
  console.log
    TransaÃ§Ã£o criada para Empresa Teste 1763127690118. ID: 6917318a108c25a39a573226

      at Object.log (Testes/3-security/multi-tenant.test.js:92:21)

  console.log

    --- Validando isolamento de dados entre todas as empresas ---

      at Object.log (Testes/3-security/multi-tenant.test.js:98:17)

  console.log

    Verificando a transaÃ§Ã£o 6917318a108c25a39a573218 da Empresa Teste 1763127689522

      at Object.log (Testes/3-security/multi-tenant.test.js:105:21)

[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 6917318a108c25a39a57320e
GET /api/transactions/6917318a108c25a39a573218 404 27.454 ms - 38
  console.log
    - OK: Empresa Teste 1763127689860 foi bloqueada (Status 404).

      at Object.log (Testes/3-security/multi-tenant.test.js:123:29)

GET /api/transactions/6917318a108c25a39a573218 404 25.821 ms - 38
  console.log
    - OK: Empresa Teste 1763127690118 foi bloqueada (Status 404).

      at Object.log (Testes/3-security/multi-tenant.test.js:123:29)

  console.log

    Verificando a transaÃ§Ã£o 6917318a108c25a39a57321f da Empresa Teste 1763127689860

      at Object.log (Testes/3-security/multi-tenant.test.js:105:21)

GET /api/transactions/6917318a108c25a39a57321f 404 25.126 ms - 38
  console.log
    - OK: Empresa Teste 1763127689522 foi bloqueada (Status 404).

      at Object.log (Testes/3-security/multi-tenant.test.js:123:29)

GET /api/transactions/6917318a108c25a39a57321f 404 25.364 ms - 38
  console.log
    - OK: Empresa Teste 1763127690118 foi bloqueada (Status 404).

      at Object.log (Testes/3-security/multi-tenant.test.js:123:29)

  console.log

    Verificando a transaÃ§Ã£o 6917318a108c25a39a573226 da Empresa Teste 1763127690118

      at Object.log (Testes/3-security/multi-tenant.test.js:105:21)

GET /api/transactions/6917318a108c25a39a573226 404 26.070 ms - 38
  console.log
    - OK: Empresa Teste 1763127689522 foi bloqueada (Status 404).

      at Object.log (Testes/3-security/multi-tenant.test.js:123:29)

GET /api/transactions/6917318a108c25a39a573226 404 25.497 ms - 38
  console.log
    - OK: Empresa Teste 1763127689860 foi bloqueada (Status 404).

      at Object.log (Testes/3-security/multi-tenant.test.js:123:29)

  console.log

    --- Validando listagem de transaÃ§Ãµes ---

      at Object.log (Testes/3-security/multi-tenant.test.js:130:17)

GET /api/transactions 200 29.043 ms - 423
  console.log
    - OK: Empresa Teste 1763127689522 listou apenas sua prÃ³pria transaÃ§Ã£o.

      at Object.log (Testes/3-security/multi-tenant.test.js:142:21)

GET /api/transactions 200 25.527 ms - 422
  console.log
    - OK: Empresa Teste 1763127689860 listou apenas sua prÃ³pria transaÃ§Ã£o.

      at Object.log (Testes/3-security/multi-tenant.test.js:142:21)

GET /api/transactions 200 26.520 ms - 415
  console.log
    - OK: Empresa Teste 1763127690118 listou apenas sua prÃ³pria transaÃ§Ã£o.

      at Object.log (Testes/3-security/multi-tenant.test.js:142:21)

  console.log

    --- Limpando dados de teste (Teardown) ---

      at Object.log (Testes/3-security/multi-tenant.js:148:17)

DELETE /api/auth/users/69173189108c25a39a5731f2 200 73.730 ms - 107
  console.log
    - âœ… Empresa Empresa Teste 1763127689522 e dados associados excluÃ­dos com sucesso.

      at Object.log (Testes/3-security/multi-tenant.test.js:155:25)

[LOG] AÃ§Ã£o: DELETE_USER_BY_ID | UsuÃ¡rio: 69173189108c25a39a5731f2
DELETE /api/auth/users/6917318a108c25a39a573200 200 75.348 ms - 107
  console.log
    - âœ… Empresa Empresa Teste 1763127689860 e dados associados excluÃ­dos com sucesso.

      at Object.log (Testes/3-security/multi-tenant.test.js:155:25)

[LOG] AÃ§Ã£o: DELETE_USER_BY_ID | UsuÃ¡rio: 6917318a108c25a39a573200
DELETE /api/auth/users/6917318a108c25a39a57320e 200 70.964 ms - 107
  console.log
    - âœ… Empresa Empresa Teste 1763127690118 e dados associados excluÃ­dos com sucesso.

      at Object.log (Testes/3-security/multi-tenant.test.js:155:25)

 PASS  Testes/3-security/multi-tenant.test.js
  3. Teste de Isolamento de Dados (Multi-Tenant)
    âˆš deve criar uma transaÃ§Ã£o para cada empresa (169 ms)
    âˆš deve impedir que uma empresa acesse a transaÃ§Ã£o de outra (198 ms)
    âˆš deve garantir que cada empresa liste apenas suas prÃ³prias transaÃ§Ãµes (92 ms)

[LOG] AÃ§Ã£o: DELETE_USER_BY_ID | UsuÃ¡rio: 6917318a108c25a39a57320e
 FAIL  Testes/4-reports/reports.test.js
  â— Test suite failed to run

    ReferenceError: jest is not defined

      21 | // Mocking o mÃ³dulo de serviÃ§o de PDF antes de qualquer importaÃ§Ã£o.
      22 | // Isso Ã© crucial para que o Jest possa interceptar as chamadas Ã s funÃ§Ãµes de geraÃ§Ã£o de PDF.
    > 23 | jest.unstable_mockModule('../../services/pdfService.js', () => ({
         | ^
      24 |   generateFinancialReportPDF: jest.fn(),
      25 |   generateClientsReportPDF: jest.fn(),
      26 |   generateInvoicePDF: jest.fn(),

      at jest (Testes/4-reports/reports.test.js:23:1)

Test Suites: 4 failed, 5 passed, 9 total
Tests:       4 failed, 27 passed, 31 total
Snapshots:   0 total
Time:        3.849 s
Ran all test suites.

--- ðŸ§¹ [GLOBAL TEARDOWN] Finalizando ambiente de teste ---
   - [OK] Dados de teste temporÃ¡rios foram removidos.
âœ… Servidor e conexÃ£o com MongoDB encerrados (stopServer).
--- âœ… [GLOBAL TEARDOWN] Ambiente finalizado com sucesso ---