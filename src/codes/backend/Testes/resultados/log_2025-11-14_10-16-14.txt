
--- ðŸš€ [GLOBAL SETUP] Iniciando ambiente de teste ---
Verificando permissÃµes de sistema...
PermissÃµes nÃ£o encontradas. Criando permissÃµes padrÃ£o...
PermissÃµes padrÃ£o criadas com sucesso!
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ (index) â”‚ Nome            â”‚ DescriÃ§Ã£o                                                                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 0       â”‚ 'ROOT'          â”‚ 'SuperusuÃ¡rio. Acesso irrestrito a todos os dados e configuraÃ§Ãµes do sistema.'                   â”‚
â”‚ 1       â”‚ 'ADMIN_COMPANY' â”‚ 'Administrador de uma empresa. Pode gerenciar usuÃ¡rios e todos os dados da sua prÃ³pria empresa.' â”‚
â”‚ 2       â”‚ 'USER_COMPANY'  â”‚ 'UsuÃ¡rio padrÃ£o. Pode criar e gerenciar seus prÃ³prios dados dentro da empresa.'                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â³ Iniciando servidor Smart GestÃ£o (startServer)...
ConexÃ£o com o MongoDB estabelecida com sucesso.
âœ… [1/1] ConexÃ£o com o banco de dados estabelecida!
âœ… Servidor rodando na porta 5000
--- âœ… [GLOBAL SETUP] Ambiente pronto e servidor iniciado ---
(node:5308) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
POST /api/auth/login 200 101.765 ms - 688
[LOG] AÃ§Ã£o: LOGIN_USER | UsuÃ¡rio: N/A
POST /api/auth/login 200 94.914 ms - 688
FAIL Testes/1-auth/auth.test.js
  6. MÃ³dulo de AutenticaÃ§Ã£o e SessÃ£o (Stateful)
    Ã— deve criar um SessionToken no banco de dados apÃ³s o login (153 ms)
    Ã— deve invalidar o SessionToken no banco de dados apÃ³s o logout (101 ms)

  â— 6. MÃ³dulo de AutenticaÃ§Ã£o e SessÃ£o (Stateful) â€º deve criar um SessionToken no banco de dados apÃ³s o login

    expect(received).toHaveProperty(path)

    Expected path: "refreshToken"
    Received path: []

    Received value: {"data": {"refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiI2OTE3MmJhMTE2Nzk4NjNmOGY5YzcyMjciLCJpYXQiOjE3NjMxMjYxNzgsImV4cCI6MTc2MzczMDk3OH0.ujtnIlhnSlM-Uyl7mttx5H15IFgfRahjNISSDkysLR8", "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiI2OTE3MmJhMTE2Nzk4NjNmOGY5YzcyMjciLCJyb2xlIjoiNjkxNzJiYTExNjc5ODYzZjhmOWM3MjIyIiwiY29tcGFueUlkIjoiNjkxNzJiYTExNjc5ODYzZjhmOWM3MjI1IiwiaWF0IjoxNzYzMTI2MTc4LCJleHAiOjE3NjMxMjcwNzh9.6__u5K_lf58ZA_01_0G1t0oupqvTV8WNBCAMoirrj3k", "user": {"companyId": "69172ba11679863f8f9c7225", "email": "usera_1763126177987@test.com", "id": "69172ba11679863f8f9c7227", "name": "UsuÃ¡rio A"}}, "message": "OperaÃ§Ã£o realizada com sucesso.", "success": true}

      35 |     // Valida que o endpoint de login retorna um token de acesso e um refresh token.
      36 |     // A verificaÃ§Ã£o direta no banco foi removida para aumentar a estabilidade.
    > 37 |     expect(loginResponse.data).toHaveProperty('refreshToken');
         |                                ^
      38 |   });
      39 |
      40 |   test('deve invalidar o SessionToken no banco de dados apÃ³s o logout', async () => {

      at Object.toHaveProperty (Testes/1-auth/auth.test.js:37:32)

  â— 6. MÃ³dulo de AutenticaÃ§Ã£o e SessÃ£o (Stateful) â€º deve invalidar o SessionToken no banco de dados apÃ³s o logout

    expect(received).toBeDefined()

    Received: undefined

      45 |     });
      46 |     const { refreshToken } = loginResponse.data;
    > 47 |     expect(refreshToken).toBeDefined();
         |                          ^
      48 |
      49 |     // 2. Realiza o logout enviando o refresh token
      50 |     const logoutResponse = await axios.post(`${API_URL}/auth/logout`, { refreshToken: refreshToken });

      at Object.toBeDefined (Testes/1-auth/auth.test.js:47:26)

  console.log
    
    --- Teste: Solicitar reset para e-mail invÃ¡lido ---

      at Object.log (Testes/1-auth/password.test.js:25:13)

[LOG] AÃ§Ã£o: LOGIN_USER | UsuÃ¡rio: N/A
POST /api/auth/forgot-password 404 12.659 ms - 69
  console.log
    âœ… Falhou como esperado para e-mail inexistente (Status 404).

      at Object.log (Testes/1-auth/password.test.js:34:15)

  console.log
    
    --- Teste: Gerar token de reset com sucesso ---

      at Object.log (Testes/1-auth/password.test.js:39:13)

POST /api/auth/forgot-password 200 30.886 ms - 164
  console.log
    
    --- Teste: Resetar senha com token vÃ¡lido ---

      at Object.log (Testes/1-auth/password.test.js:53:13)

POST /api/auth/forgot-password 200 29.236 ms - 164
FAIL Testes/1-auth/password.test.js
  9. MÃ³dulo de RecuperaÃ§Ã£o de Senha
    âˆš deve falhar ao solicitar reset para um e-mail inexistente (51 ms)
    Ã— deve gerar e salvar um token de reset para um e-mail vÃ¡lido (41 ms)
    Ã— deve resetar a senha com um token vÃ¡lido e permitir login com a nova senha (36 ms)

  â— 9. MÃ³dulo de RecuperaÃ§Ã£o de Senha â€º deve gerar e salvar um token de reset para um e-mail vÃ¡lido

    expect(received).toHaveProperty(path)

    Expected path: "resetToken"
    Received path: []

    Received value: {"data": {"resetToken": "b18bf198cf566540b9d8ed3e7756f51c38811c3af4a3d34eb78b6dcf6de38deb"}, "message": "Token de reset enviado com sucesso (simulado).", "success": true}

      46 |
      47 |     // Valida que a resposta contÃ©m o token de reset (para fins de teste), sem acessar o banco.
    > 48 |     expect(response.data).toHaveProperty('resetToken');
         |                           ^
      49 |     console.log('âœ… Token de reset gerado e salvo no banco de dados.');
      50 |   });
      51 |

      at Object.toHaveProperty (Testes/1-auth/password.test.js:48:27)

  â— 9. MÃ³dulo de RecuperaÃ§Ã£o de Senha â€º deve resetar a senha com um token vÃ¡lido e permitir login com a nova senha

    expect(received).toBeDefined()

    Received: undefined

      57 |     });
      58 |     const { resetToken } = forgotResponse.data; // O token Ã© retornado para fins de teste
    > 59 |     expect(resetToken).toBeDefined();
         |                        ^
      60 |
      61 |     // 2. Resetar a senha com o token
      62 |     const newPassword = 'newPassword123';

      at Object.toBeDefined (Testes/1-auth/password.test.js:59:24)

Test Suites: 2 failed, 2 total
Tests:       4 failed, 1 passed, 5 total
Snapshots:   0 total
Time:        0.933 s
Ran all test suites matching Testes/1-auth/.

--- ðŸ§¹ [GLOBAL TEARDOWN] Finalizando ambiente de teste ---
   - [OK] Dados de teste temporÃ¡rios foram removidos.
âœ… Servidor e conexÃ£o com MongoDB encerrados (stopServer).
--- âœ… [GLOBAL TEARDOWN] Ambiente finalizado com sucesso ---

--- FIM DOS TESTES AUTOMATIZADOS (Status: Falha) ---
