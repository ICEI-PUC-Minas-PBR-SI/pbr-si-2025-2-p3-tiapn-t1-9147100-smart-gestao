  console.log
    
    --- Configurando Empresa A ---

      at Object.log (Testes/isolamento.test.js:43:17)

(node:32624) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
  console.log
    Empresa A configurada e logada.

      at Object.log (Testes/isolamento.test.js:56:17)

  console.log
    
    --- Configurando Empresa B ---

      at Object.log (Testes/isolamento.test.js:59:17)

  console.log
    Empresa B - Cadastro (Status): 201

      at Object.log (Testes/isolamento.test.js:68:17)

  console.log
    Empresa B - Cadastro (Corpo): {
      "message": "Usuário cadastrado com sucesso!"
    }

      at Object.log (Testes/isolamento.test.js:69:17)

  console.log
    Empresa B configurada e logada.

      at Object.log (Testes/isolamento.test.js:79:17)

  console.log
    
    --- Criando transação para Empresa A ---

      at Object.log (Testes/isolamento.test.js:85:17)

  console.log
    
    --- Tentando modificar transação da Empresa A com token da Empresa B ---

      at Object.log (Testes/isolamento.test.js:125:17)

  console.log
    Enviando: PUT para http://localhost:5000/api/transactions/undefined com token da Empresa B

      at Object.log (Testes/isolamento.test.js:127:17)

  console.log
    Dados da atualização: {
      "description": "Tentativa de Modificação pela Empresa B",
      "amount": 999
    }

      at Object.log (Testes/isolamento.test.js:128:17)

  console.log
    Empresa B - Modificar Transação (Status): 500

      at Object.log (Testes/isolamento.test.js:136:21)

  console.log
    Empresa B - Modificar Transação (Corpo): {
      "message": "Erro ao atualizar transaction",
      "error": "Cast to ObjectId failed for value \"undefined\" (type string) at path \"_id\" for model \"Transaction\""
    }

      at Object.log (Testes/isolamento.test.js:137:21)

  console.log
    
    --- Tentando excluir transação da Empresa A com token da Empresa B ---

      at Object.log (Testes/isolamento.test.js:145:17)

  console.log
    Enviando: DELETE para http://localhost:5000/api/transactions/undefined com token da Empresa B

      at Object.log (Testes/isolamento.test.js:146:17)

  console.log
    Empresa B - Excluir Transação (Status): 500

      at Object.log (Testes/isolamento.test.js:154:21)

  console.log
    Empresa B - Excluir Transação (Corpo): {
      "message": "Erro ao remover transaction",
      "error": "Cast to ObjectId failed for value \"undefined\" (type string) at path \"_id\" for model \"Transaction\""
    }

      at Object.log (Testes/isolamento.test.js:155:21)

  console.log
    
    --- Tentando listar transações com token da Empresa B ---

      at Object.log (Testes/isolamento.test.js:163:17)

  console.log
    Enviando: GET para http://localhost:5000/api/transactions com token da Empresa B

      at Object.log (Testes/isolamento.test.js:164:17)

  console.log
    Empresa B - Listar Transações (Status): 200

      at Object.log (Testes/isolamento.test.js:172:17)

  console.log
    Empresa B - Listar Transações (Corpo): []

      at Object.log (Testes/isolamento.test.js:173:17)

FAIL Testes/isolamento.test.js
  2. Teste de Isolamento de Dados (Transações)
    × deve impedir que a Empresa B acesse transações da Empresa A (60 ms)
    × deve impedir que a Empresa B modifique transações da Empresa A (94 ms)
    × deve impedir que a Empresa B exclua transações da Empresa A (103 ms)
    √ deve impedir que a Empresa B liste todas as transações da Empresa A (69 ms)

  ● 2. Teste de Isolamento de Dados (Transações) › deve impedir que a Empresa B acesse transações da Empresa A

    AxiosError: Request failed with status code 500

      84 |         // (Este passo depende de você ter um endpoint para criar transações)
      85 |         console.log('\n--- Criando transação para Empresa A ---');
    > 86 |         const createTransaction = await axios.post(`${API_URL}/transactions`, {
         |                                   ^
      87 |             description: 'Transação de Teste Empresa A',
      88 |             amount: 100
      89 |         }, {

      at settle (node_modules/axios/lib/core/settle.js:19:12)
      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:793:11)
      at Axios.request (node_modules/axios/lib/core/Axios.js:45:41)
      at Object.<anonymous> (Testes/isolamento.test.js:86:35)

  ● 2. Teste de Isolamento de Dados (Transações) › deve impedir que a Empresa B modifique transações da Empresa A

    expect(received).toContain(expected) // indexOf

    Expected value: 500
    Received array: [401, 403, 404]

      137 |             console.log('Empresa B - Modificar Transação (Corpo):', error.response ? JSON.stringify(error.response.data, null, 2) : error.message);
      138 |             expect(error.response.status).not.toBe(200); // Garante que não foi sucesso (200 OK)
    > 139 |             expect([401, 403, 404]).toContain(error.response.status);
          |                                     ^
      140 |         }
      141 |     });
      142 |

      at Object.toContain (Testes/isolamento.test.js:139:37)

  ● 2. Teste de Isolamento de Dados (Transações) › deve impedir que a Empresa B exclua transações da Empresa A

    expect(received).toContain(expected) // indexOf

    Expected value: 500
    Received array: [401, 403, 404]

      155 |             console.log('Empresa B - Excluir Transação (Corpo):', error.response ? JSON.stringify(error.response.data, null, 2) : error.message);
      156 |             expect(error.response.status).not.toBe(200); // Garante que não foi sucesso (200 OK)
    > 157 |             expect([401, 403, 404]).toContain(error.response.status);
          |                                     ^
      158 |         }
      159 |     });
      160 |

      at Object.toContain (Testes/isolamento.test.js:157:37)

  console.log
    
    --- Teste: Cadastrar novo usuário ---

      at Object.log (Testes/api.test.js:50:17)

  console.log
    Enviando: {
      "name": "Usuário A",
      "email": "empresaA_1762380565986@test.com",
      "password": "password123",
      "companyName": "Empresa A Teste 1762380565986",
      "cnpj": "01762380565986"
    }

      at Object.log (Testes/api.test.js:51:17)

  console.log
    Recebido (Status): 201

      at Object.log (Testes/api.test.js:56:21)

  console.log
    Recebido (Corpo): {
      "message": "Usuário cadastrado com sucesso!"
    }

      at Object.log (Testes/api.test.js:57:21)

  console.log
    
    --- Teste: Barrar e-mail duplicado ---

      at Object.log (Testes/api.test.js:79:17)

  console.log
    Enviando: {
      "name": "Usuário A",
      "email": "empresaA_1762380565986@test.com",
      "password": "password123",
      "companyName": "Nome Duplicado",
      "cnpj": "11223344556677"
    }

      at Object.log (Testes/api.test.js:80:17)

  console.log
    Recebido (Status): 409

      at Object.log (Testes/api.test.js:86:21)

  console.log
    Recebido (Corpo): {
      "message": "E-mail já cadastrado."
    }

      at Object.log (Testes/api.test.js:87:21)

  console.log
    
    --- Teste: Login com senha incorreta ---

      at Object.log (Testes/api.test.js:101:17)

  console.log
    Enviando: {
      "email": "empresaA_1762380565986@test.com",
      "password": "senha-errada"
    }

      at Object.log (Testes/api.test.js:102:17)

  console.log
    Recebido (Status): 401

      at Object.log (Testes/api.test.js:107:21)

  console.log
    Recebido (Corpo): {
      "message": "Credenciais inválidas."
    }

      at Object.log (Testes/api.test.js:108:21)

  console.log
    
    --- Teste: Login com sucesso ---

      at Object.log (Testes/api.test.js:122:17)

  console.log
    Enviando: {
      "email": "empresaA_1762380565986@test.com",
      "password": "password123"
    }

      at Object.log (Testes/api.test.js:123:17)

  console.log
    Recebido (Status): 200

      at Object.log (Testes/api.test.js:127:17)

  console.log
    Recebido (Corpo): {
      "user": {
        "name": "Usuário A",
        "email": "empresaa_1762380565986@test.com"
      },
      "message": "Tokens recebidos"
    }

      at Object.log (Testes/api.test.js:128:17)

  console.log
    
    --- Teste: Acesso a rota protegida sem token ---

      at Object.log (Testes/api.test.js:141:17)

  console.log
    Enviando: GET para http://localhost:5000/api/transactions

      at Object.log (Testes/api.test.js:142:17)

  console.log
    Recebido (Status): 401

      at Object.log (Testes/api.test.js:148:21)

  console.log
    Recebido (Corpo): {
      "message": "Token ausente ou formato inválido"
    }

      at Object.log (Testes/api.test.js:149:21)

PASS Testes/api.test.js
  1. Módulo de Autenticação
    √ RF-001: deve cadastrar um novo usuário e empresa (Empresa A) (243 ms)
    √ deve barrar o cadastro de um usuário com e-mail já existente (46 ms)
    √ deve falhar o login com senha incorreta (101 ms)
    √ deve realizar o login com sucesso para a Empresa A (132 ms)
    √ deve proteger rotas, barrando acesso sem token (10 ms)

----------|---------|----------|---------|---------|-------------------
File      | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s 
----------|---------|----------|---------|---------|-------------------
All files |       0 |        0 |       0 |       0 |                   
----------|---------|----------|---------|---------|-------------------
Test Suites: 1 failed, 1 passed, 2 total
Tests:       3 failed, 6 passed, 9 total
Snapshots:   0 total
Time:        4.014 s
Ran all test suites.
