
--- üöÄ [GLOBAL SETUP] Iniciando ambiente de teste ---
‚è≥ Iniciando servidor Smart Gest√£o (startServer)...
Conex√£o com o MongoDB estabelecida com sucesso.
‚úÖ [1/1] Conex√£o com o banco de dados estabelecida!
‚ö†Ô∏è  Aviso: Porta 5000 est√° em uso. Tentando porta 5001...
‚úÖ Servidor rodando na porta 5001
Verificando permiss√µes de sistema...
Permiss√µes de sistema j√° existem. Nenhuma a√ß√£o necess√°ria.
--- ‚úÖ [GLOBAL SETUP] Ambiente pronto e servidor iniciado ---
(node:8536) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
POST /api/auth/login 200 688 - 118.700 ms
[LOG] A√ß√£o: LOGIN_USER | Usu√°rio: N/A
POST /api/auth/login 200 688 - 110.658 ms
[LOG] A√ß√£o: LOGIN_USER | Usu√°rio: N/A
POST /api/auth/logout 200 108 - 20.918 ms
PASS Testes/1-auth/auth.test.js
  6. M√≥dulo de Autentica√ß√£o e Sess√£o (Stateful)
    ‚àö deve criar um SessionToken no banco de dados ap√≥s o login (226 ms)
    ‚àö deve invalidar o SessionToken no banco de dados ap√≥s o logout (143 ms)

  console.log
    
    --- Teste: Solicitar reset para e-mail inv√°lido ---

      at Object.<anonymous> (Testes/1-auth/password.test.js:33:13)

[LOG] A√ß√£o: LOGOUT_USER | Usu√°rio: N/A
POST /api/auth/forgot-password 404 69 - 14.247 ms
  console.log
    ‚úÖ Falhou como esperado para e-mail inexistente (Status 404).

      at Object.<anonymous> (Testes/1-auth/password.test.js:42:15)

  console.log
    
    --- Teste: Gerar token de reset com sucesso ---

      at Object.<anonymous> (Testes/1-auth/password.test.js:51:13)

POST /api/auth/forgot-password 200 164 - 35.661 ms
  console.log
    ‚úÖ Token de reset gerado e salvo no banco de dados.

      at Object.<anonymous> (Testes/1-auth/password.test.js:61:13)

  console.log
    
    --- Teste: Resetar senha com token v√°lido ---

      at Object.<anonymous> (Testes/1-auth/password.test.js:70:13)

POST /api/auth/forgot-password 200 164 - 32.530 ms
POST /api/auth/reset-password/ba7936eb172458d8883ebdc851627bbc315ca93a18690020379d363fabb52766 200 68 - 133.012 ms
  console.log
    ‚úÖ Senha resetada com sucesso via API.

      at Object.<anonymous> (Testes/1-auth/password.test.js:87:13)

POST /api/auth/reset-password/ba7936eb172458d8883ebdc851627bbc315ca93a18690020379d363fabb52766 400 72 - 14.278 ms
  console.log
    ‚úÖ Token de reset foi invalidado no banco.

      at Object.<anonymous> (Testes/1-auth/password.test.js:91:13)

POST /api/auth/login 200 688 - 117.528 ms
  console.log
    ‚úÖ Login com a nova senha realizado com sucesso.

      at Object.<anonymous> (Testes/1-auth/password.test.js:101:13)

PASS Testes/1-auth/password.test.js
  9. M√≥dulo de Recupera√ß√£o de Senha
    ‚àö deve falhar ao solicitar reset para um e-mail inexistente (49 ms)
    ‚àö deve gerar e salvar um token de reset para um e-mail v√°lido (43 ms)
    ‚àö deve resetar a senha com um token v√°lido e permitir login com a nova senha (316 ms)

[LOG] A√ß√£o: LOGIN_USER | Usu√°rio: N/A
[LOG] A√ß√£o: CREATE_GOAL | Usu√°rio: 691f206abb1085a3fbaeedae
POST /api/goals 201 455 - 58.556 ms
[LOG] A√ß√£o: CREATE_GOAL | Usu√°rio: 691f206abb1085a3fbaeedae
[LOG] A√ß√£o: CREATE_TRANSACTION | Usu√°rio: 691f206abb1085a3fbaeedae
POST /api/transactions 201 448 - 76.869 ms
[LOG] A√ß√£o: CREATE_TRANSACTION | Usu√°rio: 691f206abb1085a3fbaeedae
GET /api/alerts 200 72 - 50.370 ms
[LOG] A√ß√£o: CREATE_TRANSACTION | Usu√°rio: 691f206abb1085a3fbaeedae
[LOG] A√ß√£o: AUTO_CREATE_ALERT | Usu√°rio: 691f206abb1085a3fbaeedae
POST /api/transactions 201 445 - 127.420 ms
[LOG] A√ß√£o: CREATE_TRANSACTION | Usu√°rio: 691f206abb1085a3fbaeedae
GET /api/alerts 200 419 - 44.226 ms
[LOG] A√ß√£o: CREATE_TRANSACTION | Usu√°rio: 691f206abb1085a3fbaeedae
POST /api/transactions 201 437 - 90.530 ms
[LOG] A√ß√£o: CREATE_TRANSACTION | Usu√°rio: 691f206abb1085a3fbaeedae
GET /api/alerts 200 419 - 27.785 ms
PASS Testes/2-features/alerts.test.js
  6. M√≥dulo de Alertas de Metas
    ‚àö RF-006: deve criar um alerta quando uma despesa ultrapassa a meta da categoria (505 ms)

POST /api/clients 201 329 - 30.817 ms
[LOG] A√ß√£o: CREATE_CLIENT | Usu√°rio: 691f206abb1085a3fbaeedae
GET /api/clients 200 570 - 26.829 ms
PUT /api/clients/691f206dbb1085a3fbaeee01 200 331 - 44.786 ms
[LOG] A√ß√£o: UPDATE_CLIENT | Usu√°rio: 691f206abb1085a3fbaeedae
DELETE /api/clients/691f206dbb1085a3fbaeee01 200 70 - 44.685 ms
PASS Testes/2-features/clients.test.js
  7. M√≥dulo de Clientes/Fornecedores
    ‚àö deve CRIAR um novo cliente com sucesso (42 ms)
    ‚àö deve LISTAR os clientes da empresa (29 ms)
    ‚àö deve ATUALIZAR um cliente existente (48 ms)
    ‚àö deve EXCLUIR um cliente existente (48 ms)

[LOG] A√ß√£o: DELETE_CLIENT | Usu√°rio: 691f206abb1085a3fbaeedae
[LOG] A√ß√£o: CREATE_GOAL | Usu√°rio: 691f206abb1085a3fbaeedae
POST /api/goals 201 404 - 49.054 ms
[LOG] A√ß√£o: CREATE_GOAL | Usu√°rio: 691f206abb1085a3fbaeedae
GET /api/goals 200 792 - 26.510 ms
[LOG] A√ß√£o: UPDATE_GOAL | Usu√°rio: 691f206abb1085a3fbaeedae
PUT /api/goals/691f206dbb1085a3fbaeee12 200 414 - 69.779 ms
[LOG] A√ß√£o: UPDATE_GOAL | Usu√°rio: 691f206abb1085a3fbaeedae
[LOG] A√ß√£o: DELETE_GOAL | Usu√°rio: 691f206abb1085a3fbaeedae
DELETE /api/goals/691f206dbb1085a3fbaeee12 200 67 - 66.817 ms
[LOG] A√ß√£o: DELETE_GOAL | Usu√°rio: 691f206abb1085a3fbaeedae
GET /api/goals/null 404 53 - 14.804 ms
PASS Testes/2-features/goals.test.js
  5. M√≥dulo de Metas (CRUD)
    ‚àö deve CRIAR uma nova meta com sucesso (62 ms)
    ‚àö deve LISTAR as metas do usu√°rio logado (29 ms)
    ‚àö deve ATUALIZAR uma meta existente (75 ms)
    ‚àö deve EXCLUIR uma meta existente (92 ms)

[LOG] A√ß√£o: CREATE_TRANSACTION | Usu√°rio: 691f206abb1085a3fbaeedae
POST /api/transactions 201 468 - 48.178 ms
[LOG] A√ß√£o: CREATE_TRANSACTION | Usu√°rio: 691f206abb1085a3fbaeedae
POST /api/transactions 400 277 - 14.441 ms
[LOG] A√ß√£o: CREATE_TRANSACTION | Usu√°rio: 691f206abb1085a3fbaeedae
GET /api/transactions 200 1930 - 26.950 ms
GET /api/transactions/691f206dbb1085a3fbaeee2a 200 452 - 57.416 ms
[LOG] A√ß√£o: UPDATE_TRANSACTION | Usu√°rio: 691f206abb1085a3fbaeedae
PUT /api/transactions/691f206dbb1085a3fbaeee2a 200 452 - 65.715 ms
[LOG] A√ß√£o: UPDATE_TRANSACTION | Usu√°rio: 691f206abb1085a3fbaeedae
[LOG] A√ß√£o: DELETE_TRANSACTION | Usu√°rio: 691f206abb1085a3fbaeedae
DELETE /api/transactions/691f206dbb1085a3fbaeee2a 200 73 - 65.313 ms
[LOG] A√ß√£o: DELETE_TRANSACTION | Usu√°rio: 691f206abb1085a3fbaeedae
GET /api/transactions/691f206dbb1085a3fbaeee2a 404 71 - 43.801 ms
PASS Testes/2-features/transactions.test.js
  4. M√≥dulo de Transa√ß√µes (CRUD)
    ‚àö deve CRIAR uma nova transa√ß√£o com sucesso (59 ms)
    ‚àö deve falhar ao tentar criar uma transa√ß√£o com dados inv√°lidos (19 ms)
    ‚àö deve LISTAR as transa√ß√µes do usu√°rio logado (30 ms)
    ‚àö deve OBTER uma transa√ß√£o espec√≠fica pelo ID (59 ms)
    ‚àö deve ATUALIZAR uma transa√ß√£o existente (71 ms)
    ‚àö deve EXCLUIR uma transa√ß√£o existente (120 ms)

[LOG] A√ß√£o: CREATE_TRANSACTION | Usu√°rio: 691f206abb1085a3fbaeedae
POST /api/transactions 201 446 - 47.245 ms
[LOG] A√ß√£o: CREATE_TRANSACTION | Usu√°rio: 691f206abb1085a3fbaeedae
POST /api/transactions/691f206ebb1085a3fbaeee4b/upload 200 514 - 66.976 ms
[LOG] A√ß√£o: UPLOAD_ATTACHMENT | Usu√°rio: 691f206abb1085a3fbaeedae
DELETE /api/transactions/691f206ebb1085a3fbaeee4b/upload 200 442 - 56.795 ms
[LOG] A√ß√£o: DELETE_ATTACHMENT | Usu√°rio: 691f206abb1085a3fbaeedae
[LOG] A√ß√£o: DELETE_TRANSACTION | Usu√°rio: 691f206abb1085a3fbaeedae
DELETE /api/transactions/691f206ebb1085a3fbaeee4b 200 73 - 64.459 ms
[LOG] A√ß√£o: DELETE_TRANSACTION | Usu√°rio: 691f206abb1085a3fbaeedae
[LOG] A√ß√£o: CREATE_TRANSACTION | Usu√°rio: 691f206abb1085a3fbaeedae
POST /api/transactions 201 444 - 61.342 ms
[LOG] A√ß√£o: CREATE_TRANSACTION | Usu√°rio: 691f206abb1085a3fbaeedae
POST /api/transactions/691f206ebb1085a3fbaeee65/upload 200 511 - 58.180 ms
[LOG] A√ß√£o: UPLOAD_ATTACHMENT | Usu√°rio: 691f206abb1085a3fbaeedae
DELETE /api/transactions/691f206ebb1085a3fbaeee65/upload 200 440 - 57.691 ms
[LOG] A√ß√£o: DELETE_ATTACHMENT | Usu√°rio: 691f206abb1085a3fbaeedae
[LOG] A√ß√£o: DELETE_TRANSACTION | Usu√°rio: 691f206abb1085a3fbaeedae
DELETE /api/transactions/691f206ebb1085a3fbaeee65 200 73 - 61.014 ms
[LOG] A√ß√£o: DELETE_TRANSACTION | Usu√°rio: 691f206abb1085a3fbaeedae
[LOG] A√ß√£o: CREATE_TRANSACTION | Usu√°rio: 691f206abb1085a3fbaeedae
POST /api/transactions 201 444 - 61.708 ms
[LOG] A√ß√£o: CREATE_TRANSACTION | Usu√°rio: 691f206abb1085a3fbaeedae
POST /api/transactions/691f206ebb1085a3fbaeee80/upload 200 512 - 58.005 ms
[LOG] A√ß√£o: UPLOAD_ATTACHMENT | Usu√°rio: 691f206abb1085a3fbaeedae
DELETE /api/transactions/691f206ebb1085a3fbaeee80/upload 200 440 - 57.401 ms
[LOG] A√ß√£o: DELETE_ATTACHMENT | Usu√°rio: 691f206abb1085a3fbaeedae
[LOG] A√ß√£o: DELETE_TRANSACTION | Usu√°rio: 691f206abb1085a3fbaeedae
DELETE /api/transactions/691f206ebb1085a3fbaeee80 200 73 - 63.314 ms
[LOG] A√ß√£o: DELETE_TRANSACTION | Usu√°rio: 691f206abb1085a3fbaeedae
[LOG] A√ß√£o: CREATE_TRANSACTION | Usu√°rio: 691f206abb1085a3fbaeedae
POST /api/transactions 201 445 - 60.283 ms
[LOG] A√ß√£o: CREATE_TRANSACTION | Usu√°rio: 691f206abb1085a3fbaeedae
POST /api/transactions/691f206fbb1085a3fbaeee9b/upload 200 514 - 59.354 ms
[LOG] A√ß√£o: UPLOAD_ATTACHMENT | Usu√°rio: 691f206abb1085a3fbaeedae
DELETE /api/transactions/691f206fbb1085a3fbaeee9b/upload 200 441 - 55.601 ms
[LOG] A√ß√£o: DELETE_ATTACHMENT | Usu√°rio: 691f206abb1085a3fbaeedae
[LOG] A√ß√£o: DELETE_TRANSACTION | Usu√°rio: 691f206abb1085a3fbaeedae
DELETE /api/transactions/691f206fbb1085a3fbaeee9b 200 73 - 60.904 ms
POST /api/transactions/60d5f1f77c3d4a001f5e8e1z/upload 404 53 - 13.706 ms
[LOG] A√ß√£o: DELETE_TRANSACTION | Usu√°rio: 691f206abb1085a3fbaeedae
PASS Testes/2-features/uploads.test.js
  Feature: Uploads
    Upload de PDF
      ‚àö Deve permitir o upload de um anexo (PDF) para uma transa√ß√£o (73 ms)
      ‚àö Deve permitir a exclus√£o de um anexo (PDF) de uma transa√ß√£o (63 ms)
    Upload de Imagem (PNG)
      ‚àö Deve permitir o upload de um anexo de imagem (.png) para uma transa√ß√£o (63 ms)
      ‚àö Deve permitir a exclus√£o de um anexo de imagem (.png) (62 ms)
    Upload de Imagem (JPG)
      ‚àö Deve permitir o upload de um anexo de imagem (.jpg) para uma transa√ß√£o (62 ms)
      ‚àö Deve permitir a exclus√£o de um anexo de imagem (.jpg) (61 ms)
    Upload de Imagem (JPEG)
      ‚àö Deve permitir o upload de um anexo de imagem (.jpeg) para uma transa√ß√£o (64 ms)
      ‚àö Deve permitir a exclus√£o de um anexo de imagem (.jpeg) (59 ms)
    Cen√°rios de Erro e Estruturais
      ‚àö Deve retornar 404 ao tentar fazer upload para uma transa√ß√£o inexistente (19 ms)

  console.log
    
    --- Configurando 3 empresas para o teste multi-tenant ---

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:35:17)

POST /api/auth/register 201 356 - 136.096 ms
[LOG] A√ß√£o: REGISTER_COMPANY_USER | Usu√°rio: N/A
POST /api/auth/login 200 699 - 94.415 ms
  console.log
    ‚úÖ Empresa 1 (Empresa Teste 17636475994701) cadastrada e logada.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:64:21)

[LOG] A√ß√£o: LOGIN_USER | Usu√°rio: N/A
POST /api/auth/register 201 356 - 143.530 ms
[LOG] A√ß√£o: REGISTER_COMPANY_USER | Usu√°rio: N/A
POST /api/auth/login 200 699 - 129.327 ms
  console.log
    ‚úÖ Empresa 2 (Empresa Teste 17636475997122) cadastrada e logada.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:64:21)

[LOG] A√ß√£o: LOGIN_USER | Usu√°rio: N/A
POST /api/auth/register 201 356 - 143.886 ms
[LOG] A√ß√£o: REGISTER_COMPANY_USER | Usu√°rio: N/A
POST /api/auth/login 200 699 - 93.335 ms
  console.log
    ‚úÖ Empresa 3 (Empresa Teste 17636475999943) cadastrada e logada.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:64:21)

  console.log
    --- Configura√ß√£o multi-tenant conclu√≠da ---

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:66:17)

  console.log
    
    --- Criando transa√ß√µes individuais para cada empresa ---

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:71:17)

[LOG] A√ß√£o: LOGIN_USER | Usu√°rio: N/A
[LOG] A√ß√£o: CREATE_TRANSACTION | Usu√°rio: 691f206fbb1085a3fbaeeebb
POST /api/transactions 201 437 - 103.588 ms
  console.log
    Transa√ß√£o criada para Empresa Teste 17636475994701. ID: 691f2070bb1085a3fbaeeee1

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:93:21)

[LOG] A√ß√£o: CREATE_TRANSACTION | Usu√°rio: 691f206fbb1085a3fbaeeebb
[LOG] A√ß√£o: CREATE_TRANSACTION | Usu√°rio: 691f206fbb1085a3fbaeeec9
POST /api/transactions 201 436 - 63.797 ms
  console.log
    Transa√ß√£o criada para Empresa Teste 17636475997122. ID: 691f2070bb1085a3fbaeeee8

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:93:21)

[LOG] A√ß√£o: CREATE_TRANSACTION | Usu√°rio: 691f206fbb1085a3fbaeeec9
[LOG] A√ß√£o: CREATE_TRANSACTION | Usu√°rio: 691f2070bb1085a3fbaeeed7
POST /api/transactions 201 429 - 46.783 ms
  console.log
    Transa√ß√£o criada para Empresa Teste 17636475999943. ID: 691f2070bb1085a3fbaeeeef

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:93:21)

  console.log
    
    --- Validando isolamento de dados entre todas as empresas ---

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:99:17)

  console.log
    
    Verificando a transa√ß√£o 691f2070bb1085a3fbaeeee1 da Empresa Teste 17636475994701

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:106:21)

[LOG] A√ß√£o: CREATE_TRANSACTION | Usu√°rio: 691f2070bb1085a3fbaeeed7
GET /api/transactions/691f2070bb1085a3fbaeeee1 404 38 - 26.856 ms
  console.log
    - OK: Empresa Teste 17636475997122 foi bloqueada (Status 404).

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:124:29)

GET /api/transactions/691f2070bb1085a3fbaeeee1 404 38 - 26.347 ms
  console.log
    - OK: Empresa Teste 17636475999943 foi bloqueada (Status 404).

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:124:29)

  console.log
    
    Verificando a transa√ß√£o 691f2070bb1085a3fbaeeee8 da Empresa Teste 17636475997122

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:106:21)

GET /api/transactions/691f2070bb1085a3fbaeeee8 404 38 - 26.317 ms
  console.log
    - OK: Empresa Teste 17636475994701 foi bloqueada (Status 404).

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:124:29)

GET /api/transactions/691f2070bb1085a3fbaeeee8 404 38 - 26.198 ms
  console.log
    - OK: Empresa Teste 17636475999943 foi bloqueada (Status 404).

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:124:29)

  console.log
    
    Verificando a transa√ß√£o 691f2070bb1085a3fbaeeeef da Empresa Teste 17636475999943

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:106:21)

GET /api/transactions/691f2070bb1085a3fbaeeeef 404 38 - 26.148 ms
  console.log
    - OK: Empresa Teste 17636475994701 foi bloqueada (Status 404).

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:124:29)

GET /api/transactions/691f2070bb1085a3fbaeeeef 404 38 - 26.706 ms
  console.log
    - OK: Empresa Teste 17636475997122 foi bloqueada (Status 404).

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:124:29)

  console.log
    
    --- Validando listagem de transa√ß√µes ---

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:131:17)

GET /api/transactions 200 423 - 27.280 ms
  console.log
    - OK: Empresa Teste 17636475994701 listou apenas sua pr√≥pria transa√ß√£o.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:143:21)

GET /api/transactions 200 422 - 26.650 ms
  console.log
    - OK: Empresa Teste 17636475997122 listou apenas sua pr√≥pria transa√ß√£o.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:143:21)

GET /api/transactions 200 415 - 26.946 ms
  console.log
    - OK: Empresa Teste 17636475999943 listou apenas sua pr√≥pria transa√ß√£o.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:143:21)

  console.log
    
    --- Limpando dados de teste (Teardown) ---

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:149:17)

DELETE /api/auth/users/undefined 500 329 - 14.293 ms
  console.error
    - ‚ùå Falha ao excluir a empresa Empresa Teste 17636475994701: {
      success: false,
      message: 'Erro no servidor ao tentar excluir o usu√°rio.',
      errors: {
        stringValue: '"undefined"',
        valueType: 'string',
        kind: 'ObjectId',
        value: 'undefined',
        path: '_id',
        reason: {},
        name: 'CastError',
        message: 'Cast to ObjectId failed for value "undefined" (type string) at path "_id" for model "User"'
      }
    }

      156 |                 console.log(`- ‚úÖ Empresa ${company.companyName} e dados associados exclu√≠dos com sucesso.`);
      157 |             } catch (error) {
    > 158 |                 console.error(`- ‚ùå Falha ao excluir a empresa ${company.companyName}:`, error.response?.data || error.message);
          |                         ^
      159 |             }
      160 |         }
      161 |     });

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:158:25)

[LOG] A√ß√£o: DELETE_USER_BY_ID | Usu√°rio: 691f206fbb1085a3fbaeeebb
DELETE /api/auth/users/undefined 500 329 - 13.824 ms
  console.error
    - ‚ùå Falha ao excluir a empresa Empresa Teste 17636475997122: {
      success: false,
      message: 'Erro no servidor ao tentar excluir o usu√°rio.',
      errors: {
        stringValue: '"undefined"',
        valueType: 'string',
        kind: 'ObjectId',
        value: 'undefined',
        path: '_id',
        reason: {},
        name: 'CastError',
        message: 'Cast to ObjectId failed for value "undefined" (type string) at path "_id" for model "User"'
      }
    }

      156 |                 console.log(`- ‚úÖ Empresa ${company.companyName} e dados associados exclu√≠dos com sucesso.`);
      157 |             } catch (error) {
    > 158 |                 console.error(`- ‚ùå Falha ao excluir a empresa ${company.companyName}:`, error.response?.data || error.message);
          |                         ^
      159 |             }
      160 |         }
      161 |     });

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:158:25)

DELETE /api/auth/users/undefined 500 329 - 13.441 ms
[LOG] A√ß√£o: DELETE_USER_BY_ID | Usu√°rio: 691f206fbb1085a3fbaeeec9
  console.error
    - ‚ùå Falha ao excluir a empresa Empresa Teste 17636475999943: {
      success: false,
      message: 'Erro no servidor ao tentar excluir o usu√°rio.',
      errors: {
        stringValue: '"undefined"',
        valueType: 'string',
        kind: 'ObjectId',
        value: 'undefined',
        path: '_id',
        reason: {},
        name: 'CastError',
        message: 'Cast to ObjectId failed for value "undefined" (type string) at path "_id" for model "User"'
      }
    }

      156 |                 console.log(`- ‚úÖ Empresa ${company.companyName} e dados associados exclu√≠dos com sucesso.`);
      157 |             } catch (error) {
    > 158 |                 console.error(`- ‚ùå Falha ao excluir a empresa ${company.companyName}:`, error.response?.data || error.message);
          |                         ^
      159 |             }
      160 |         }
      161 |     });

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:158:25)

PASS Testes/3-security/multi-tenant.test.js
  3. Teste de Isolamento de Dados (Multi-Tenant)
    ‚àö deve criar uma transa√ß√£o para cada empresa (228 ms)
    ‚àö deve impedir que uma empresa acesse a transa√ß√£o de outra (185 ms)
    ‚àö deve garantir que cada empresa liste apenas suas pr√≥prias transa√ß√µes (89 ms)

[LOG] A√ß√£o: DELETE_USER_BY_ID | Usu√°rio: 691f2070bb1085a3fbaeeed7
  console.log
    
    --- üõ°Ô∏è  Teste de Persist√™ncia: Verificando dados manuais... ---

      at Object.<anonymous> (Testes/3-security/persistence.test.js:37:13)

  console.log
       - [PASS] Usu√°rio da "Empresa Frontend" permaneceu no banco.

      at Object.<anonymous> (Testes/3-security/persistence.test.js:45:15)

  console.log
       - [PASS] Usu√°rio da "Empresa Backend" permaneceu no banco.

      at Object.<anonymous> (Testes/3-security/persistence.test.js:45:15)

  console.log
       - [PASS] Usu√°rio da "Empresa React" permaneceu no banco.

      at Object.<anonymous> (Testes/3-security/persistence.test.js:45:15)

PASS Testes/3-security/persistence.test.js
  Security: Persist√™ncia de Dados Manuais
    ‚àö deve garantir que os usu√°rios de teste manuais permane√ßam no banco ap√≥s a execu√ß√£o de `npm test` (177 ms)

GET /api/reports/export/transactions-pdf 200 - - 64.346 ms
GET /api/reports/export/clients-pdf 200 - - 42.931 ms
GET /api/reports/export/invoice/691f206abb1085a3fbaeedb8 200 - - 55.127 ms
PASS Testes/4-reports/reports.test.js
  8. M√≥dulo de Relat√≥rios
    ‚àö deve gerar um PDF v√°lido para o RELAT√ìRIO DE TRANSA√á√ïES (124 ms)
    ‚àö deve gerar um PDF v√°lido para o RELAT√ìRIO DE CLIENTES (55 ms)
    ‚àö deve gerar um PDF v√°lido para a FATURA (65 ms)

Test Suites: 10 passed, 10 total
Tests:       36 passed, 36 total
Snapshots:   0 total
Time:        7.197 s
Ran all test suites.

--- üßπ [GLOBAL TEARDOWN] Finalizando ambiente de teste ---
   - [OK] Dados de teste tempor√°rios foram removidos.
‚úÖ Servidor e conex√£o com MongoDB encerrados (stopServer).
--- ‚úÖ [GLOBAL TEARDOWN] Ambiente finalizado com sucesso ---
Jest did not exit one second after the test run has completed.

'This usually means that there are asynchronous operations that weren't stopped in your tests. Consider running Jest with `--detectOpenHandles` to troubleshoot this issue.
