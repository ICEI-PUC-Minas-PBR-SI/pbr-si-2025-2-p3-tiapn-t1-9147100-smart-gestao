
--- üöÄ [ETAPA 1 de 4] Iniciando Ambiente de Teste (Jest Environment) ---
   - [PROCESSO] Lendo configura√ß√£o do banco de dados de teste...
   - [ATEN√á√ÉO] Usando banco de dados de DESENVOLVIMENTO para os testes. As cole√ß√µes ser√£o limpas.

--- üöÄ [ETAPA 2 de 4] Limpando e populando o banco de dados de TESTE ---
   - [OK] Dados de teste (empresas e usu√°rios) criados e salvos em test-setup.json.
(node:25752) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
  console.log
    
    --- Configurando 3 empresas para o teste multi-tenant ---

      at Object.log (Testes/3-security/multi-tenant.test.js:19:17)

  console.log
    ‚úÖ Empresa 1 (Empresa Teste 1762998373346) cadastrada e logada.

      at Object.log (Testes/3-security/multi-tenant.test.js:48:21)

  console.log
    ‚úÖ Empresa 2 (Empresa Teste 1762998373688) cadastrada e logada.

      at Object.log (Testes/3-security/multi-tenant.test.js:48:21)

  console.log
    ‚úÖ Empresa 3 (Empresa Teste 1762998373940) cadastrada e logada.

      at Object.log (Testes/3-security/multi-tenant.test.js:48:21)

  console.log
    --- Configura√ß√£o multi-tenant conclu√≠da ---

      at Object.log (Testes/3-security/multi-tenant.test.js:50:17)

  console.log
    
    --- Criando transa√ß√µes individuais para cada empresa ---

      at Object.log (Testes/3-security/multi-tenant.test.js:55:17)

  console.log
    Transa√ß√£o criada para Empresa Teste 1762998373346. ID: 6915386696fa5bd7028e2210

      at Object.log (Testes/3-security/multi-tenant.test.js:76:21)

  console.log
    Transa√ß√£o criada para Empresa Teste 1762998373688. ID: 6915386696fa5bd7028e2217

      at Object.log (Testes/3-security/multi-tenant.test.js:76:21)

  console.log
    Transa√ß√£o criada para Empresa Teste 1762998373940. ID: 6915386696fa5bd7028e221e

      at Object.log (Testes/3-security/multi-tenant.test.js:76:21)

  console.log
    
    --- Validando isolamento de dados entre todas as empresas ---

      at Object.log (Testes/3-security/multi-tenant.test.js:82:17)

  console.log
    
    Verificando a transa√ß√£o 6915386696fa5bd7028e2210 da Empresa Teste 1762998373346

      at Object.log (Testes/3-security/multi-tenant.test.js:89:21)

  console.log
    - OK: Empresa Teste 1762998373688 foi bloqueada (Status 404).

      at Object.log (Testes/3-security/multi-tenant.test.js:107:29)

  console.log
    - OK: Empresa Teste 1762998373940 foi bloqueada (Status 404).

      at Object.log (Testes/3-security/multi-tenant.test.js:107:29)

  console.log
    
    Verificando a transa√ß√£o 6915386696fa5bd7028e2217 da Empresa Teste 1762998373688

      at Object.log (Testes/3-security/multi-tenant.test.js:89:21)

  console.log
    - OK: Empresa Teste 1762998373346 foi bloqueada (Status 404).

      at Object.log (Testes/3-security/multi-tenant.test.js:107:29)

  console.log
    - OK: Empresa Teste 1762998373940 foi bloqueada (Status 404).

      at Object.log (Testes/3-security/multi-tenant.test.js:107:29)

  console.log
    
    Verificando a transa√ß√£o 6915386696fa5bd7028e221e da Empresa Teste 1762998373940

      at Object.log (Testes/3-security/multi-tenant.test.js:89:21)

  console.log
    - OK: Empresa Teste 1762998373346 foi bloqueada (Status 404).

      at Object.log (Testes/3-security/multi-tenant.test.js:107:29)

  console.log
    - OK: Empresa Teste 1762998373688 foi bloqueada (Status 404).

      at Object.log (Testes/3-security/multi-tenant.test.js:107:29)

  console.log
    
    --- Validando listagem de transa√ß√µes ---

      at Object.log (Testes/3-security/multi-tenant.test.js:114:17)

  console.log
    - OK: Empresa Teste 1762998373346 listou apenas sua pr√≥pria transa√ß√£o.

      at Object.log (Testes/3-security/multi-tenant.test.js:126:21)

  console.log
    - OK: Empresa Teste 1762998373688 listou apenas sua pr√≥pria transa√ß√£o.

      at Object.log (Testes/3-security/multi-tenant.test.js:126:21)

  console.log
    - OK: Empresa Teste 1762998373940 listou apenas sua pr√≥pria transa√ß√£o.

      at Object.log (Testes/3-security/multi-tenant.test.js:126:21)

  console.log
    
    --- Limpando dados de teste (Teardown) ---

      at Object.log (Testes/3-security/multi-tenant.test.js:132:17)

  console.log
    - ‚úÖ Empresa Empresa Teste 1762998373346 e dados associados exclu√≠dos com sucesso.

      at Object.log (Testes/3-security/multi-tenant.test.js:139:25)

  console.log
    - ‚úÖ Empresa Empresa Teste 1762998373688 e dados associados exclu√≠dos com sucesso.

      at Object.log (Testes/3-security/multi-tenant.test.js:139:25)

  console.log
    - ‚úÖ Empresa Empresa Teste 1762998373940 e dados associados exclu√≠dos com sucesso.

      at Object.log (Testes/3-security/multi-tenant.test.js:139:25)


--- üßπ [ENV] Desconectando do banco de dados ---
--- ‚úÖ [ENV] Ambiente de teste finalizado ---
 PASS  Testes/3-security/multi-tenant.test.js
  3. Teste de Isolamento de Dados em Larga Escala (Multi-Tenant)
    ‚àö deve criar uma transa√ß√£o para cada empresa (196 ms)
    ‚àö deve impedir que uma empresa acesse a transa√ß√£o de outra (194 ms)
    ‚àö deve garantir que cada empresa liste apenas suas pr√≥prias transa√ß√µes (90 ms)


--- üöÄ [ETAPA 1 de 4] Iniciando Ambiente de Teste (Jest Environment) ---
   - [PROCESSO] Lendo configura√ß√£o do banco de dados de teste...
   - [ATEN√á√ÉO] Usando banco de dados de DESENVOLVIMENTO para os testes. As cole√ß√µes ser√£o limpas.

--- üöÄ [ETAPA 2 de 4] Limpando e populando o banco de dados de TESTE ---
   - [OK] Dados de teste (empresas e usu√°rios) criados e salvos em test-setup.json.
  console.log
    
    --- Teste: Solicitar reset para e-mail inv√°lido ---

      at Object.log (Testes/1-auth/password.test.js:25:13)

  console.log
    ‚úÖ Falhou como esperado para e-mail inexistente (Status 404).

      at Object.log (Testes/1-auth/password.test.js:34:15)

  console.log
    
    --- Teste: Gerar token de reset com sucesso ---

      at Object.log (Testes/1-auth/password.test.js:39:13)

  console.log
    ‚úÖ Token de reset gerado e salvo no banco de dados.

      at Object.log (Testes/1-auth/password.test.js:50:13)

  console.log
    
    --- Teste: Resetar senha com token v√°lido ---

      at Object.log (Testes/1-auth/password.test.js:54:13)

  console.log
    ‚úÖ Senha resetada com sucesso via API.

      at Object.log (Testes/1-auth/password.test.js:71:13)

  console.log
    ‚úÖ Token de reset foi invalidado no banco.

      at Object.log (Testes/1-auth/password.test.js:75:13)

  console.log
    ‚úÖ Login com a nova senha realizado com sucesso.

      at Object.log (Testes/1-auth/password.test.js:85:13)


--- üßπ [ENV] Desconectando do banco de dados ---
--- ‚úÖ [ENV] Ambiente de teste finalizado ---
 PASS  Testes/1-auth/password.test.js
  9. M√≥dulo de Recupera√ß√£o de Senha
    ‚àö deve falhar ao solicitar reset para um e-mail inexistente (37 ms)
    ‚àö deve gerar e salvar um token de reset para um e-mail v√°lido (40 ms)
    ‚àö deve resetar a senha com um token v√°lido e permitir login com a nova senha (254 ms)


--- üöÄ [ETAPA 1 de 4] Iniciando Ambiente de Teste (Jest Environment) ---
   - [PROCESSO] Lendo configura√ß√£o do banco de dados de teste...
   - [ATEN√á√ÉO] Usando banco de dados de DESENVOLVIMENTO para os testes. As cole√ß√µes ser√£o limpas.

--- üöÄ [ETAPA 2 de 4] Limpando e populando o banco de dados de TESTE ---
   - [OK] Dados de teste (empresas e usu√°rios) criados e salvos em test-setup.json.

--- üßπ [ENV] Desconectando do banco de dados ---
--- ‚úÖ [ENV] Ambiente de teste finalizado ---
 PASS  Testes/2-features/transactions.test.js
  4. M√≥dulo de Transa√ß√µes (CRUD)
    ‚àö deve CRIAR uma nova transa√ß√£o com sucesso (62 ms)
    ‚àö deve falhar ao tentar criar uma transa√ß√£o com dados inv√°lidos (26 ms)
    ‚àö deve LISTAR as transa√ß√µes do usu√°rio logado (29 ms)
    ‚àö deve OBTER uma transa√ß√£o espec√≠fica pelo ID (30 ms)
    ‚àö deve ATUALIZAR uma transa√ß√£o existente (62 ms)
    ‚àö deve EXCLUIR uma transa√ß√£o existente (81 ms)


--- üöÄ [ETAPA 1 de 4] Iniciando Ambiente de Teste (Jest Environment) ---
   - [PROCESSO] Lendo configura√ß√£o do banco de dados de teste...
   - [ATEN√á√ÉO] Usando banco de dados de DESENVOLVIMENTO para os testes. As cole√ß√µes ser√£o limpas.

--- üöÄ [ETAPA 2 de 4] Limpando e populando o banco de dados de TESTE ---
   - [OK] Dados de teste (empresas e usu√°rios) criados e salvos em test-setup.json.

--- üßπ [ENV] Desconectando do banco de dados ---
--- ‚úÖ [ENV] Ambiente de teste finalizado ---
 PASS  Testes/1-auth/auth.test.js
  6. M√≥dulo de Autentica√ß√£o e Sess√£o (Stateful)
    ‚àö deve criar um SessionToken no banco de dados ap√≥s o login (111 ms)
    ‚àö deve invalidar o SessionToken no banco de dados ap√≥s o logout (123 ms)


--- üöÄ [ETAPA 1 de 4] Iniciando Ambiente de Teste (Jest Environment) ---
   - [PROCESSO] Lendo configura√ß√£o do banco de dados de teste...
   - [ATEN√á√ÉO] Usando banco de dados de DESENVOLVIMENTO para os testes. As cole√ß√µes ser√£o limpas.

--- üöÄ [ETAPA 2 de 4] Limpando e populando o banco de dados de TESTE ---
   - [OK] Dados de teste (empresas e usu√°rios) criados e salvos em test-setup.json.

--- üßπ [ENV] Desconectando do banco de dados ---
--- ‚úÖ [ENV] Ambiente de teste finalizado ---
 PASS  Testes/2-features/clients.test.js
  7. M√≥dulo de Clientes/Fornecedores
    ‚àö deve CRIAR um novo cliente com sucesso (44 ms)
    ‚àö deve LISTAR os clientes da empresa (31 ms)
    ‚àö deve ATUALIZAR um cliente existente (35 ms)
    ‚àö deve EXCLUIR um cliente existente (46 ms)


--- üöÄ [ETAPA 1 de 4] Iniciando Ambiente de Teste (Jest Environment) ---
   - [PROCESSO] Lendo configura√ß√£o do banco de dados de teste...
   - [ATEN√á√ÉO] Usando banco de dados de DESENVOLVIMENTO para os testes. As cole√ß√µes ser√£o limpas.

--- üöÄ [ETAPA 2 de 4] Limpando e populando o banco de dados de TESTE ---
   - [OK] Dados de teste (empresas e usu√°rios) criados e salvos em test-setup.json.

--- üßπ [ENV] Desconectando do banco de dados ---
--- ‚úÖ [ENV] Ambiente de teste finalizado ---
 PASS  Testes/2-features/goals.test.js
  5. M√≥dulo de Metas (CRUD)
    ‚àö deve CRIAR uma nova meta com sucesso (60 ms)
    ‚àö deve LISTAR as metas do usu√°rio logado (30 ms)
    ‚àö deve ATUALIZAR uma meta existente (58 ms)
    ‚àö deve EXCLUIR uma meta existente (86 ms)


--- üöÄ [ETAPA 1 de 4] Iniciando Ambiente de Teste (Jest Environment) ---
   - [PROCESSO] Lendo configura√ß√£o do banco de dados de teste...
   - [ATEN√á√ÉO] Usando banco de dados de DESENVOLVIMENTO para os testes. As cole√ß√µes ser√£o limpas.

--- üöÄ [ETAPA 2 de 4] Limpando e populando o banco de dados de TESTE ---
   - [OK] Dados de teste (empresas e usu√°rios) criados e salvos em test-setup.json.

--- üßπ [ENV] Desconectando do banco de dados ---
--- ‚úÖ [ENV] Ambiente de teste finalizado ---
 FAIL  Testes/4-reports/reports.test.js
  ‚óè Test suite failed to run

    SyntaxError: F:\Programacao\GitHub\pbr-si-2025-2-p3-tiapn-t1-9147100-smart-gestao\src\codes\backend\Testes\4-reports\reports.test.js: Unexpected token, expected "," (18:2)

      16 |   generateClientsReportPDF: jest.fn(),
      17 |   generateInvoicePDF: jest.fn(),
    > 18 | });
         |   ^
      19 |
      20 | // A importa√ß√£o √© feita DEPOIS do mock ser definido.
      21 | const { generateFinancialReportPDF, generateClientsReportPDF, generateInvoicePDF } = await import('../../services/pdfService.js');

      at constructor (node_modules/@babel/parser/src/parse-error.ts:95:45)
      at Parser.toParseError [as raise] (node_modules/@babel/parser/src/tokenizer/index.ts:1507:19)
      at Parser.raise [as unexpected] (node_modules/@babel/parser/src/tokenizer/index.ts:1547:16)
      at Parser.unexpected [as expect] (node_modules/@babel/parser/src/parser/util.ts:157:12)
      at Parser.expect [as parseCallExpressionArguments] (node_modules/@babel/parser/src/parser/expression.ts:1031:14)
      at Parser.parseCallExpressionArguments [as parseCoverCallAndAsyncArrowHead] (node_modules/@babel/parser/src/parser/expression.ts:922:29)
      at Parser.parseCoverCallAndAsyncArrowHead [as parseSubscript] (node_modules/@babel/parser/src/parser/expression.ts:804:19)
      at Parser.parseSubscript [as parseSubscripts] (node_modules/@babel/parser/src/parser/expression.ts:763:19)
      at Parser.parseSubscripts [as parseExprSubscripts] (node_modules/@babel/parser/src/parser/expression.ts:748:17)
      at Parser.parseExprSubscripts [as parseUpdate] (node_modules/@babel/parser/src/parser/expression.ts:721:21)
      at Parser.parseUpdate [as parseMaybeUnary] (node_modules/@babel/parser/src/parser/expression.ts:683:23)
      at Parser.parseMaybeUnary [as parseMaybeUnaryOrPrivate] (node_modules/@babel/parser/src/parser/expression.ts:417:14)
      at Parser.parseMaybeUnaryOrPrivate [as parseExprOps] (node_modules/@babel/parser/src/parser/expression.ts:429:23)
      at Parser.parseExprOps [as parseMaybeConditional] (node_modules/@babel/parser/src/parser/expression.ts:384:23)
      at Parser.parseMaybeConditional [as parseMaybeAssign] (node_modules/@babel/parser/src/parser/expression.ts:301:21)
      at Parser.parseMaybeAssign [as parseExpressionBase] (node_modules/@babel/parser/src/parser/expression.ts:226:23)
      at parseExpressionBase (node_modules/@babel/parser/src/parser/expression.ts:217:39)
      at Parser.callback [as allowInAnd] (node_modules/@babel/parser/src/parser/expression.ts:3197:16)
      at Parser.allowInAnd [as parseExpression] (node_modules/@babel/parser/src/parser/expression.ts:217:17)
      at Parser.parseExpression [as parseStatementContent] (node_modules/@babel/parser/src/parser/statement.ts:688:23)
      at Parser.parseStatementContent [as parseStatementLike] (node_modules/@babel/parser/src/parser/statement.ts:482:17)
      at Parser.parseStatementLike [as parseModuleItem] (node_modules/@babel/parser/src/parser/statement.ts:419:17)
      at Parser.parseModuleItem [as parseBlockOrModuleBlockBody] (node_modules/@babel/parser/src/parser/statement.ts:1443:16)
      at Parser.parseBlockOrModuleBlockBody [as parseBlockBody] (node_modules/@babel/parser/src/parser/statement.ts:1417:10)
      at Parser.parseBlockBody [as parseProgram] (node_modules/@babel/parser/src/parser/statement.ts:229:10)
      at Parser.parseProgram [as parseTopLevel] (node_modules/@babel/parser/src/parser/statement.ts:203:25)
      at Parser.parseTopLevel [as parse] (node_modules/@babel/parser/src/parser/index.ts:88:25)
      at parse (node_modules/@babel/parser/src/index.ts:86:38)
      at parser (node_modules/@babel/core/src/parser/index.ts:29:19)
          at parser.next (<anonymous>)
      at normalizeFile (node_modules/@babel/core/src/transformation/normalize-file.ts:50:24)
          at normalizeFile.next (<anonymous>)
      at run (node_modules/@babel/core/src/transformation/index.ts:41:36)
          at run.next (<anonymous>)
      at transform (node_modules/@babel/core/src/transform.ts:29:20)
          at transform.next (<anonymous>)
      at step (node_modules/gensync/index.js:261:32)
      at node_modules/gensync/index.js:273:13
      at async.call.result.err.err (node_modules/gensync/index.js:223:11)
      at node_modules/gensync/index.js:189:28
      at cb (node_modules/@babel/core/src/gensync-utils/async.ts:90:7)
      at node_modules/gensync/index.js:113:33
      at step (node_modules/gensync/index.js:287:14)
      at node_modules/gensync/index.js:273:13
      at async.call.result.err.err (node_modules/gensync/index.js:223:11)

Test Suites: 1 failed, 6 passed, 7 total
Tests:       22 passed, 22 total
Snapshots:   0 total
Time:        10.6 s
Ran all test suites.

--- FIM DOS TESTES AUTOMATIZADOS (Status: Falha) ---
