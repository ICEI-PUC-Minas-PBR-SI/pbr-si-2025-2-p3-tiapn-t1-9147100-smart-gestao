
--- ðŸš€ [GLOBAL SETUP] Iniciando ambiente de teste ---
â³ Iniciando servidor Smart GestÃ£o (startServer)...
ConexÃ£o com o MongoDB estabelecida com sucesso.
âœ… [1/3] ConexÃ£o com o banco de dados estabelecida!
Verificando permissÃµes de sistema...
PermissÃµes de sistema jÃ¡ existem. Nenhuma aÃ§Ã£o necessÃ¡ria.
âœ… [2/3] PermissÃµes do sistema validadas/inicializadas.
âœ… [3/3] Servidor rodando na porta 5000
--- âœ… [GLOBAL SETUP] Ambiente pronto e servidor iniciado ---
(node:27688) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
POST /api/clients 201 42.589 ms - 335
[LOG] AÃ§Ã£o: CREATE_CLIENT | UsuÃ¡rio: 6916813a90a0e142c759de87
GET /api/clients 200 29.146 ms - 591
PUT /api/clients/6916813c90a0e142c759de98 200 36.596 ms - 349
[LOG] AÃ§Ã£o: UPDATE_CLIENT | UsuÃ¡rio: 6916813a90a0e142c759de87
DELETE /api/clients/6916813c90a0e142c759de98 200 31.924 ms - 70
GET /api/clients/6916813c90a0e142c759de98 404 2.261 ms - 175
[LOG] AÃ§Ã£o: DELETE_CLIENT | UsuÃ¡rio: 6916813a90a0e142c759de87
DELETE /api/clients/6916813c90a0e142c759de98 404 27.565 ms - 68
PASS Testes/2-features/clients.test.js
  7. MÃ³dulo de Clientes/Fornecedores
    âˆš deve CRIAR um novo cliente com sucesso (99 ms)
    âˆš deve LISTAR os clientes da empresa (34 ms)
    âˆš deve ATUALIZAR um cliente existente (43 ms)
    âˆš deve EXCLUIR um cliente existente (57 ms)

[LOG] AÃ§Ã£o: DELETE_CLIENT | UsuÃ¡rio: 6916813a90a0e142c759de87
[LOG] AÃ§Ã£o: CREATE_GOAL | UsuÃ¡rio: 6916813a90a0e142c759de87
POST /api/goals 201 47.393 ms - 404
GET /api/goals 200 27.294 ms - 406
[LOG] AÃ§Ã£o: UPDATE_GOAL | UsuÃ¡rio: 6916813a90a0e142c759de87
PUT /api/goals/6916813c90a0e142c759deab 200 46.022 ms - 414
[LOG] AÃ§Ã£o: DELETE_GOAL | UsuÃ¡rio: 6916813a90a0e142c759de87
DELETE /api/goals/6916813c90a0e142c759deab 200 45.446 ms - 67
GET /api/goals/6916813c90a0e142c759deab 404 26.530 ms - 65
DELETE /api/goals/6916813c90a0e142c759deab 404 25.936 ms - 65
PASS Testes/2-features/goals.test.js
  5. MÃ³dulo de Metas (CRUD)
    âˆš deve CRIAR uma nova meta com sucesso (65 ms)
    âˆš deve LISTAR as metas do usuÃ¡rio logado (31 ms)
    âˆš deve ATUALIZAR uma meta existente (51 ms)
    âˆš deve EXCLUIR uma meta existente (87 ms)

[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 6916813a90a0e142c759de87
POST /api/transactions 201 46.797 ms - 468
[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 6916813a90a0e142c759de87
POST /api/transactions 400 16.038 ms - 277
[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 6916813a90a0e142c759de87
GET /api/transactions 200 27.475 ms - 855
GET /api/transactions/6916813d90a0e142c759debe 200 26.331 ms - 452
[LOG] AÃ§Ã£o: UPDATE_TRANSACTION | UsuÃ¡rio: 6916813a90a0e142c759de87
PUT /api/transactions/6916813d90a0e142c759debe 200 45.814 ms - 452
[LOG] AÃ§Ã£o: UPDATE_TRANSACTION | UsuÃ¡rio: 6916813a90a0e142c759de87
[LOG] AÃ§Ã£o: DELETE_TRANSACTION | UsuÃ¡rio: 6916813a90a0e142c759de87
DELETE /api/transactions/6916813d90a0e142c759debe 200 46.641 ms - 73
[LOG] AÃ§Ã£o: DELETE_TRANSACTION | UsuÃ¡rio: 6916813a90a0e142c759de87
GET /api/transactions/6916813d90a0e142c759debe 404 25.017 ms - 71
DELETE /api/transactions/6916813d90a0e142c759debe 404 25.297 ms - 71
PASS Testes/2-features/transactions.test.js
  4. MÃ³dulo de TransaÃ§Ãµes (CRUD)
    âˆš deve CRIAR uma nova transaÃ§Ã£o com sucesso (61 ms)
    âˆš deve falhar ao tentar criar uma transaÃ§Ã£o com dados invÃ¡lidos (33 ms)
    âˆš deve LISTAR as transaÃ§Ãµes do usuÃ¡rio logado (31 ms)
    âˆš deve OBTER uma transaÃ§Ã£o especÃ­fica pelo ID (30 ms)
    âˆš deve ATUALIZAR uma transaÃ§Ã£o existente (50 ms)
    âˆš deve EXCLUIR uma transaÃ§Ã£o existente (80 ms)

[LOG] AÃ§Ã£o: DELETE_TRANSACTION | UsuÃ¡rio: 6916813a90a0e142c759de87
[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 6916813a90a0e142c759de87
POST /api/transactions 201 45.918 ms - 446
[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 6916813a90a0e142c759de87
POST /api/transactions/6916813d90a0e142c759dedf/upload 200 50.419 ms - 514
[LOG] AÃ§Ã£o: UPLOAD_ATTACHMENT | UsuÃ¡rio: 6916813a90a0e142c759de87
DELETE /api/transactions/6916813d90a0e142c759dedf/upload 200 57.340 ms - 442
[LOG] AÃ§Ã£o: DELETE_ATTACHMENT | UsuÃ¡rio: 6916813a90a0e142c759de87
[LOG] AÃ§Ã£o: DELETE_TRANSACTION | UsuÃ¡rio: 6916813a90a0e142c759de87
DELETE /api/transactions/6916813d90a0e142c759dedf 200 45.536 ms - 73
[LOG] AÃ§Ã£o: DELETE_TRANSACTION | UsuÃ¡rio: 6916813a90a0e142c759de87
[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 6916813a90a0e142c759de87
POST /api/transactions 201 45.417 ms - 444
[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 6916813a90a0e142c759de87
POST /api/transactions/6916813e90a0e142c759def6/upload 200 49.435 ms - 512
[LOG] AÃ§Ã£o: UPLOAD_ATTACHMENT | UsuÃ¡rio: 6916813a90a0e142c759de87
DELETE /api/transactions/6916813e90a0e142c759def6/upload 200 43.134 ms - 440
[LOG] AÃ§Ã£o: DELETE_ATTACHMENT | UsuÃ¡rio: 6916813a90a0e142c759de87
[LOG] AÃ§Ã£o: DELETE_TRANSACTION | UsuÃ¡rio: 6916813a90a0e142c759de87
DELETE /api/transactions/6916813e90a0e142c759def6 200 45.372 ms - 73
[LOG] AÃ§Ã£o: DELETE_TRANSACTION | UsuÃ¡rio: 6916813a90a0e142c759de87
[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 6916813a90a0e142c759de87
POST /api/transactions 201 74.158 ms - 444
[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 6916813a90a0e142c759de87
POST /api/transactions/6916813e90a0e142c759df0d/upload 200 44.583 ms - 512
[LOG] AÃ§Ã£o: UPLOAD_ATTACHMENT | UsuÃ¡rio: 6916813a90a0e142c759de87
DELETE /api/transactions/6916813e90a0e142c759df0d/upload 200 42.952 ms - 440
[LOG] AÃ§Ã£o: DELETE_ATTACHMENT | UsuÃ¡rio: 6916813a90a0e142c759de87
[LOG] AÃ§Ã£o: DELETE_TRANSACTION | UsuÃ¡rio: 6916813a90a0e142c759de87
DELETE /api/transactions/6916813e90a0e142c759df0d 200 45.217 ms - 73
[LOG] AÃ§Ã£o: DELETE_TRANSACTION | UsuÃ¡rio: 6916813a90a0e142c759de87
[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 6916813a90a0e142c759de87
POST /api/transactions 201 45.169 ms - 445
[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 6916813a90a0e142c759de87
POST /api/transactions/6916813e90a0e142c759df24/upload 200 84.592 ms - 514
[LOG] AÃ§Ã£o: UPLOAD_ATTACHMENT | UsuÃ¡rio: 6916813a90a0e142c759de87
DELETE /api/transactions/6916813e90a0e142c759df24/upload 200 41.709 ms - 441
[LOG] AÃ§Ã£o: DELETE_ATTACHMENT | UsuÃ¡rio: 6916813a90a0e142c759de87
[LOG] AÃ§Ã£o: DELETE_TRANSACTION | UsuÃ¡rio: 6916813a90a0e142c759de87
DELETE /api/transactions/6916813e90a0e142c759df24 200 45.975 ms - 73
[LOG] AÃ§Ã£o: DELETE_TRANSACTION | UsuÃ¡rio: 6916813a90a0e142c759de87
POST /api/transactions/60d5f1f77c3d4a001f5e8e1z/upload 500 17.446 ms - 368
FAIL Testes/2-features/uploads.test.js
  Feature: Uploads
    Upload de PDF
      âˆš Deve permitir o upload de um anexo (PDF) para uma transaÃ§Ã£o (62 ms)
      âˆš Deve permitir a exclusÃ£o de um anexo (PDF) de uma transaÃ§Ã£o (63 ms)
    Upload de Imagem (PNG)
      âˆš Deve permitir o upload de um anexo de imagem (.png) para uma transaÃ§Ã£o (54 ms)
      âˆš Deve permitir a exclusÃ£o de um anexo de imagem (.png) (47 ms)
    Upload de Imagem (JPG)
      âˆš Deve permitir o upload de um anexo de imagem (.jpg) para uma transaÃ§Ã£o (51 ms)
      âˆš Deve permitir a exclusÃ£o de um anexo de imagem (.jpg) (47 ms)
    Upload de Imagem (JPEG)
      âˆš Deve permitir o upload de um anexo de imagem (.jpeg) para uma transaÃ§Ã£o (90 ms)
      âˆš Deve permitir a exclusÃ£o de um anexo de imagem (.jpeg) (46 ms)
    CenÃ¡rios de Erro e Estruturais
      Ã— Deve retornar 404 ao tentar fazer upload para uma transaÃ§Ã£o inexistente (61 ms)

  â— Feature: Uploads â€º CenÃ¡rios de Erro e Estruturais â€º Deve retornar 404 ao tentar fazer upload para uma transaÃ§Ã£o inexistente

    expect(received).rejects.toThrow(expected)

    Expected substring: "Request failed with status code 404"
    Received message:   "Request failed with status code 500"

          180 |             form.append('attachment', fs.createReadStream(filePath));
          181 |
        > 182 |             await expect(
              |             ^
          183 |                 axios.post(
          184 |                     `${apiUrl}/transactions/${invalidId}/upload`,
          185 |                     form,

      at settle (node_modules/axios/lib/core/settle.js:19:12)
      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:793:11)
      at Axios.request (node_modules/axios/lib/core/Axios.js:45:41)
      at Object.<anonymous> (Testes/2-features/uploads.test.js:182:13)
      at Object.toThrow (node_modules/expect/build/index.js:2155:20)
      at Object.toThrow (Testes/2-features/uploads.test.js:188:23)

Test Suites: 1 failed, 3 passed, 4 total
Tests:       1 failed, 22 passed, 23 total
Snapshots:   0 total
Time:        3.726 s
Ran all test suites matching Testes/2-features/.

--- ðŸ§¹ [GLOBAL TEARDOWN] Finalizando ambiente de teste ---
[LOG] AÃ§Ã£o: UPLOAD_ATTACHMENT | UsuÃ¡rio: 6916813a90a0e142c759de87
   - [OK] Dados de teste temporÃ¡rios foram removidos.
âœ… Servidor e conexÃ£o com MongoDB encerrados (stopServer).
--- âœ… [GLOBAL TEARDOWN] Ambiente finalizado com sucesso ---

--- FIM DOS TESTES AUTOMATIZADOS (Status: Falha) ---
