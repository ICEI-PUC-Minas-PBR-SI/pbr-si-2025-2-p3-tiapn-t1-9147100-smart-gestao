  [2mconsole.log[22m
    
    --- Configurando Empresa A ---
[2m[22m
[2m      [2mat Object.log ([22m[2mTestes/isolamento.test.js[2m:42:17)[22m[2m[22m

(node:32960) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
  [2mconsole.log[22m
    Empresa A configurada e logada.
[2m[22m
[2m      [2mat Object.log ([22m[2mTestes/isolamento.test.js[2m:55:17)[22m[2m[22m

  [2mconsole.log[22m
    
    --- Configurando Empresa B ---
[2m[22m
[2m      [2mat Object.log ([22m[2mTestes/isolamento.test.js[2m:58:17)[22m[2m[22m

  [2mconsole.log[22m
    Empresa B - Cadastro (Status): 201
[2m[22m
[2m      [2mat Object.log ([22m[2mTestes/isolamento.test.js[2m:67:17)[22m[2m[22m

  [2mconsole.log[22m
    Empresa B - Cadastro (Corpo): {
      "message": "Usu√°rio cadastrado com sucesso!"
    }
[2m[22m
[2m      [2mat Object.log ([22m[2mTestes/isolamento.test.js[2m:68:17)[22m[2m[22m

  [2mconsole.log[22m
    Empresa B configurada e logada.
[2m[22m
[2m      [2mat Object.log ([22m[2mTestes/isolamento.test.js[2m:78:17)[22m[2m[22m

  [2mconsole.log[22m
    
    --- Criando transa√ß√£o para Empresa A ---
[2m[22m
[2m      [2mat Object.log ([22m[2mTestes/isolamento.test.js[2m:84:17)[22m[2m[22m

  [2mconsole.log[22m
    Empresa A - Criar Transa√ß√£o (Status): 201
[2m[22m
[2m      [2mat Object.log ([22m[2mTestes/isolamento.test.js[2m:97:17)[22m[2m[22m

  [2mconsole.log[22m
    Empresa A - Criar Transa√ß√£o (Corpo): {
      "companyId": "690bfb9069c98cd4db3f8e0b",
      "userId": "690bfb9069c98cd4db3f8e0e",
      "type": "expense",
      "description": "Transa√ß√£o de Teste Empresa A",
      "amount": 100,
      "date": "2025-11-06T01:36:17.043Z",
      "paymentMethod": "other",
      "status": "pending",
      "_id": "690bfb9169c98cd4db3f8e36",
      "createdAt": "2025-11-06T01:36:17.084Z",
      "updatedAt": "2025-11-06T01:36:17.084Z",
      "__v": 0
    }
[2m[22m
[2m      [2mat Object.log ([22m[2mTestes/isolamento.test.js[2m:98:17)[22m[2m[22m

  [2mconsole.log[22m
    Empresa A - ID da Transa√ß√£o Criada: 690bfb9169c98cd4db3f8e36
[2m[22m
[2m      [2mat Object.log ([22m[2mTestes/isolamento.test.js[2m:102:17)[22m[2m[22m

  [2mconsole.log[22m
    
    --- Tentando acessar transa√ß√£o da Empresa A com token da Empresa B ---
[2m[22m
[2m      [2mat Object.log ([22m[2mTestes/isolamento.test.js[2m:105:17)[22m[2m[22m

  [2mconsole.log[22m
    Enviando: GET para http://localhost:5000/api/transactions/690bfb9169c98cd4db3f8e36 com token da Empresa B
[2m[22m
[2m      [2mat Object.log ([22m[2mTestes/isolamento.test.js[2m:106:17)[22m[2m[22m

  [2mconsole.log[22m
    Empresa B - Acessar Transa√ß√£o (Status): 404
[2m[22m
[2m      [2mat Object.log ([22m[2mTestes/isolamento.test.js[2m:114:21)[22m[2m[22m

  [2mconsole.log[22m
    Empresa B - Acessar Transa√ß√£o (Corpo): "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n<meta charset=\"utf-8\">\n<title>Error</title>\n</head>\n<body>\n<pre>Cannot GET /api/transactions/690bfb9169c98cd4db3f8e36</pre>\n</body>\n</html>\n"
[2m[22m
[2m      [2mat Object.log ([22m[2mTestes/isolamento.test.js[2m:115:21)[22m[2m[22m

  [2mconsole.log[22m
    
    --- Tentando modificar transa√ß√£o da Empresa A com token da Empresa B ---
[2m[22m
[2m      [2mat Object.log ([22m[2mTestes/isolamento.test.js[2m:125:17)[22m[2m[22m

  [2mconsole.log[22m
    Enviando: PUT para http://localhost:5000/api/transactions/690bfb9169c98cd4db3f8e36 com token da Empresa B
[2m[22m
[2m      [2mat Object.log ([22m[2mTestes/isolamento.test.js[2m:127:17)[22m[2m[22m

  [2mconsole.log[22m
    Dados da atualiza√ß√£o: {
      "description": "Tentativa de Modifica√ß√£o pela Empresa B",
      "amount": 999
    }
[2m[22m
[2m      [2mat Object.log ([22m[2mTestes/isolamento.test.js[2m:128:17)[22m[2m[22m

  [2mconsole.log[22m
    Empresa B - Modificar Transa√ß√£o (Status): 404
[2m[22m
[2m      [2mat Object.log ([22m[2mTestes/isolamento.test.js[2m:136:21)[22m[2m[22m

  [2mconsole.log[22m
    Empresa B - Modificar Transa√ß√£o (Corpo): {
      "message": "Transaction n√£o encontrada"
    }
[2m[22m
[2m      [2mat Object.log ([22m[2mTestes/isolamento.test.js[2m:137:21)[22m[2m[22m

  [2mconsole.log[22m
    
    --- Tentando excluir transa√ß√£o da Empresa A com token da Empresa B ---
[2m[22m
[2m      [2mat Object.log ([22m[2mTestes/isolamento.test.js[2m:143:17)[22m[2m[22m

  [2mconsole.log[22m
    Enviando: DELETE para http://localhost:5000/api/transactions/690bfb9169c98cd4db3f8e36 com token da Empresa B
[2m[22m
[2m      [2mat Object.log ([22m[2mTestes/isolamento.test.js[2m:144:17)[22m[2m[22m

  [2mconsole.log[22m
    Empresa B - Excluir Transa√ß√£o (Status): 404
[2m[22m
[2m      [2mat Object.log ([22m[2mTestes/isolamento.test.js[2m:152:21)[22m[2m[22m

  [2mconsole.log[22m
    Empresa B - Excluir Transa√ß√£o (Corpo): {
      "message": "Transaction n√£o encontrada"
    }
[2m[22m
[2m      [2mat Object.log ([22m[2mTestes/isolamento.test.js[2m:153:21)[22m[2m[22m

  [2mconsole.log[22m
    
    --- Tentando listar transa√ß√µes com token da Empresa B ---
[2m[22m
[2m      [2mat Object.log ([22m[2mTestes/isolamento.test.js[2m:161:17)[22m[2m[22m

  [2mconsole.log[22m
    Enviando: GET para http://localhost:5000/api/transactions com token da Empresa B
[2m[22m
[2m      [2mat Object.log ([22m[2mTestes/isolamento.test.js[2m:162:17)[22m[2m[22m

  [2mconsole.log[22m
    Empresa B - Listar Transa√ß√µes (Status): 200
[2m[22m
[2m      [2mat Object.log ([22m[2mTestes/isolamento.test.js[2m:170:17)[22m[2m[22m

  [2mconsole.log[22m
    Empresa B - Listar Transa√ß√µes (Corpo): []
[2m[22m
[2m      [2mat Object.log ([22m[2mTestes/isolamento.test.js[2m:171:17)[22m[2m[22m

[0m[7m[1m[32m PASS [39m[22m[27m[0m [2mTestes/[22m[1misolamento.test.js[22m
  2. Teste de Isolamento de Dados (Transa√ß√µes)
    [32m‚àö[39m [2mdeve impedir o acesso, modifica√ß√£o e exclus√£o de transa√ß√µes entre empresas (288 ms)[22m
    [32m‚àö[39m [2mdeve impedir que a Empresa B liste todas as transa√ß√µes da Empresa A (53 ms)[22m

  [2mconsole.log[22m
    
    --- Teste: Cadastrar novo usu√°rio ---
[2m[22m
[2m      [2mat Object.log ([22m[2mTestes/api.test.js[2m:50:17)[22m[2m[22m

  [2mconsole.log[22m
    Enviando: {
      "name": "Usu√°rio A",
      "email": "empresaA_1762392977488@test.com",
      "password": "password123",
      "companyName": "Empresa A Teste 1762392977488",
      "cnpj": "01762392977488"
    }
[2m[22m
[2m      [2mat Object.log ([22m[2mTestes/api.test.js[2m:51:17)[22m[2m[22m

  [2mconsole.log[22m
    Recebido (Status): 201
[2m[22m
[2m      [2mat Object.log ([22m[2mTestes/api.test.js[2m:56:21)[22m[2m[22m

  [2mconsole.log[22m
    Recebido (Corpo): {
      "message": "Usu√°rio cadastrado com sucesso!"
    }
[2m[22m
[2m      [2mat Object.log ([22m[2mTestes/api.test.js[2m:57:21)[22m[2m[22m

  [2mconsole.log[22m
    
    --- Teste: Barrar e-mail duplicado ---
[2m[22m
[2m      [2mat Object.log ([22m[2mTestes/api.test.js[2m:79:17)[22m[2m[22m

  [2mconsole.log[22m
    Enviando: {
      "name": "Usu√°rio A",
      "email": "empresaA_1762392977488@test.com",
      "password": "password123",
      "companyName": "Nome Duplicado",
      "cnpj": "11223344556677"
    }
[2m[22m
[2m      [2mat Object.log ([22m[2mTestes/api.test.js[2m:80:17)[22m[2m[22m

  [2mconsole.log[22m
    Recebido (Status): 409
[2m[22m
[2m      [2mat Object.log ([22m[2mTestes/api.test.js[2m:86:21)[22m[2m[22m

  [2mconsole.log[22m
    Recebido (Corpo): {
      "message": "E-mail j√° cadastrado."
    }
[2m[22m
[2m      [2mat Object.log ([22m[2mTestes/api.test.js[2m:87:21)[22m[2m[22m

  [2mconsole.log[22m
    
    --- Teste: Login com senha incorreta ---
[2m[22m
[2m      [2mat Object.log ([22m[2mTestes/api.test.js[2m:101:17)[22m[2m[22m

  [2mconsole.log[22m
    Enviando: {
      "email": "empresaA_1762392977488@test.com",
      "password": "senha-errada"
    }
[2m[22m
[2m      [2mat Object.log ([22m[2mTestes/api.test.js[2m:102:17)[22m[2m[22m

  [2mconsole.log[22m
    Recebido (Status): 401
[2m[22m
[2m      [2mat Object.log ([22m[2mTestes/api.test.js[2m:107:21)[22m[2m[22m

  [2mconsole.log[22m
    Recebido (Corpo): {
      "message": "Credenciais inv√°lidas."
    }
[2m[22m
[2m      [2mat Object.log ([22m[2mTestes/api.test.js[2m:108:21)[22m[2m[22m

  [2mconsole.log[22m
    
    --- Teste: Login com sucesso ---
[2m[22m
[2m      [2mat Object.log ([22m[2mTestes/api.test.js[2m:122:17)[22m[2m[22m

  [2mconsole.log[22m
    Enviando: {
      "email": "empresaA_1762392977488@test.com",
      "password": "password123"
    }
[2m[22m
[2m      [2mat Object.log ([22m[2mTestes/api.test.js[2m:123:17)[22m[2m[22m

  [2mconsole.log[22m
    Recebido (Status): 200
[2m[22m
[2m      [2mat Object.log ([22m[2mTestes/api.test.js[2m:127:17)[22m[2m[22m

  [2mconsole.log[22m
    Recebido (Corpo): {
      "user": {
        "name": "Usu√°rio A",
        "email": "empresaa_1762392977488@test.com"
      },
      "message": "Tokens recebidos"
    }
[2m[22m
[2m      [2mat Object.log ([22m[2mTestes/api.test.js[2m:128:17)[22m[2m[22m

  [2mconsole.log[22m
    
    --- Teste: Acesso a rota protegida sem token ---
[2m[22m
[2m      [2mat Object.log ([22m[2mTestes/api.test.js[2m:141:17)[22m[2m[22m

  [2mconsole.log[22m
    Enviando: GET para http://localhost:5000/api/transactions
[2m[22m
[2m      [2mat Object.log ([22m[2mTestes/api.test.js[2m:142:17)[22m[2m[22m

  [2mconsole.log[22m
    Recebido (Status): 401
[2m[22m
[2m      [2mat Object.log ([22m[2mTestes/api.test.js[2m:148:21)[22m[2m[22m

  [2mconsole.log[22m
    Recebido (Corpo): {
      "message": "Token ausente ou formato inv√°lido"
    }
[2m[22m
[2m      [2mat Object.log ([22m[2mTestes/api.test.js[2m:149:21)[22m[2m[22m

[0m[7m[1m[32m PASS [39m[22m[27m[0m [2mTestes/[22m[1mapi.test.js[22m
  1. M√≥dulo de Autentica√ß√£o
    [32m‚àö[39m [2mRF-001: deve cadastrar um novo usu√°rio e empresa (Empresa A) (179 ms)[22m
    [32m‚àö[39m [2mdeve barrar o cadastro de um usu√°rio com e-mail j√° existente (52 ms)[22m
    [32m‚àö[39m [2mdeve falhar o login com senha incorreta (88 ms)[22m
    [32m‚àö[39m [2mdeve realizar o login com sucesso para a Empresa A (128 ms)[22m
    [32m‚àö[39m [2mdeve proteger rotas, barrando acesso sem token (13 ms)[22m

----------|---------|----------|---------|---------|-------------------
File      | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s 
----------|---------|----------|---------|---------|-------------------
All files |       0 |        0 |       0 |       0 | [31;1m                 [0m 
----------|---------|----------|---------|---------|-------------------
[1mTest Suites: [22m[1m[32m2 passed[39m[22m, 2 total
[1mTests:       [22m[1m[32m7 passed[39m[22m, 7 total
[1mSnapshots:   [22m0 total
[1mTime:[22m        3.212 s
[2mRan all test suites[22m[2m.[22m
