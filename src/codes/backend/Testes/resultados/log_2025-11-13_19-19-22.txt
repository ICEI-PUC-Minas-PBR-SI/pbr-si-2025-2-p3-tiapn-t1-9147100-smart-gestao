
--- ðŸš€ [GLOBAL SETUP] Iniciando ambiente de teste ---
â³ Iniciando servidor Smart GestÃ£o (startServer)...
ConexÃ£o com o MongoDB estabelecida com sucesso.
âœ… [1/3] ConexÃ£o com o banco de dados estabelecida!
Verificando permissÃµes de sistema...
PermissÃµes de sistema jÃ¡ existem. Nenhuma aÃ§Ã£o necessÃ¡ria.
âœ… [2/3] PermissÃµes do sistema validadas/inicializadas.
âœ… [3/3] Servidor rodando na porta 5000
--- âœ… [GLOBAL SETUP] Ambiente pronto e servidor iniciado ---
(node:22136) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
POST /api/clients 201 34.925 ms - 332
[LOG] AÃ§Ã£o: CREATE_CLIENT | UsuÃ¡rio: 6916596d9c46bcc9dad23520
GET /api/clients 200 27.093 ms - 568
PUT /api/clients/6916596e9c46bcc9dad23530 200 33.205 ms - 355
[LOG] AÃ§Ã£o: UPDATE_CLIENT | UsuÃ¡rio: 6916596d9c46bcc9dad23520
DELETE /api/clients/6916596e9c46bcc9dad23530 200 28.802 ms - 70
GET /api/clients/6916596e9c46bcc9dad23530 404 1.165 ms - 175
[LOG] AÃ§Ã£o: DELETE_CLIENT | UsuÃ¡rio: 6916596d9c46bcc9dad23520
DELETE /api/clients/6916596e9c46bcc9dad23530 404 25.848 ms - 68
PASS Testes/2-features/clients.test.js
  7. MÃ³dulo de Clientes/Fornecedores
    âˆš deve CRIAR um novo cliente com sucesso (74 ms)
    âˆš deve LISTAR os clientes da empresa (30 ms)
    âˆš deve ATUALIZAR um cliente existente (37 ms)
    âˆš deve EXCLUIR um cliente existente (42 ms)

[LOG] AÃ§Ã£o: DELETE_CLIENT | UsuÃ¡rio: 6916596d9c46bcc9dad23520
[LOG] AÃ§Ã£o: CREATE_GOAL | UsuÃ¡rio: 6916596d9c46bcc9dad23520
POST /api/goals 201 44.951 ms - 404
GET /api/goals 200 27.293 ms - 406
[LOG] AÃ§Ã£o: UPDATE_GOAL | UsuÃ¡rio: 6916596d9c46bcc9dad23520
PUT /api/goals/6916596e9c46bcc9dad23543 200 46.461 ms - 414
[LOG] AÃ§Ã£o: DELETE_GOAL | UsuÃ¡rio: 6916596d9c46bcc9dad23520
DELETE /api/goals/6916596e9c46bcc9dad23543 200 52.468 ms - 67
GET /api/goals/6916596e9c46bcc9dad23543 404 26.407 ms - 65
DELETE /api/goals/6916596e9c46bcc9dad23543 404 25.338 ms - 65
PASS Testes/2-features/goals.test.js
  5. MÃ³dulo de Metas (CRUD)
    âˆš deve CRIAR uma nova meta com sucesso (60 ms)
    âˆš deve LISTAR as metas do usuÃ¡rio logado (31 ms)
    âˆš deve ATUALIZAR uma meta existente (51 ms)
    âˆš deve EXCLUIR uma meta existente (95 ms)

[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 6916596d9c46bcc9dad23520
POST /api/transactions 201 44.638 ms - 468
[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 6916596d9c46bcc9dad23520
POST /api/transactions 400 13.809 ms - 277
[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 6916596d9c46bcc9dad23520
GET /api/transactions 200 32.648 ms - 855
GET /api/transactions/6916596f9c46bcc9dad23556 200 26.534 ms - 452
[LOG] AÃ§Ã£o: UPDATE_TRANSACTION | UsuÃ¡rio: 6916596d9c46bcc9dad23520
PUT /api/transactions/6916596f9c46bcc9dad23556 200 44.845 ms - 452
[LOG] AÃ§Ã£o: UPDATE_TRANSACTION | UsuÃ¡rio: 6916596d9c46bcc9dad23520
[LOG] AÃ§Ã£o: DELETE_TRANSACTION | UsuÃ¡rio: 6916596d9c46bcc9dad23520
DELETE /api/transactions/6916596f9c46bcc9dad23556 200 45.121 ms - 73
[LOG] AÃ§Ã£o: DELETE_TRANSACTION | UsuÃ¡rio: 6916596d9c46bcc9dad23520
GET /api/transactions/6916596f9c46bcc9dad23556 404 26.174 ms - 71
DELETE /api/transactions/6916596f9c46bcc9dad23556 404 25.134 ms - 71
PASS Testes/2-features/transactions.test.js
  4. MÃ³dulo de TransaÃ§Ãµes (CRUD)
    âˆš deve CRIAR uma nova transaÃ§Ã£o com sucesso (55 ms)
    âˆš deve falhar ao tentar criar uma transaÃ§Ã£o com dados invÃ¡lidos (24 ms)
    âˆš deve LISTAR as transaÃ§Ãµes do usuÃ¡rio logado (35 ms)
    âˆš deve OBTER uma transaÃ§Ã£o especÃ­fica pelo ID (29 ms)
    âˆš deve ATUALIZAR uma transaÃ§Ã£o existente (51 ms)
    âˆš deve EXCLUIR uma transaÃ§Ã£o existente (79 ms)

[LOG] AÃ§Ã£o: DELETE_TRANSACTION | UsuÃ¡rio: 6916596d9c46bcc9dad23520
[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 6916596d9c46bcc9dad23520
POST /api/transactions 201 43.803 ms - 446
POST /api/transactions/6916596f9c46bcc9dad23577/upload 404 1.106 ms - 188
[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 6916596d9c46bcc9dad23520
[LOG] AÃ§Ã£o: DELETE_TRANSACTION | UsuÃ¡rio: 6916596d9c46bcc9dad23520
DELETE /api/transactions/6916596f9c46bcc9dad23577 200 43.793 ms - 73
[LOG] AÃ§Ã£o: DELETE_TRANSACTION | UsuÃ¡rio: 6916596d9c46bcc9dad23520
[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 6916596d9c46bcc9dad23520
POST /api/transactions 201 43.518 ms - 444
POST /api/transactions/691659709c46bcc9dad23584/upload 404 0.589 ms - 188
[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 6916596d9c46bcc9dad23520
[LOG] AÃ§Ã£o: DELETE_TRANSACTION | UsuÃ¡rio: 6916596d9c46bcc9dad23520
DELETE /api/transactions/691659709c46bcc9dad23584 200 51.380 ms - 73
[LOG] AÃ§Ã£o: DELETE_TRANSACTION | UsuÃ¡rio: 6916596d9c46bcc9dad23520
[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 6916596d9c46bcc9dad23520
POST /api/transactions 201 43.291 ms - 444
POST /api/transactions/691659709c46bcc9dad23591/upload 404 0.657 ms - 188
[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 6916596d9c46bcc9dad23520
[LOG] AÃ§Ã£o: DELETE_TRANSACTION | UsuÃ¡rio: 6916596d9c46bcc9dad23520
DELETE /api/transactions/691659709c46bcc9dad23591 200 43.456 ms - 73
[LOG] AÃ§Ã£o: DELETE_TRANSACTION | UsuÃ¡rio: 6916596d9c46bcc9dad23520
[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 6916596d9c46bcc9dad23520
POST /api/transactions 201 44.129 ms - 445
POST /api/transactions/691659709c46bcc9dad2359e/upload 404 0.628 ms - 188
[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 6916596d9c46bcc9dad23520
[LOG] AÃ§Ã£o: DELETE_TRANSACTION | UsuÃ¡rio: 6916596d9c46bcc9dad23520
DELETE /api/transactions/691659709c46bcc9dad2359e 200 43.969 ms - 73
POST /api/transactions/60d5f1f77c3d4a001f5e8e1z/upload 404 0.644 ms - 188
FAIL Testes/2-features/uploads.test.js
  Feature: Uploads
    Upload de PDF
      Ã— Deve permitir o upload de um anexo (PDF) para uma transaÃ§Ã£o (14 ms)
      Ã— Deve permitir a exclusÃ£o de um anexo (PDF) de uma transaÃ§Ã£o (2 ms)
    Upload de Imagem (PNG)
      Ã— Deve permitir o upload de um anexo de imagem (.png) para uma transaÃ§Ã£o (3 ms)
      Ã— Deve permitir a exclusÃ£o de um anexo de imagem (.png)
    Upload de Imagem (JPG)
      Ã— Deve permitir o upload de um anexo de imagem (.jpg) para uma transaÃ§Ã£o (4 ms)
      Ã— Deve permitir a exclusÃ£o de um anexo de imagem (.jpg) (1 ms)
    Upload de Imagem (JPEG)
      Ã— Deve permitir o upload de um anexo de imagem (.jpeg) para uma transaÃ§Ã£o (5 ms)
      Ã— Deve permitir a exclusÃ£o de um anexo de imagem (.jpeg)
    CenÃ¡rios de Erro e Estruturais
      âˆš Deve retornar 404 ao tentar fazer upload para uma transaÃ§Ã£o inexistente (4 ms)

  â— Feature: Uploads â€º Upload de PDF â€º Deve permitir o upload de um anexo (PDF) para uma transaÃ§Ã£o

    AxiosError: Request failed with status code 404

      63 |             form.append('attachment', fs.createReadStream(filePath));
      64 |
    > 65 |             const response = await axios.post(
         |                              ^
      66 |                 `${apiUrl}/transactions/${transactionId}/upload`,
      67 |                 form,
      68 |                 { headers: { ...form.getHeaders(), Authorization: `Bearer ${companyA.token}` } }

      at settle (node_modules/axios/lib/core/settle.js:19:12)
      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:793:11)
      at Axios.request (node_modules/axios/lib/core/Axios.js:45:41)
      at Object.<anonymous> (Testes/2-features/uploads.test.js:65:30)

  â— Feature: Uploads â€º Upload de PDF â€º Deve permitir a exclusÃ£o de um anexo (PDF) de uma transaÃ§Ã£o

    expect(received).toBeDefined()

    Received: undefined

      80 |
      81 |         it('Deve permitir a exclusÃ£o de um anexo (PDF) de uma transaÃ§Ã£o', async () => {
    > 82 |             expect(attachmentPath).toBeDefined();
         |                                    ^
      83 |
      84 |             const response = await axios.delete(
      85 |                 `${apiUrl}/transactions/${transactionId}/upload`,

      at Object.toBeDefined (Testes/2-features/uploads.test.js:82:36)

  â— Feature: Uploads â€º Upload de Imagem (PNG) â€º Deve permitir o upload de um anexo de imagem (.png) para uma transaÃ§Ã£o

    AxiosError: Request failed with status code 404

      140 |             form.append('attachment', fs.createReadStream(filePath));
      141 |
    > 142 |             const response = await axios.post(
          |                              ^
      143 |                 `${apiUrl}/transactions/${transactionId}/upload`,
      144 |                 form,
      145 |                 { headers: { ...form.getHeaders(), Authorization: `Bearer ${companyA.token}` } }

      at settle (node_modules/axios/lib/core/settle.js:19:12)
      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:793:11)
      at Axios.request (node_modules/axios/lib/core/Axios.js:45:41)
      at Object.<anonymous> (Testes/2-features/uploads.test.js:142:30)

  â— Feature: Uploads â€º Upload de Imagem (PNG) â€º Deve permitir a exclusÃ£o de um anexo de imagem (.png)

    expect(received).toBeDefined()

    Received: undefined

      156 |
      157 |         it(`Deve permitir a exclusÃ£o de um anexo de imagem (.${extension})`, async () => {
    > 158 |             expect(attachmentPath).toBeDefined();
          |                                    ^
      159 |             const response = await axios.delete(
      160 |                 `${apiUrl}/transactions/${transactionId}/upload`,
      161 |                 { headers: { Authorization: `Bearer ${companyA.token}` } }

      at Object.toBeDefined (Testes/2-features/uploads.test.js:158:36)

  â— Feature: Uploads â€º Upload de Imagem (JPG) â€º Deve permitir o upload de um anexo de imagem (.jpg) para uma transaÃ§Ã£o

    AxiosError: Request failed with status code 404

      140 |             form.append('attachment', fs.createReadStream(filePath));
      141 |
    > 142 |             const response = await axios.post(
          |                              ^
      143 |                 `${apiUrl}/transactions/${transactionId}/upload`,
      144 |                 form,
      145 |                 { headers: { ...form.getHeaders(), Authorization: `Bearer ${companyA.token}` } }

      at settle (node_modules/axios/lib/core/settle.js:19:12)
      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:793:11)
      at Axios.request (node_modules/axios/lib/core/Axios.js:45:41)
      at Object.<anonymous> (Testes/2-features/uploads.test.js:142:30)

  â— Feature: Uploads â€º Upload de Imagem (JPG) â€º Deve permitir a exclusÃ£o de um anexo de imagem (.jpg)

    expect(received).toBeDefined()

    Received: undefined

      156 |
      157 |         it(`Deve permitir a exclusÃ£o de um anexo de imagem (.${extension})`, async () => {
    > 158 |             expect(attachmentPath).toBeDefined();
          |                                    ^
      159 |             const response = await axios.delete(
      160 |                 `${apiUrl}/transactions/${transactionId}/upload`,
      161 |                 { headers: { Authorization: `Bearer ${companyA.token}` } }

      at Object.toBeDefined (Testes/2-features/uploads.test.js:158:36)

  â— Feature: Uploads â€º Upload de Imagem (JPEG) â€º Deve permitir o upload de um anexo de imagem (.jpeg) para uma transaÃ§Ã£o

    AxiosError: Request failed with status code 404

      140 |             form.append('attachment', fs.createReadStream(filePath));
      141 |
    > 142 |             const response = await axios.post(
          |                              ^
      143 |                 `${apiUrl}/transactions/${transactionId}/upload`,
      144 |                 form,
      145 |                 { headers: { ...form.getHeaders(), Authorization: `Bearer ${companyA.token}` } }

      at settle (node_modules/axios/lib/core/settle.js:19:12)
      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:793:11)
      at Axios.request (node_modules/axios/lib/core/Axios.js:45:41)
      at Object.<anonymous> (Testes/2-features/uploads.test.js:142:30)

  â— Feature: Uploads â€º Upload de Imagem (JPEG) â€º Deve permitir a exclusÃ£o de um anexo de imagem (.jpeg)

    expect(received).toBeDefined()

    Received: undefined

      156 |
      157 |         it(`Deve permitir a exclusÃ£o de um anexo de imagem (.${extension})`, async () => {
    > 158 |             expect(attachmentPath).toBeDefined();
          |                                    ^
      159 |             const response = await axios.delete(
      160 |                 `${apiUrl}/transactions/${transactionId}/upload`,
      161 |                 { headers: { Authorization: `Bearer ${companyA.token}` } }

      at Object.toBeDefined (Testes/2-features/uploads.test.js:158:36)

Test Suites: 1 failed, 3 passed, 4 total
Tests:       8 failed, 15 passed, 23 total
Snapshots:   0 total
Time:        2.291 s
Ran all test suites matching Testes/2-features/.

--- ðŸ§¹ [GLOBAL TEARDOWN] Finalizando ambiente de teste ---
[LOG] AÃ§Ã£o: DELETE_TRANSACTION | UsuÃ¡rio: 6916596d9c46bcc9dad23520
   - [OK] Dados de teste temporÃ¡rios foram removidos.
âœ… Servidor e conexÃ£o com MongoDB encerrados (stopServer).
--- âœ… [GLOBAL TEARDOWN] Ambiente finalizado com sucesso ---

--- FIM DOS TESTES AUTOMATIZADOS (Status: Falha) ---
