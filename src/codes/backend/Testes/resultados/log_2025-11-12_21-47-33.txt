
--- ğŸš€ [ETAPA 1 de 4] Iniciando Ambiente de Teste (Jest Environment) ---
   - [PROCESSO] Lendo configuraÃ§Ã£o do banco de dados de teste...
   - [ATENÃ‡ÃƒO] Usando banco de dados de DESENVOLVIMENTO para os testes. As coleÃ§Ãµes serÃ£o limpas.

--- ğŸš€ [ETAPA 2 de 4] Limpando e populando o banco de dados de TESTE ---
   - [OK] Dados de teste (empresas e usuÃ¡rios) criados e salvos em test-setup.json.
(node:29528) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)

--- ğŸ§¹ [ENV] Desconectando do banco de dados ---
--- âœ… [ENV] Ambiente de teste finalizado ---
 PASS  Testes/2-features/transactions.test.js
  4. MÃ³dulo de TransaÃ§Ãµes (CRUD)
    âˆš deve CRIAR uma nova transaÃ§Ã£o com sucesso (131 ms)
    âˆš deve falhar ao tentar criar uma transaÃ§Ã£o com dados invÃ¡lidos (29 ms)
    âˆš deve LISTAR as transaÃ§Ãµes do usuÃ¡rio logado (36 ms)
    âˆš deve OBTER uma transaÃ§Ã£o especÃ­fica pelo ID (32 ms)
    âˆš deve ATUALIZAR uma transaÃ§Ã£o existente (61 ms)
    âˆš deve EXCLUIR uma transaÃ§Ã£o existente (90 ms)


--- ğŸš€ [ETAPA 1 de 4] Iniciando Ambiente de Teste (Jest Environment) ---
   - [PROCESSO] Lendo configuraÃ§Ã£o do banco de dados de teste...
   - [ATENÃ‡ÃƒO] Usando banco de dados de DESENVOLVIMENTO para os testes. As coleÃ§Ãµes serÃ£o limpas.

--- ğŸš€ [ETAPA 2 de 4] Limpando e populando o banco de dados de TESTE ---
   - [OK] Dados de teste (empresas e usuÃ¡rios) criados e salvos em test-setup.json.
  console.log
    
    --- Configurando 3 empresas para o teste multi-tenant ---

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:19:17)

  console.log
    âœ… Empresa 1 (Empresa Teste 1762994858898) cadastrada e logada.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:48:21)

  console.log
    âœ… Empresa 2 (Empresa Teste 1762994859263) cadastrada e logada.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:48:21)

  console.log
    âœ… Empresa 3 (Empresa Teste 1762994859575) cadastrada e logada.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:48:21)

  console.log
    --- ConfiguraÃ§Ã£o multi-tenant concluÃ­da ---

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:50:17)

  console.log
    
    --- Criando transaÃ§Ãµes individuais para cada empresa ---

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:55:17)

  console.log
    TransaÃ§Ã£o criada para Empresa Teste 1762994858898. ID: 69152aabb5d503ed3deda698

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:76:21)

  console.log
    TransaÃ§Ã£o criada para Empresa Teste 1762994859263. ID: 69152aabb5d503ed3deda69f

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:76:21)

  console.log
    TransaÃ§Ã£o criada para Empresa Teste 1762994859575. ID: 69152aabb5d503ed3deda6a6

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:76:21)

  console.log
    
    --- Validando isolamento de dados entre todas as empresas ---

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:82:17)

  console.log
    
    Verificando a transaÃ§Ã£o 69152aabb5d503ed3deda698 da Empresa Teste 1762994858898

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:89:21)

  console.log
    - OK: Empresa Teste 1762994859263 foi bloqueada (Status 404).

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:107:29)

  console.log
    - OK: Empresa Teste 1762994859575 foi bloqueada (Status 404).

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:107:29)

  console.log
    
    Verificando a transaÃ§Ã£o 69152aabb5d503ed3deda69f da Empresa Teste 1762994859263

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:89:21)

  console.log
    - OK: Empresa Teste 1762994858898 foi bloqueada (Status 404).

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:107:29)

  console.log
    - OK: Empresa Teste 1762994859575 foi bloqueada (Status 404).

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:107:29)

  console.log
    
    Verificando a transaÃ§Ã£o 69152aabb5d503ed3deda6a6 da Empresa Teste 1762994859575

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:89:21)

  console.log
    - OK: Empresa Teste 1762994858898 foi bloqueada (Status 404).

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:107:29)

  console.log
    - OK: Empresa Teste 1762994859263 foi bloqueada (Status 404).

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:107:29)

  console.log
    
    --- Validando listagem de transaÃ§Ãµes ---

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:114:17)

  console.log
    - OK: Empresa Teste 1762994858898 listou apenas sua prÃ³pria transaÃ§Ã£o.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:126:21)

  console.log
    - OK: Empresa Teste 1762994859263 listou apenas sua prÃ³pria transaÃ§Ã£o.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:126:21)

  console.log
    - OK: Empresa Teste 1762994859575 listou apenas sua prÃ³pria transaÃ§Ã£o.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:126:21)

  console.log
    
    --- Limpando dados de teste (Teardown) ---

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:132:17)

  console.log
    - âœ… Empresa Empresa Teste 1762994858898 e dados associados excluÃ­dos com sucesso.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:139:25)

  console.log
    - âœ… Empresa Empresa Teste 1762994859263 e dados associados excluÃ­dos com sucesso.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:139:25)

  console.log
    - âœ… Empresa Empresa Teste 1762994859575 e dados associados excluÃ­dos com sucesso.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:139:25)


--- ğŸ§¹ [ENV] Desconectando do banco de dados ---
--- âœ… [ENV] Ambiente de teste finalizado ---
 PASS  Testes/3-security/multi-tenant.test.js
  3. Teste de Isolamento de Dados em Larga Escala (Multi-Tenant)
    âˆš deve criar uma transaÃ§Ã£o para cada empresa (174 ms)
    âˆš deve impedir que uma empresa acesse a transaÃ§Ã£o de outra (205 ms)
    âˆš deve garantir que cada empresa liste apenas suas prÃ³prias transaÃ§Ãµes (103 ms)


--- ğŸš€ [ETAPA 1 de 4] Iniciando Ambiente de Teste (Jest Environment) ---
   - [PROCESSO] Lendo configuraÃ§Ã£o do banco de dados de teste...
   - [ATENÃ‡ÃƒO] Usando banco de dados de DESENVOLVIMENTO para os testes. As coleÃ§Ãµes serÃ£o limpas.

--- ğŸš€ [ETAPA 2 de 4] Limpando e populando o banco de dados de TESTE ---
   - [OK] Dados de teste (empresas e usuÃ¡rios) criados e salvos em test-setup.json.

--- ğŸ§¹ [ENV] Desconectando do banco de dados ---
--- âœ… [ENV] Ambiente de teste finalizado ---
 FAIL  Testes/4-reports/reports.test.js
  8. MÃ³dulo de RelatÃ³rios
    Ã— deve EXPORTAR um relatÃ³rio de transaÃ§Ãµes, validar seu conteÃºdo e salvÃ¡-lo (139 ms)
    Ã— deve EXPORTAR um relatÃ³rio de clientes, validar seu conteÃºdo e salvÃ¡-lo (62 ms)
    Ã— deve EXPORTAR uma fatura de transaÃ§Ã£o, validar seu conteÃºdo e salvÃ¡-la (1 ms)

  â— 8. MÃ³dulo de RelatÃ³rios â€º deve EXPORTAR um relatÃ³rio de transaÃ§Ãµes, validar seu conteÃºdo e salvÃ¡-lo

    TypeError: pdf is not a function

      43 |
      44 |     // Valida o conteÃºdo do PDF
    > 45 |     const pdfData = await pdf(pdfBuffer);
         |                           ^
      46 |     expect(pdfData.text).toContain('RelatÃ³rio de TransaÃ§Ãµes');
      47 |     expect(pdfData.text).toContain(companyA.name); // Nome da Empresa
      48 |     expect(pdfData.text).toContain('Compra de Material de EscritÃ³rio'); // Valida se uma das transaÃ§Ãµes estÃ¡ no relatÃ³rio

      at Object.<anonymous> (Testes/4-reports/reports.test.js:45:27)

  â— 8. MÃ³dulo de RelatÃ³rios â€º deve EXPORTAR um relatÃ³rio de clientes, validar seu conteÃºdo e salvÃ¡-lo

    TypeError: pdf is not a function

      74 |     expect(response.status).toBe(200);
      75 |     const pdfBuffer = Buffer.from(response.data, 'binary');
    > 76 |     const pdfData = await pdf(pdfBuffer);
         |                           ^
      77 |     expect(pdfData.text).toContain('RelatÃ³rio de Clientes');
      78 |     expect(pdfData.text).toContain(companyA.testClient.name); // Valida com dados do setup
      79 |

      at Object.<anonymous> (Testes/4-reports/reports.test.js:76:27)

  â— 8. MÃ³dulo de RelatÃ³rios â€º deve EXPORTAR uma fatura de transaÃ§Ã£o, validar seu conteÃºdo e salvÃ¡-la

    ReferenceError: testTransaction is not defined

      82 |
      83 |   test('deve EXPORTAR uma fatura de transaÃ§Ã£o, validar seu conteÃºdo e salvÃ¡-la', async () => {
    > 84 |     const response = await axios.get(`${API_URL}/reports/export/invoice/${testTransaction._id}`, {
         |                                                                           ^
      85 |       headers: { Authorization: `Bearer ${companyA.token}` },
      86 |       responseType: 'arraybuffer',
      87 |     });

      at Object.<anonymous> (Testes/4-reports/reports.test.js:84:75)


--- ğŸš€ [ETAPA 1 de 4] Iniciando Ambiente de Teste (Jest Environment) ---
   - [PROCESSO] Lendo configuraÃ§Ã£o do banco de dados de teste...
   - [ATENÃ‡ÃƒO] Usando banco de dados de DESENVOLVIMENTO para os testes. As coleÃ§Ãµes serÃ£o limpas.

--- ğŸš€ [ETAPA 2 de 4] Limpando e populando o banco de dados de TESTE ---
   - [OK] Dados de teste (empresas e usuÃ¡rios) criados e salvos em test-setup.json.

--- ğŸ§¹ [ENV] Desconectando do banco de dados ---
--- âœ… [ENV] Ambiente de teste finalizado ---
 PASS  Testes/2-features/goals.test.js
  5. MÃ³dulo de Metas (CRUD)
    âˆš deve CRIAR uma nova meta com sucesso (74 ms)
    âˆš deve LISTAR as metas do usuÃ¡rio logado (31 ms)
    âˆš deve ATUALIZAR uma meta existente (72 ms)
    âˆš deve EXCLUIR uma meta existente (84 ms)


--- ğŸš€ [ETAPA 1 de 4] Iniciando Ambiente de Teste (Jest Environment) ---
   - [PROCESSO] Lendo configuraÃ§Ã£o do banco de dados de teste...
   - [ATENÃ‡ÃƒO] Usando banco de dados de DESENVOLVIMENTO para os testes. As coleÃ§Ãµes serÃ£o limpas.

--- ğŸš€ [ETAPA 2 de 4] Limpando e populando o banco de dados de TESTE ---
   - [OK] Dados de teste (empresas e usuÃ¡rios) criados e salvos em test-setup.json.

--- ğŸ§¹ [ENV] Desconectando do banco de dados ---
--- âœ… [ENV] Ambiente de teste finalizado ---
 PASS  Testes/2-features/clients.test.js
  7. MÃ³dulo de Clientes/Fornecedores
    âˆš deve CRIAR um novo cliente com sucesso (49 ms)
    âˆš deve LISTAR os clientes da empresa (30 ms)
    âˆš deve ATUALIZAR um cliente existente (37 ms)
    âˆš deve EXCLUIR um cliente existente (42 ms)


--- ğŸš€ [ETAPA 1 de 4] Iniciando Ambiente de Teste (Jest Environment) ---
   - [PROCESSO] Lendo configuraÃ§Ã£o do banco de dados de teste...
   - [ATENÃ‡ÃƒO] Usando banco de dados de DESENVOLVIMENTO para os testes. As coleÃ§Ãµes serÃ£o limpas.

--- ğŸš€ [ETAPA 2 de 4] Limpando e populando o banco de dados de TESTE ---
   - [OK] Dados de teste (empresas e usuÃ¡rios) criados e salvos em test-setup.json.
  console.log
    
    --- Teste: Solicitar reset para e-mail invÃ¡lido ---

      at Object.<anonymous> (Testes/1-auth/password.test.js:26:13)

  console.log
    âœ… Falhou como esperado para e-mail inexistente (Status 404).

      at Object.<anonymous> (Testes/1-auth/password.test.js:35:15)

  console.log
    
    --- Teste: Gerar token de reset com sucesso ---

      at Object.<anonymous> (Testes/1-auth/password.test.js:40:13)

  console.log
    âœ… Token de reset gerado e salvo no banco de dados.

      at Object.<anonymous> (Testes/1-auth/password.test.js:54:13)

  console.log
    
    --- Teste: Resetar senha com token vÃ¡lido ---

      at Object.<anonymous> (Testes/1-auth/password.test.js:58:13)

  console.log
    âœ… Senha resetada com sucesso via API.

      at Object.<anonymous> (Testes/1-auth/password.test.js:75:13)

  console.log
    âœ… Token de reset foi invalidado no banco.

      at Object.<anonymous> (Testes/1-auth/password.test.js:82:13)

  console.log
    âœ… Login com a nova senha realizado com sucesso.

      at Object.<anonymous> (Testes/1-auth/password.test.js:92:13)


--- ğŸ§¹ [ENV] Desconectando do banco de dados ---
--- âœ… [ENV] Ambiente de teste finalizado ---
 PASS  Testes/1-auth/password.test.js
  9. MÃ³dulo de RecuperaÃ§Ã£o de Senha
    âˆš deve falhar ao solicitar reset para um e-mail inexistente (34 ms)
    âˆš deve gerar e salvar um token de reset para um e-mail vÃ¡lido (56 ms)
    âˆš deve resetar a senha com um token vÃ¡lido e permitir login com a nova senha (296 ms)


--- ğŸš€ [ETAPA 1 de 4] Iniciando Ambiente de Teste (Jest Environment) ---
   - [PROCESSO] Lendo configuraÃ§Ã£o do banco de dados de teste...
   - [ATENÃ‡ÃƒO] Usando banco de dados de DESENVOLVIMENTO para os testes. As coleÃ§Ãµes serÃ£o limpas.

--- ğŸš€ [ETAPA 2 de 4] Limpando e populando o banco de dados de TESTE ---
   - [OK] Dados de teste (empresas e usuÃ¡rios) criados e salvos em test-setup.json.

--- ğŸ§¹ [ENV] Desconectando do banco de dados ---
--- âœ… [ENV] Ambiente de teste finalizado ---
 PASS  Testes/1-auth/auth.test.js
  6. MÃ³dulo de AutenticaÃ§Ã£o e SessÃ£o (Stateful)
    âˆš deve criar um SessionToken no banco de dados apÃ³s o login (123 ms)
    âˆš deve invalidar o SessionToken no banco de dados apÃ³s o logout (140 ms)

Test Suites: 1 failed, 6 passed, 7 total
Tests:       3 failed, 22 passed, 25 total
Snapshots:   0 total
Time:        13.725 s
Ran all test suites.

--- FIM DOS TESTES AUTOMATIZADOS (Status: Falha) ---
