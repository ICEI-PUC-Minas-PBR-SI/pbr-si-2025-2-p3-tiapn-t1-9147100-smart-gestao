
--- üöÄ [ETAPA 1 de 4] Iniciando Ambiente de Teste (Jest Environment) ---
   - [PROCESSO] Lendo configura√ß√£o do banco de dados de teste...
   - [ATEN√á√ÉO] Usando banco de dados de DESENVOLVIMENTO para os testes. As cole√ß√µes ser√£o limpas.

--- üöÄ [ETAPA 2 de 4] Limpando e populando o banco de dados de TESTE ---
   - [OK] Dados de teste (empresas e usu√°rios) criados e salvos em test-setup.json.
‚è≥ Iniciando servidor Smart Gest√£o (startServer)...
Conex√£o com o MongoDB estabelecida com sucesso.
Verificando permiss√µes de sistema...
Permiss√µes de sistema j√° existem. Nenhuma a√ß√£o necess√°ria.
‚úÖ Conex√£o com o banco estabelecida!
üöÄ Servidor rodando na porta 5000
üì° Verifique em: http://localhost:5000/api/health
   - [OK] Servidor iniciado em-processo para execu√ß√£o dos testes.
(node:15056) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
GET /api/reports/export/transactions-pdf 200 81.613 ms - -
GET /api/reports/export/clients-pdf 200 51.029 ms - -
GET /api/reports/export/invoice/691544b9e398534f13bc6a87 200 59.919 ms - -

--- üßπ [ENV] Desconectando do banco de dados ---
‚úÖ Servidor e conex√£o com MongoDB encerrados (stopServer).
--- ‚úÖ [ENV] Ambiente de teste finalizado ---
FAIL Testes/4-reports/reports.test.js
  8. M√≥dulo de Relat√≥rios
    √ó deve chamar o servi√ßo de PDF com os dados corretos para o RELAT√ìRIO DE TRANSA√á√ïES (109 ms)
    √ó deve chamar o servi√ßo de PDF com os dados corretos para o RELAT√ìRIO DE CLIENTES (55 ms)
    √ó deve chamar o servi√ßo de PDF com os dados corretos para a FATURA (63 ms)

  ‚óè 8. M√≥dulo de Relat√≥rios ‚Ä∫ deve chamar o servi√ßo de PDF com os dados corretos para o RELAT√ìRIO DE TRANSA√á√ïES

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

      50 |     });
      51 |
    > 52 |     expect(generateFinancialReportPDF).toHaveBeenCalled();
         |                                        ^
      53 |     const capturedData = generateFinancialReportPDF.mock.calls[0][0];
      54 |     expect(capturedData.company.name).toBe(companyA.name);
      55 |     expect(capturedData.transactions).toBeInstanceOf(Array);

      at Object.toHaveBeenCalled (Testes/4-reports/reports.test.js:52:40)

  ‚óè 8. M√≥dulo de Relat√≥rios ‚Ä∫ deve chamar o servi√ßo de PDF com os dados corretos para o RELAT√ìRIO DE CLIENTES

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

      67 |     });
      68 |
    > 69 |     expect(generateClientsReportPDF).toHaveBeenCalled();
         |                                      ^
      70 |     const capturedData = generateClientsReportPDF.mock.calls[0][0];
      71 |     expect(capturedData.company.name).toBe(companyA.name);
      72 |     expect(capturedData.clients).toBeInstanceOf(Array);

      at Object.toHaveBeenCalled (Testes/4-reports/reports.test.js:69:38)

  ‚óè 8. M√≥dulo de Relat√≥rios ‚Ä∫ deve chamar o servi√ßo de PDF com os dados corretos para a FATURA

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

      84 |     });
      85 |
    > 86 |     expect(generateInvoicePDF).toHaveBeenCalled();
         |                                ^
      87 |     const capturedData = generateInvoicePDF.mock.calls[0][0];
      88 |     expect(capturedData.company.name).toBe(companyA.name);
      89 |     expect(capturedData.transaction.description).toBe(companyA.testTransaction.description);

      at Object.toHaveBeenCalled (Testes/4-reports/reports.test.js:86:32)


--- üöÄ [ETAPA 1 de 4] Iniciando Ambiente de Teste (Jest Environment) ---
   - [PROCESSO] Lendo configura√ß√£o do banco de dados de teste...
   - [ATEN√á√ÉO] Usando banco de dados de DESENVOLVIMENTO para os testes. As cole√ß√µes ser√£o limpas.

--- üöÄ [ETAPA 2 de 4] Limpando e populando o banco de dados de TESTE ---
   - [OK] Dados de teste (empresas e usu√°rios) criados e salvos em test-setup.json.
‚è≥ Iniciando servidor Smart Gest√£o (startServer)...
Conex√£o com o MongoDB estabelecida com sucesso.
Verificando permiss√µes de sistema...
Permiss√µes de sistema j√° existem. Nenhuma a√ß√£o necess√°ria.
‚úÖ Conex√£o com o banco estabelecida!
üöÄ Servidor rodando na porta 5000
üì° Verifique em: http://localhost:5000/api/health
   - [OK] Servidor iniciado em-processo para execu√ß√£o dos testes.
  console.log
    
    --- Configurando 3 empresas para o teste multi-tenant ---

      at Object.log (Testes/3-security/multi-tenant.test.js:19:17)

POST /api/auth/register 201 147.599 ms - 82
[LOG] A√ß√£o: REGISTER_COMPANY_USER | Usu√°rio: N/A
POST /api/auth/login 200 101.181 ms - 628
  console.log
    ‚úÖ Empresa 1 (Empresa Teste 1763001531113) cadastrada e logada.

      at Object.log (Testes/3-security/multi-tenant.test.js:48:21)

[LOG] A√ß√£o: LOGIN_USER | Usu√°rio: N/A
POST /api/auth/register 201 138.902 ms - 82
[LOG] A√ß√£o: REGISTER_COMPANY_USER | Usu√°rio: N/A
POST /api/auth/login 200 153.874 ms - 628
  console.log
    ‚úÖ Empresa 2 (Empresa Teste 1763001531388) cadastrada e logada.

      at Object.log (Testes/3-security/multi-tenant.test.js:48:21)

[LOG] A√ß√£o: LOGIN_USER | Usu√°rio: N/A
POST /api/auth/register 201 136.615 ms - 82
[LOG] A√ß√£o: REGISTER_COMPANY_USER | Usu√°rio: N/A
POST /api/auth/login 200 96.560 ms - 628
  console.log
    ‚úÖ Empresa 3 (Empresa Teste 1763001531689) cadastrada e logada.

      at Object.log (Testes/3-security/multi-tenant.test.js:48:21)

  console.log
    --- Configura√ß√£o multi-tenant conclu√≠da ---

      at Object.log (Testes/3-security/multi-tenant.test.js:50:17)

  console.log
    
    --- Criando transa√ß√µes individuais para cada empresa ---

      at Object.log (Testes/3-security/multi-tenant.test.js:55:17)

[LOG] A√ß√£o: LOGIN_USER | Usu√°rio: N/A
[LOG] A√ß√£o: CREATE_TRANSACTION | Usu√°rio: 691544bbe398534f13bc6ac1
POST /api/transactions 201 47.365 ms - 421
  console.log
    Transa√ß√£o criada para Empresa Teste 1763001531113. ID: 691544bbe398534f13bc6ae7

      at Object.log (Testes/3-security/multi-tenant.test.js:76:21)

[LOG] A√ß√£o: CREATE_TRANSACTION | Usu√°rio: 691544bbe398534f13bc6ac1
[LOG] A√ß√£o: CREATE_TRANSACTION | Usu√°rio: 691544bbe398534f13bc6acf
POST /api/transactions 201 48.628 ms - 420
  console.log
    Transa√ß√£o criada para Empresa Teste 1763001531388. ID: 691544bbe398534f13bc6aee

      at Object.log (Testes/3-security/multi-tenant.test.js:76:21)

[LOG] A√ß√£o: CREATE_TRANSACTION | Usu√°rio: 691544bbe398534f13bc6acf
[LOG] A√ß√£o: CREATE_TRANSACTION | Usu√°rio: 691544bbe398534f13bc6add
POST /api/transactions 201 48.016 ms - 413
  console.log
    Transa√ß√£o criada para Empresa Teste 1763001531689. ID: 691544bce398534f13bc6af5

      at Object.log (Testes/3-security/multi-tenant.test.js:76:21)

  console.log
    
    --- Validando isolamento de dados entre todas as empresas ---

      at Object.log (Testes/3-security/multi-tenant.test.js:82:17)

  console.log
    
    Verificando a transa√ß√£o 691544bbe398534f13bc6ae7 da Empresa Teste 1763001531113

      at Object.log (Testes/3-security/multi-tenant.test.js:89:21)

[LOG] A√ß√£o: CREATE_TRANSACTION | Usu√°rio: 691544bbe398534f13bc6add
GET /api/transactions/691544bbe398534f13bc6ae7 404 27.744 ms - 71
  console.log
    - OK: Empresa Teste 1763001531388 foi bloqueada (Status 404).

      at Object.log (Testes/3-security/multi-tenant.test.js:107:29)

GET /api/transactions/691544bbe398534f13bc6ae7 404 27.625 ms - 71
  console.log
    - OK: Empresa Teste 1763001531689 foi bloqueada (Status 404).

      at Object.log (Testes/3-security/multi-tenant.test.js:107:29)

  console.log
    
    Verificando a transa√ß√£o 691544bbe398534f13bc6aee da Empresa Teste 1763001531388

      at Object.log (Testes/3-security/multi-tenant.test.js:89:21)

GET /api/transactions/691544bbe398534f13bc6aee 404 27.472 ms - 71
  console.log
    - OK: Empresa Teste 1763001531113 foi bloqueada (Status 404).

      at Object.log (Testes/3-security/multi-tenant.test.js:107:29)

GET /api/transactions/691544bbe398534f13bc6aee 404 27.120 ms - 71
  console.log
    - OK: Empresa Teste 1763001531689 foi bloqueada (Status 404).

      at Object.log (Testes/3-security/multi-tenant.test.js:107:29)

  console.log
    
    Verificando a transa√ß√£o 691544bce398534f13bc6af5 da Empresa Teste 1763001531689

      at Object.log (Testes/3-security/multi-tenant.test.js:89:21)

GET /api/transactions/691544bce398534f13bc6af5 404 27.813 ms - 71
  console.log
    - OK: Empresa Teste 1763001531113 foi bloqueada (Status 404).

      at Object.log (Testes/3-security/multi-tenant.test.js:107:29)

GET /api/transactions/691544bce398534f13bc6af5 404 27.470 ms - 71
  console.log
    - OK: Empresa Teste 1763001531388 foi bloqueada (Status 404).

      at Object.log (Testes/3-security/multi-tenant.test.js:107:29)

  console.log
    
    --- Validando listagem de transa√ß√µes ---

      at Object.log (Testes/3-security/multi-tenant.test.js:114:17)

GET /api/transactions 200 28.454 ms - 423
  console.log
    - OK: Empresa Teste 1763001531113 listou apenas sua pr√≥pria transa√ß√£o.

      at Object.log (Testes/3-security/multi-tenant.test.js:126:21)

GET /api/transactions 200 29.840 ms - 422
  console.log
    - OK: Empresa Teste 1763001531388 listou apenas sua pr√≥pria transa√ß√£o.

      at Object.log (Testes/3-security/multi-tenant.test.js:126:21)

GET /api/transactions 200 29.203 ms - 415
  console.log
    - OK: Empresa Teste 1763001531689 listou apenas sua pr√≥pria transa√ß√£o.

      at Object.log (Testes/3-security/multi-tenant.test.js:126:21)

  console.log
    
    --- Limpando dados de teste (Teardown) ---

      at Object.log (Testes/3-security/multi-tenant.test.js:132:17)

DELETE /api/auth/users/691544bbe398534f13bc6ac1 200 81.295 ms - 80
  console.log
    - ‚úÖ Empresa Empresa Teste 1763001531113 e dados associados exclu√≠dos com sucesso.

      at Object.log (Testes/3-security/multi-tenant.test.js:139:25)

[LOG] A√ß√£o: DELETE_USER_BY_ID | Usu√°rio: 691544bbe398534f13bc6ac1
DELETE /api/auth/users/691544bbe398534f13bc6acf 200 77.900 ms - 80
  console.log
    - ‚úÖ Empresa Empresa Teste 1763001531388 e dados associados exclu√≠dos com sucesso.

      at Object.log (Testes/3-security/multi-tenant.test.js:139:25)

[LOG] A√ß√£o: DELETE_USER_BY_ID | Usu√°rio: 691544bbe398534f13bc6acf
DELETE /api/auth/users/691544bbe398534f13bc6add 200 80.547 ms - 80
  console.log
    - ‚úÖ Empresa Empresa Teste 1763001531689 e dados associados exclu√≠dos com sucesso.

      at Object.log (Testes/3-security/multi-tenant.test.js:139:25)


--- üßπ [ENV] Desconectando do banco de dados ---
Falha cr√≠tica ao gravar log de auditoria: MongoClientClosedError: Operation interrupted because client was closed
    at ConnectionPool.closeCheckedOutConnections (F:\Programacao\GitHub\pbr-si-2025-2-p3-tiapn-t1-9147100-smart-gestao\src\codes\backend\node_modules\mongodb\src\cmap\connection_pool.ts:495:20)
    at Server.closeCheckedOutConnections (F:\Programacao\GitHub\pbr-si-2025-2-p3-tiapn-t1-9147100-smart-gestao\src\codes\backend\node_modules\mongodb\src\sdam\server.ts:251:22)
    at Topology.closeCheckedOutConnections (F:\Programacao\GitHub\pbr-si-2025-2-p3-tiapn-t1-9147100-smart-gestao\src\codes\backend\node_modules\mongodb\src\sdam\topology.ts:496:21)
    at MongoClient._close (F:\Programacao\GitHub\pbr-si-2025-2-p3-tiapn-t1-9147100-smart-gestao\src\codes\backend\node_modules\mongodb\src\mongo_client.ts:782:20)
    at MongoClient.close (F:\Programacao\GitHub\pbr-si-2025-2-p3-tiapn-t1-9147100-smart-gestao\src\codes\backend\node_modules\mongodb\src\mongo_client.ts:764:29)
    at NativeConnection.doClose (F:\Programacao\GitHub\pbr-si-2025-2-p3-tiapn-t1-9147100-smart-gestao\src\codes\backend\node_modules\mongoose\lib\drivers\node-mongodb-native\connection.js:208:21)
    at NativeConnection._close (F:\Programacao\GitHub\pbr-si-2025-2-p3-tiapn-t1-9147100-smart-gestao\src\codes\backend\node_modules\mongoose\lib\connection.js:1264:18)
    at NativeConnection.close (F:\Programacao\GitHub\pbr-si-2025-2-p3-tiapn-t1-9147100-smart-gestao\src\codes\backend\node_modules\mongoose\lib\connection.js:1229:15)
    at F:\Programacao\GitHub\pbr-si-2025-2-p3-tiapn-t1-9147100-smart-gestao\src\codes\backend\node_modules\mongoose\lib\mongoose.js:471:60
    at Array.map (<anonymous>)
    at Mongoose.disconnect (F:\Programacao\GitHub\pbr-si-2025-2-p3-tiapn-t1-9147100-smart-gestao\src\codes\backend\node_modules\mongoose\lib\mongoose.js:471:43)
    at Server.<anonymous> (file:///F:/Programacao/GitHub/pbr-si-2025-2-p3-tiapn-t1-9147100-smart-gestao/src/codes/backend/server.js:157:24)
    at Object.onceWrapper (node:events:633:28)
    at Server.emit (node:events:519:28)
    at emitCloseNT (node:net:2419:8)
    at processTicksAndRejections (node:internal/process/task_queues:89:21) {
  errorLabelSet: Set(0) {}
}
‚úÖ Servidor e conex√£o com MongoDB encerrados (stopServer).
--- ‚úÖ [ENV] Ambiente de teste finalizado ---
PASS Testes/3-security/multi-tenant.test.js
  3. Teste de Isolamento de Dados em Larga Escala (Multi-Tenant)
    ‚àö deve criar uma transa√ß√£o para cada empresa (159 ms)
    ‚àö deve impedir que uma empresa acesse a transa√ß√£o de outra (191 ms)
    ‚àö deve garantir que cada empresa liste apenas suas pr√≥prias transa√ß√µes (97 ms)


--- üöÄ [ETAPA 1 de 4] Iniciando Ambiente de Teste (Jest Environment) ---
   - [PROCESSO] Lendo configura√ß√£o do banco de dados de teste...
   - [ATEN√á√ÉO] Usando banco de dados de DESENVOLVIMENTO para os testes. As cole√ß√µes ser√£o limpas.

--- üöÄ [ETAPA 2 de 4] Limpando e populando o banco de dados de TESTE ---
   - [OK] Dados de teste (empresas e usu√°rios) criados e salvos em test-setup.json.
‚è≥ Iniciando servidor Smart Gest√£o (startServer)...
Conex√£o com o MongoDB estabelecida com sucesso.
Verificando permiss√µes de sistema...
Permiss√µes de sistema j√° existem. Nenhuma a√ß√£o necess√°ria.
‚úÖ Conex√£o com o banco estabelecida!
üöÄ Servidor rodando na porta 5000
üì° Verifique em: http://localhost:5000/api/health
   - [OK] Servidor iniciado em-processo para execu√ß√£o dos testes.
[LOG] A√ß√£o: CREATE_TRANSACTION | Usu√°rio: 691544bde398534f13bc6b3c
POST /api/transactions 201 47.673 ms - 452
[LOG] A√ß√£o: CREATE_TRANSACTION | Usu√°rio: 691544bde398534f13bc6b3c
POST /api/transactions 400 14.225 ms - 277
[LOG] A√ß√£o: CREATE_TRANSACTION | Usu√°rio: 691544bde398534f13bc6b3c
GET /api/transactions 200 27.460 ms - 855
GET /api/transactions/691544bde398534f13bc6b48 200 26.911 ms - 452
[LOG] A√ß√£o: UPDATE_TRANSACTION | Usu√°rio: 691544bde398534f13bc6b3c
PUT /api/transactions/691544bde398534f13bc6b48 200 51.417 ms - 452
[LOG] A√ß√£o: UPDATE_TRANSACTION | Usu√°rio: 691544bde398534f13bc6b3c
[LOG] A√ß√£o: DELETE_TRANSACTION | Usu√°rio: 691544bde398534f13bc6b3c
DELETE /api/transactions/691544bde398534f13bc6b48 200 48.578 ms - 73
[LOG] A√ß√£o: DELETE_TRANSACTION | Usu√°rio: 691544bde398534f13bc6b3c
GET /api/transactions/691544bde398534f13bc6b48 404 26.959 ms - 71

--- üßπ [ENV] Desconectando do banco de dados ---
‚úÖ Servidor e conex√£o com MongoDB encerrados (stopServer).
--- ‚úÖ [ENV] Ambiente de teste finalizado ---
PASS Testes/2-features/transactions.test.js
  4. M√≥dulo de Transa√ß√µes (CRUD)
    ‚àö deve CRIAR uma nova transa√ß√£o com sucesso (59 ms)
    ‚àö deve falhar ao tentar criar uma transa√ß√£o com dados inv√°lidos (24 ms)
    ‚àö deve LISTAR as transa√ß√µes do usu√°rio logado (30 ms)
    ‚àö deve OBTER uma transa√ß√£o espec√≠fica pelo ID (28 ms)
    ‚àö deve ATUALIZAR uma transa√ß√£o existente (54 ms)
    ‚àö deve EXCLUIR uma transa√ß√£o existente (81 ms)


--- üöÄ [ETAPA 1 de 4] Iniciando Ambiente de Teste (Jest Environment) ---
   - [PROCESSO] Lendo configura√ß√£o do banco de dados de teste...
   - [ATEN√á√ÉO] Usando banco de dados de DESENVOLVIMENTO para os testes. As cole√ß√µes ser√£o limpas.

--- üöÄ [ETAPA 2 de 4] Limpando e populando o banco de dados de TESTE ---
   - [OK] Dados de teste (empresas e usu√°rios) criados e salvos em test-setup.json.
‚è≥ Iniciando servidor Smart Gest√£o (startServer)...
Conex√£o com o MongoDB estabelecida com sucesso.
Verificando permiss√µes de sistema...
Permiss√µes de sistema j√° existem. Nenhuma a√ß√£o necess√°ria.
‚úÖ Conex√£o com o banco estabelecida!
üöÄ Servidor rodando na porta 5000
üì° Verifique em: http://localhost:5000/api/health
   - [OK] Servidor iniciado em-processo para execu√ß√£o dos testes.
[LOG] A√ß√£o: CREATE_GOAL | Usu√°rio: 691544bee398534f13bc6b7e
POST /api/goals 201 48.009 ms - 404
GET /api/goals 200 26.965 ms - 406
[LOG] A√ß√£o: UPDATE_GOAL | Usu√°rio: 691544bee398534f13bc6b7e
PUT /api/goals/691544bee398534f13bc6b8a 200 49.467 ms - 414
[LOG] A√ß√£o: DELETE_GOAL | Usu√°rio: 691544bee398534f13bc6b7e
DELETE /api/goals/691544bee398534f13bc6b8a 200 47.825 ms - 67
GET /api/goals/691544bee398534f13bc6b8a 404 27.345 ms - 65

--- üßπ [ENV] Desconectando do banco de dados ---
‚úÖ Servidor e conex√£o com MongoDB encerrados (stopServer).
--- ‚úÖ [ENV] Ambiente de teste finalizado ---
PASS Testes/2-features/goals.test.js
  5. M√≥dulo de Metas (CRUD)
    ‚àö deve CRIAR uma nova meta com sucesso (59 ms)
    ‚àö deve LISTAR as metas do usu√°rio logado (30 ms)
    ‚àö deve ATUALIZAR uma meta existente (53 ms)
    ‚àö deve EXCLUIR uma meta existente (86 ms)


--- üöÄ [ETAPA 1 de 4] Iniciando Ambiente de Teste (Jest Environment) ---
   - [PROCESSO] Lendo configura√ß√£o do banco de dados de teste...
   - [ATEN√á√ÉO] Usando banco de dados de DESENVOLVIMENTO para os testes. As cole√ß√µes ser√£o limpas.

--- üöÄ [ETAPA 2 de 4] Limpando e populando o banco de dados de TESTE ---
   - [OK] Dados de teste (empresas e usu√°rios) criados e salvos em test-setup.json.
‚è≥ Iniciando servidor Smart Gest√£o (startServer)...
Conex√£o com o MongoDB estabelecida com sucesso.
Verificando permiss√µes de sistema...
Permiss√µes de sistema j√° existem. Nenhuma a√ß√£o necess√°ria.
‚úÖ Conex√£o com o banco estabelecida!
üöÄ Servidor rodando na porta 5000
üì° Verifique em: http://localhost:5000/api/health
   - [OK] Servidor iniciado em-processo para execu√ß√£o dos testes.
  console.log
    
    --- Teste: Solicitar reset para e-mail inv√°lido ---

      at Object.log (Testes/1-auth/password.test.js:25:13)

POST /api/auth/forgot-password 404 13.455 ms - 39
  console.log
    ‚úÖ Falhou como esperado para e-mail inexistente (Status 404).

      at Object.log (Testes/1-auth/password.test.js:34:15)

  console.log
    
    --- Teste: Gerar token de reset com sucesso ---

      at Object.log (Testes/1-auth/password.test.js:39:13)

POST /api/auth/forgot-password 200 33.903 ms - 140
  console.log
    ‚úÖ Token de reset gerado e salvo no banco de dados.

      at Object.log (Testes/1-auth/password.test.js:49:13)

  console.log
    
    --- Teste: Resetar senha com token v√°lido ---

      at Object.log (Testes/1-auth/password.test.js:53:13)

POST /api/auth/forgot-password 200 30.814 ms - 140
POST /api/auth/reset-password/b0d78c209ad514c5a64d5bca89a7271f0aad2a3643ef486d73f39965b291009c 200 121.869 ms - 41
  console.log
    ‚úÖ Senha resetada com sucesso via API.

      at Object.log (Testes/1-auth/password.test.js:70:13)

POST /api/auth/reset-password/b0d78c209ad514c5a64d5bca89a7271f0aad2a3643ef486d73f39965b291009c 400 14.248 ms - 42
  console.log
    ‚úÖ Token de reset foi invalidado no banco.

      at Object.log (Testes/1-auth/password.test.js:74:13)

POST /api/auth/login 200 98.183 ms - 604
  console.log
    ‚úÖ Login com a nova senha realizado com sucesso.

      at Object.log (Testes/1-auth/password.test.js:84:13)


--- üßπ [ENV] Desconectando do banco de dados ---
‚úÖ Servidor e conex√£o com MongoDB encerrados (stopServer).
--- ‚úÖ [ENV] Ambiente de teste finalizado ---
PASS Testes/1-auth/password.test.js
  9. M√≥dulo de Recupera√ß√£o de Senha
    ‚àö deve falhar ao solicitar reset para um e-mail inexistente (42 ms)
    ‚àö deve gerar e salvar um token de reset para um e-mail v√°lido (41 ms)
    ‚àö deve resetar a senha com um token v√°lido e permitir login com a nova senha (281 ms)


--- üöÄ [ETAPA 1 de 4] Iniciando Ambiente de Teste (Jest Environment) ---
   - [PROCESSO] Lendo configura√ß√£o do banco de dados de teste...
   - [ATEN√á√ÉO] Usando banco de dados de DESENVOLVIMENTO para os testes. As cole√ß√µes ser√£o limpas.

--- üöÄ [ETAPA 2 de 4] Limpando e populando o banco de dados de TESTE ---
[LOG] A√ß√£o: LOGIN_USER | Usu√°rio: N/A
   - [OK] Dados de teste (empresas e usu√°rios) criados e salvos em test-setup.json.
‚è≥ Iniciando servidor Smart Gest√£o (startServer)...
Conex√£o com o MongoDB estabelecida com sucesso.
Verificando permiss√µes de sistema...
Permiss√µes de sistema j√° existem. Nenhuma a√ß√£o necess√°ria.
‚úÖ Conex√£o com o banco estabelecida!
üöÄ Servidor rodando na porta 5000
üì° Verifique em: http://localhost:5000/api/health
   - [OK] Servidor iniciado em-processo para execu√ß√£o dos testes.
POST /api/clients 201 31.526 ms - 327
[LOG] A√ß√£o: CREATE_CLIENT | Usu√°rio: 691544c0e398534f13bc6be6
GET /api/clients 200 28.470 ms - 567
PUT /api/clients/691544c1e398534f13bc6bf2 200 33.229 ms - 346
[LOG] A√ß√£o: UPDATE_CLIENT | Usu√°rio: 691544c0e398534f13bc6be6
DELETE /api/clients/691544c1e398534f13bc6bf2 200 32.599 ms - 70
GET /api/clients/691544c1e398534f13bc6bf2 404 1.951 ms - 175

--- üßπ [ENV] Desconectando do banco de dados ---
‚úÖ Servidor e conex√£o com MongoDB encerrados (stopServer).
--- ‚úÖ [ENV] Ambiente de teste finalizado ---
[LOG] A√ß√£o: DELETE_CLIENT | Usu√°rio: 691544c0e398534f13bc6be6
PASS Testes/2-features/clients.test.js
  7. M√≥dulo de Clientes/Fornecedores
    ‚àö deve CRIAR um novo cliente com sucesso (48 ms)
    ‚àö deve LISTAR os clientes da empresa (32 ms)
    ‚àö deve ATUALIZAR um cliente existente (38 ms)
    ‚àö deve EXCLUIR um cliente existente (61 ms)


--- üöÄ [ETAPA 1 de 4] Iniciando Ambiente de Teste (Jest Environment) ---
   - [PROCESSO] Lendo configura√ß√£o do banco de dados de teste...
   - [ATEN√á√ÉO] Usando banco de dados de DESENVOLVIMENTO para os testes. As cole√ß√µes ser√£o limpas.

--- üöÄ [ETAPA 2 de 4] Limpando e populando o banco de dados de TESTE ---
   - [OK] Dados de teste (empresas e usu√°rios) criados e salvos em test-setup.json.
‚è≥ Iniciando servidor Smart Gest√£o (startServer)...
Conex√£o com o MongoDB estabelecida com sucesso.
Verificando permiss√µes de sistema...
Permiss√µes de sistema j√° existem. Nenhuma a√ß√£o necess√°ria.
‚úÖ Conex√£o com o banco estabelecida!
üöÄ Servidor rodando na porta 5000
üì° Verifique em: http://localhost:5000/api/health
   - [OK] Servidor iniciado em-processo para execu√ß√£o dos testes.
POST /api/auth/login 200 124.364 ms - 604
[LOG] A√ß√£o: LOGIN_USER | Usu√°rio: N/A
POST /api/auth/login 200 98.697 ms - 604
[LOG] A√ß√£o: LOGIN_USER | Usu√°rio: N/A
POST /api/auth/logout 200 17.679 ms - 81

--- üßπ [ENV] Desconectando do banco de dados ---
‚úÖ Servidor e conex√£o com MongoDB encerrados (stopServer).
--- ‚úÖ [ENV] Ambiente de teste finalizado ---
PASS Testes/1-auth/auth.test.js
  6. M√≥dulo de Autentica√ß√£o e Sess√£o (Stateful)
    ‚àö deve criar um SessionToken no banco de dados ap√≥s o login (135 ms)
    ‚àö deve invalidar o SessionToken no banco de dados ap√≥s o logout (121 ms)

Test Suites: 1 failed, 6 passed, 7 total
Tests:       3 failed, 22 passed, 25 total
Snapshots:   0 total
Time:        10.927 s, estimated 11 s
Ran all test suites.
[LOG] A√ß√£o: LOGOUT_USER | Usu√°rio: N/A

--- FIM DOS TESTES AUTOMATIZADOS (Status: Falha) ---
