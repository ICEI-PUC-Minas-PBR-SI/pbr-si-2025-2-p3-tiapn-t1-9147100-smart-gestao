
--- üöÄ [ETAPA 1 de 4] Iniciando Ambiente de Teste (Jest Environment) ---
   - [PROCESSO] Lendo configura√ß√£o do banco de dados de teste...
   - [ATEN√á√ÉO] Usando banco de dados de DESENVOLVIMENTO para os testes. As cole√ß√µes ser√£o limpas.

--- üöÄ [ETAPA 2 de 4] Limpando e populando o banco de dados de TESTE ---
   - [OK] Dados de teste (empresas e usu√°rios) criados e salvos em test-setup.json.
(node:18136) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
  console.log
    
    --- Teste: Solicitar reset para e-mail inv√°lido ---

      at Object.<anonymous> (Testes/1-auth/password.test.js:46:13)

  console.log
    ‚úÖ Falhou como esperado para e-mail inexistente (Status 404).

      at Object.<anonymous> (Testes/1-auth/password.test.js:55:15)

  console.log
    
    --- Teste: Gerar token de reset com sucesso ---

      at Object.<anonymous> (Testes/1-auth/password.test.js:60:13)

  console.log
    
    --- Teste: Resetar senha com token v√°lido ---

      at Object.<anonymous> (Testes/1-auth/password.test.js:76:13)

  console.log
    ‚úÖ Senha resetada com sucesso via API.

      at Object.<anonymous> (Testes/1-auth/password.test.js:93:13)


--- üßπ [ENV] Desconectando do banco de dados ---
--- ‚úÖ [ENV] Ambiente de teste finalizado ---
 FAIL  Testes/1-auth/password.test.js (21.987 s)
  9. M√≥dulo de Recupera√ß√£o de Senha
    ‚àö deve falhar ao solicitar reset para um e-mail inexistente (99 ms)
    √ó deve gerar e salvar um token de reset para um e-mail v√°lido (10092 ms)
    √ó deve resetar a senha com um token v√°lido e permitir login com a nova senha (10217 ms)

  ‚óè 9. M√≥dulo de Recupera√ß√£o de Senha ‚Ä∫ deve gerar e salvar um token de reset para um e-mail v√°lido

    MongooseError: Operation `users.findOne()` buffering timed out after 10000ms

      at Timeout.<anonymous> (node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:187:23)

  ‚óè 9. M√≥dulo de Recupera√ß√£o de Senha ‚Ä∫ deve resetar a senha com um token v√°lido e permitir login com a nova senha

    MongooseError: Operation `users.findOne()` buffering timed out after 10000ms

      at Timeout.<anonymous> (node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:187:23)


--- üöÄ [ETAPA 1 de 4] Iniciando Ambiente de Teste (Jest Environment) ---
   - [PROCESSO] Lendo configura√ß√£o do banco de dados de teste...
   - [ATEN√á√ÉO] Usando banco de dados de DESENVOLVIMENTO para os testes. As cole√ß√µes ser√£o limpas.

--- üöÄ [ETAPA 2 de 4] Limpando e populando o banco de dados de TESTE ---
   - [OK] Dados de teste (empresas e usu√°rios) criados e salvos em test-setup.json.

--- üßπ [ENV] Desconectando do banco de dados ---
--- ‚úÖ [ENV] Ambiente de teste finalizado ---
 FAIL  Testes/1-auth/auth.test.js (21.387 s)
  6. M√≥dulo de Autentica√ß√£o e Sess√£o (Stateful)
    √ó deve criar um SessionToken no banco de dados ap√≥s o login (10160 ms)
    √ó deve invalidar o SessionToken no banco de dados ap√≥s o logout (10173 ms)

  ‚óè 6. M√≥dulo de Autentica√ß√£o e Sess√£o (Stateful) ‚Ä∫ deve criar um SessionToken no banco de dados ap√≥s o login

    MongooseError: Operation `sessiontokens.findOne()` buffering timed out after 10000ms

      at Timeout.<anonymous> (node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:187:23)

  ‚óè 6. M√≥dulo de Autentica√ß√£o e Sess√£o (Stateful) ‚Ä∫ deve invalidar o SessionToken no banco de dados ap√≥s o logout

    MongooseError: Operation `sessiontokens.findOne()` buffering timed out after 10000ms

      at Timeout.<anonymous> (node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:187:23)


--- üöÄ [ETAPA 1 de 4] Iniciando Ambiente de Teste (Jest Environment) ---
   - [PROCESSO] Lendo configura√ß√£o do banco de dados de teste...
   - [ATEN√á√ÉO] Usando banco de dados de DESENVOLVIMENTO para os testes. As cole√ß√µes ser√£o limpas.

--- üöÄ [ETAPA 2 de 4] Limpando e populando o banco de dados de TESTE ---
   - [OK] Dados de teste (empresas e usu√°rios) criados e salvos em test-setup.json.

--- üßπ [ENV] Desconectando do banco de dados ---
--- ‚úÖ [ENV] Ambiente de teste finalizado ---
 FAIL  Testes/2-features/clients.test.js
  7. M√≥dulo de Clientes/Fornecedores
    √ó deve CRIAR um novo cliente com sucesso (51 ms)
    √ó deve LISTAR os clientes da empresa (33 ms)
    √ó deve ATUALIZAR um cliente existente (22 ms)
    √ó deve EXCLUIR um cliente existente (17 ms)

  ‚óè 7. M√≥dulo de Clientes/Fornecedores ‚Ä∫ deve CRIAR um novo cliente com sucesso

    expect(received).toBe(expected) // Object.is equality

    Expected: 201
    Received: 200

      29 |     });
      30 |
    > 31 |     expect(response.status).toBe(201);
         |                             ^
      32 |     expect(response.data.data).toHaveProperty('_id');
      33 |     expect(response.data.data.name).toBe(newClient.name);
      34 |     createdClientId = response.data.data._id;

      at Object.<anonymous> (Testes/2-features/clients.test.js:31:29)

  ‚óè 7. M√≥dulo de Clientes/Fornecedores ‚Ä∫ deve LISTAR os clientes da empresa

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

      41 |
      42 |     expect(response.status).toBe(200);
    > 43 |     expect(Array.isArray(response.data.data)).toBe(true);
         |                                               ^
      44 |     const found = response.data.data.some(client => client._id === createdClientId);
      45 |     expect(found).toBe(true);
      46 |   });

      at Object.<anonymous> (Testes/2-features/clients.test.js:43:47)

  ‚óè 7. M√≥dulo de Clientes/Fornecedores ‚Ä∫ deve ATUALIZAR um cliente existente

    AxiosError: Request failed with status code 400

      51 |     };
      52 |
    > 53 |     const response = await axios.put(`${API_URL}/clients/${createdClientId}`, updatedData, {
         |                      ^
      54 |       headers: { Authorization: `Bearer ${userToken}` },
      55 |     });
      56 |

      at settle (node_modules/axios/lib/core/settle.js:19:12)
      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:793:11)
      at Axios.request (node_modules/axios/lib/core/Axios.js:45:41)
      at Object.<anonymous> (Testes/2-features/clients.test.js:53:22)

  ‚óè 7. M√≥dulo de Clientes/Fornecedores ‚Ä∫ deve EXCLUIR um cliente existente

    AxiosError: Request failed with status code 400

      60 |
      61 |   it('deve EXCLUIR um cliente existente', async () => {
    > 62 |     const response = await axios.delete(`${API_URL}/clients/${createdClientId}`, {
         |                      ^
      63 |       headers: { Authorization: `Bearer ${userToken}` },
      64 |     });
      65 |

      at settle (node_modules/axios/lib/core/settle.js:19:12)
      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:793:11)
      at Axios.request (node_modules/axios/lib/core/Axios.js:45:41)
      at Object.<anonymous> (Testes/2-features/clients.test.js:62:22)


--- üöÄ [ETAPA 1 de 4] Iniciando Ambiente de Teste (Jest Environment) ---
   - [PROCESSO] Lendo configura√ß√£o do banco de dados de teste...
   - [ATEN√á√ÉO] Usando banco de dados de DESENVOLVIMENTO para os testes. As cole√ß√µes ser√£o limpas.

--- üöÄ [ETAPA 2 de 4] Limpando e populando o banco de dados de TESTE ---
   - [OK] Dados de teste (empresas e usu√°rios) criados e salvos em test-setup.json.

--- üßπ [ENV] Desconectando do banco de dados ---
--- ‚úÖ [ENV] Ambiente de teste finalizado ---
 FAIL  Testes/2-features/goals.test.js
  5. M√≥dulo de Metas (CRUD)
    √ó deve CRIAR uma nova meta com sucesso (6 ms)
    √ó deve LISTAR as metas do usu√°rio logado (1 ms)
    √ó deve ATUALIZAR uma meta existente (1 ms)
    √ó deve EXCLUIR uma meta existente (1 ms)

  ‚óè 5. M√≥dulo de Metas (CRUD) ‚Ä∫ deve CRIAR uma nova meta com sucesso

    TypeError: Invalid URL

      24 |         };
      25 |
    > 26 |         const response = await axios.post(`${API_URL}/goals`, goalData, {
         |                                      ^
      27 |             headers: { Authorization: `Bearer ${userToken}` }
      28 |         });
      29 |

      at dispatchHttpRequest (node_modules/axios/lib/adapters/http.js:408:20)
      at node_modules/axios/lib/adapters/http.js:249:5
      at wrapAsync (node_modules/axios/lib/adapters/http.js:229:10)
      at http (node_modules/axios/lib/adapters/http.js:314:10)
      at Axios.dispatchRequest (node_modules/axios/lib/core/dispatchRequest.js:51:10)
      at Axios._request (node_modules/axios/lib/core/Axios.js:185:33)
      at Axios.request (node_modules/axios/lib/core/Axios.js:40:25)
      at Axios.httpMethod [as post] (node_modules/axios/lib/core/Axios.js:224:19)
      at Function.wrap (node_modules/axios/lib/helpers/bind.js:12:15)
      at Object.<anonymous> (Testes/2-features/goals.test.js:26:38)

  ‚óè 5. M√≥dulo de Metas (CRUD) ‚Ä∫ deve LISTAR as metas do usu√°rio logado

    expect(received).toBeDefined()

    Received: undefined

      37 |
      38 |     it('deve LISTAR as metas do usu√°rio logado', async () => {
    > 39 |         expect(createdGoalId).toBeDefined();
         |                               ^
      40 |
      41 |         const response = await axios.get(`${API_URL}/goals`, {
      42 |             headers: { Authorization: `Bearer ${userToken}` }

      at Object.<anonymous> (Testes/2-features/goals.test.js:39:31)

  ‚óè 5. M√≥dulo de Metas (CRUD) ‚Ä∫ deve ATUALIZAR uma meta existente

    expect(received).toBeDefined()

    Received: undefined

      50 |
      51 |     it('deve ATUALIZAR uma meta existente', async () => {
    > 52 |         expect(createdGoalId).toBeDefined();
         |                               ^
      53 |
      54 |         const updatedData = {
      55 |             title: 'Economizar para novo maquin√°rio (URGENTE)',

      at Object.<anonymous> (Testes/2-features/goals.test.js:52:31)

  ‚óè 5. M√≥dulo de Metas (CRUD) ‚Ä∫ deve EXCLUIR uma meta existente

    expect(received).toBeDefined()

    Received: undefined

      67 |
      68 |     it('deve EXCLUIR uma meta existente', async () => {
    > 69 |         expect(createdGoalId).toBeDefined();
         |                               ^
      70 |
      71 |         const response = await axios.delete(`${API_URL}/goals/${createdGoalId}`, {
      72 |             headers: { Authorization: `Bearer ${userToken}` }

      at Object.<anonymous> (Testes/2-features/goals.test.js:69:31)


--- üöÄ [ETAPA 1 de 4] Iniciando Ambiente de Teste (Jest Environment) ---
   - [PROCESSO] Lendo configura√ß√£o do banco de dados de teste...
   - [ATEN√á√ÉO] Usando banco de dados de DESENVOLVIMENTO para os testes. As cole√ß√µes ser√£o limpas.

--- üöÄ [ETAPA 2 de 4] Limpando e populando o banco de dados de TESTE ---
   - [OK] Dados de teste (empresas e usu√°rios) criados e salvos em test-setup.json.
  console.log
    
    --- Configurando 3 empresas para o teste multi-tenant ---

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:19:17)

  console.log
    ‚úÖ Empresa 1 (Empresa Teste 1762966614728) cadastrada e logada.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:48:21)

  console.log
    ‚úÖ Empresa 2 (Empresa Teste 1762966614980) cadastrada e logada.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:48:21)

  console.log
    ‚úÖ Empresa 3 (Empresa Teste 1762966615227) cadastrada e logada.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:48:21)

  console.log
    --- Configura√ß√£o multi-tenant conclu√≠da ---

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:50:17)

  console.log
    
    --- Criando transa√ß√µes individuais para cada empresa ---

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:55:17)

  console.log
    Transa√ß√£o criada para Empresa Teste 1762966614728. ID: 6914bc57989369620b8ec6a8

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:76:21)

  console.log
    Transa√ß√£o criada para Empresa Teste 1762966614980. ID: 6914bc57989369620b8ec6af

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:76:21)

  console.log
    Transa√ß√£o criada para Empresa Teste 1762966615227. ID: 6914bc57989369620b8ec6b6

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:76:21)

  console.log
    
    --- Validando isolamento de dados entre todas as empresas ---

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:82:17)

  console.log
    
    Verificando a transa√ß√£o 6914bc57989369620b8ec6a8 da Empresa Teste 1762966614728

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:89:21)

  console.log
    - OK: Empresa Teste 1762966614980 foi bloqueada (Status 404).

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:107:29)

  console.log
    - OK: Empresa Teste 1762966615227 foi bloqueada (Status 404).

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:107:29)

  console.log
    
    Verificando a transa√ß√£o 6914bc57989369620b8ec6af da Empresa Teste 1762966614980

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:89:21)

  console.log
    - OK: Empresa Teste 1762966614728 foi bloqueada (Status 404).

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:107:29)

  console.log
    - OK: Empresa Teste 1762966615227 foi bloqueada (Status 404).

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:107:29)

  console.log
    
    Verificando a transa√ß√£o 6914bc57989369620b8ec6b6 da Empresa Teste 1762966615227

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:89:21)

  console.log
    - OK: Empresa Teste 1762966614728 foi bloqueada (Status 404).

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:107:29)

  console.log
    - OK: Empresa Teste 1762966614980 foi bloqueada (Status 404).

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:107:29)

  console.log
    
    --- Validando listagem de transa√ß√µes ---

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:114:17)

  console.log
    - OK: Empresa Teste 1762966614728 listou apenas sua pr√≥pria transa√ß√£o.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:126:21)

  console.log
    - OK: Empresa Teste 1762966614980 listou apenas sua pr√≥pria transa√ß√£o.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:126:21)

  console.log
    - OK: Empresa Teste 1762966615227 listou apenas sua pr√≥pria transa√ß√£o.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:126:21)

  console.log
    
    --- Limpando dados de teste (Teardown) ---

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:132:17)

  console.log
    - ‚úÖ Empresa Empresa Teste 1762966614728 e dados associados exclu√≠dos com sucesso.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:139:25)

  console.log
    - ‚úÖ Empresa Empresa Teste 1762966614980 e dados associados exclu√≠dos com sucesso.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:139:25)

  console.log
    - ‚úÖ Empresa Empresa Teste 1762966615227 e dados associados exclu√≠dos com sucesso.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:139:25)


--- üßπ [ENV] Desconectando do banco de dados ---
--- ‚úÖ [ENV] Ambiente de teste finalizado ---
 PASS  Testes/3-security/multi-tenant.test.js
  3. Teste de Isolamento de Dados em Larga Escala (Multi-Tenant)
    ‚àö deve criar uma transa√ß√£o para cada empresa (168 ms)
    ‚àö deve impedir que uma empresa acesse a transa√ß√£o de outra (195 ms)
    ‚àö deve garantir que cada empresa liste apenas suas pr√≥prias transa√ß√µes (90 ms)


--- üöÄ [ETAPA 1 de 4] Iniciando Ambiente de Teste (Jest Environment) ---
   - [PROCESSO] Lendo configura√ß√£o do banco de dados de teste...
   - [ATEN√á√ÉO] Usando banco de dados de DESENVOLVIMENTO para os testes. As cole√ß√µes ser√£o limpas.

--- üöÄ [ETAPA 2 de 4] Limpando e populando o banco de dados de TESTE ---
   - [OK] Dados de teste (empresas e usu√°rios) criados e salvos em test-setup.json.

--- üßπ [ENV] Desconectando do banco de dados ---
--- ‚úÖ [ENV] Ambiente de teste finalizado ---
 PASS  Testes/2-features/transactions.test.js
  4. M√≥dulo de Transa√ß√µes (CRUD)
    ‚àö deve CRIAR uma nova transa√ß√£o com sucesso (58 ms)
    ‚àö deve falhar ao tentar criar uma transa√ß√£o com dados inv√°lidos (22 ms)
    ‚àö deve LISTAR as transa√ß√µes do usu√°rio logado (34 ms)
    ‚àö deve OBTER uma transa√ß√£o espec√≠fica pelo ID (30 ms)
    ‚àö deve ATUALIZAR uma transa√ß√£o existente (53 ms)
    ‚àö deve EXCLUIR uma transa√ß√£o existente (88 ms)


--- üöÄ [ETAPA 1 de 4] Iniciando Ambiente de Teste (Jest Environment) ---
   - [PROCESSO] Lendo configura√ß√£o do banco de dados de teste...
   - [ATEN√á√ÉO] Usando banco de dados de DESENVOLVIMENTO para os testes. As cole√ß√µes ser√£o limpas.

--- üöÄ [ETAPA 2 de 4] Limpando e populando o banco de dados de TESTE ---
   - [OK] Dados de teste (empresas e usu√°rios) criados e salvos em test-setup.json.
  console.log
    ‚û°Ô∏è  [PASS] Resposta da API: 200, PDF recebido com 2329 bytes e salvo em: F:\Programacao\GitHub\pbr-si-2025-2-p3-tiapn-t1-9147100-smart-gestao\src\codes\backend\Testes\PDFs\pdf_teste_2025-11-12_13-56-58.pdf

      at Object.<anonymous> (Testes/4-reports/reports.test.js:57:13)


--- üßπ [ENV] Desconectando do banco de dados ---
--- ‚úÖ [ENV] Ambiente de teste finalizado ---
 PASS  Testes/4-reports/reports.test.js
  8. M√≥dulo de Relat√≥rios
    ‚àö deve EXPORTAR um relat√≥rio de transa√ß√µes em formato PDF (92 ms)

Test Suites: 4 failed, 3 passed, 7 total
Tests:       12 failed, 11 passed, 23 total
Snapshots:   0 total
Time:        50.737 s, estimated 59 s
Ran all test suites.

--- FIM DOS TESTES AUTOMATIZADOS (Status: Falha) ---
