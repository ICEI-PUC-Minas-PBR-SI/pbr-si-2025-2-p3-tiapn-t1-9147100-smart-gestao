
--- ğŸš€ [GLOBAL SETUP] Iniciando ambiente de teste ---
Verificando permissÃµes de sistema...
PermissÃµes nÃ£o encontradas. Criando permissÃµes padrÃ£o...
PermissÃµes padrÃ£o criadas com sucesso!
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ (index) â”‚ Nome            â”‚ DescriÃ§Ã£o                                                                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 0       â”‚ 'ROOT'          â”‚ 'SuperusuÃ¡rio. Acesso irrestrito a todos os dados e configuraÃ§Ãµes do sistema.'                   â”‚
â”‚ 1       â”‚ 'ADMIN_COMPANY' â”‚ 'Administrador de uma empresa. Pode gerenciar usuÃ¡rios e todos os dados da sua prÃ³pria empresa.' â”‚
â”‚ 2       â”‚ 'USER_COMPANY'  â”‚ 'UsuÃ¡rio padrÃ£o. Pode criar e gerenciar seus prÃ³prios dados dentro da empresa.'                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â³ Iniciando servidor Smart GestÃ£o (startServer)...
ConexÃ£o com o MongoDB estabelecida com sucesso.
âœ… [1/1] ConexÃ£o com o banco de dados estabelecida!
âœ… Servidor rodando na porta 5000
--- âœ… [GLOBAL SETUP] Ambiente pronto e servidor iniciado ---
(node:5912) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
  console.log
    
    --- Configurando 3 empresas para o teste multi-tenant ---

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:35:17)

[0mPOST /api/auth/register [32m201[0m 159.624 ms - 355[0m
[LOG] AÃ§Ã£o: REGISTER_COMPANY_USER | UsuÃ¡rio: N/A
[0mPOST /api/auth/login [32m200[0m 113.694 ms - 698[0m
  console.log
    âœ… Empresa 1 (Empresa Teste 1763160819501) cadastrada e logada.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:64:21)

[LOG] AÃ§Ã£o: LOGIN_USER | UsuÃ¡rio: N/A
[0mPOST /api/auth/register [32m201[0m 144.601 ms - 355[0m
[LOG] AÃ§Ã£o: REGISTER_COMPANY_USER | UsuÃ¡rio: N/A
[0mPOST /api/auth/login [32m200[0m 109.429 ms - 698[0m
  console.log
    âœ… Empresa 2 (Empresa Teste 1763160819825) cadastrada e logada.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:64:21)

[LOG] AÃ§Ã£o: LOGIN_USER | UsuÃ¡rio: N/A
[0mPOST /api/auth/register [32m201[0m 141.575 ms - 355[0m
[LOG] AÃ§Ã£o: REGISTER_COMPANY_USER | UsuÃ¡rio: N/A
[0mPOST /api/auth/login [32m200[0m 101.500 ms - 698[0m
  console.log
    âœ… Empresa 3 (Empresa Teste 1763160820087) cadastrada e logada.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:64:21)

  console.log
    --- ConfiguraÃ§Ã£o multi-tenant concluÃ­da ---

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:66:17)

  console.log
    
    --- Criando transaÃ§Ãµes individuais para cada empresa ---

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:71:17)

[LOG] AÃ§Ã£o: LOGIN_USER | UsuÃ¡rio: N/A
[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 6917b2f3a63ee6f4ef255ac8
[0mPOST /api/transactions [32m201[0m 46.991 ms - 437[0m
  console.log
    TransaÃ§Ã£o criada para Empresa Teste 1763160819501. ID: 6917b2f4a63ee6f4ef255aee

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:92:21)

[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 6917b2f3a63ee6f4ef255ac8
[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 6917b2f3a63ee6f4ef255ad6
[0mPOST /api/transactions [32m201[0m 45.279 ms - 436[0m
  console.log
    TransaÃ§Ã£o criada para Empresa Teste 1763160819825. ID: 6917b2f4a63ee6f4ef255af5

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:92:21)

[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 6917b2f3a63ee6f4ef255ad6
[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 6917b2f4a63ee6f4ef255ae4
[0mPOST /api/transactions [32m201[0m 44.986 ms - 429[0m
  console.log
    TransaÃ§Ã£o criada para Empresa Teste 1763160820087. ID: 6917b2f4a63ee6f4ef255afc

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:92:21)

  console.log
    
    --- Validando isolamento de dados entre todas as empresas ---

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:98:17)

  console.log
    
    Verificando a transaÃ§Ã£o 6917b2f4a63ee6f4ef255aee da Empresa Teste 1763160819501

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:105:21)

[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 6917b2f4a63ee6f4ef255ae4
[0mGET /api/transactions/6917b2f4a63ee6f4ef255aee [33m404[0m 27.802 ms - 38[0m
  console.log
    - OK: Empresa Teste 1763160819825 foi bloqueada (Status 404).

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:123:29)

[0mGET /api/transactions/6917b2f4a63ee6f4ef255aee [33m404[0m 25.012 ms - 38[0m
  console.log
    - OK: Empresa Teste 1763160820087 foi bloqueada (Status 404).

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:123:29)

  console.log
    
    Verificando a transaÃ§Ã£o 6917b2f4a63ee6f4ef255af5 da Empresa Teste 1763160819825

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:105:21)

[0mGET /api/transactions/6917b2f4a63ee6f4ef255af5 [33m404[0m 25.593 ms - 38[0m
  console.log
    - OK: Empresa Teste 1763160819501 foi bloqueada (Status 404).

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:123:29)

[0mGET /api/transactions/6917b2f4a63ee6f4ef255af5 [33m404[0m 26.615 ms - 38[0m
  console.log
    - OK: Empresa Teste 1763160820087 foi bloqueada (Status 404).

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:123:29)

  console.log
    
    Verificando a transaÃ§Ã£o 6917b2f4a63ee6f4ef255afc da Empresa Teste 1763160820087

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:105:21)

[0mGET /api/transactions/6917b2f4a63ee6f4ef255afc [33m404[0m 28.125 ms - 38[0m
  console.log
    - OK: Empresa Teste 1763160819501 foi bloqueada (Status 404).

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:123:29)

[0mGET /api/transactions/6917b2f4a63ee6f4ef255afc [33m404[0m 25.888 ms - 38[0m
  console.log
    - OK: Empresa Teste 1763160819825 foi bloqueada (Status 404).

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:123:29)

  console.log
    
    --- Validando listagem de transaÃ§Ãµes ---

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:130:17)

[0mGET /api/transactions [32m200[0m 26.462 ms - 423[0m
  console.log
    - OK: Empresa Teste 1763160819501 listou apenas sua prÃ³pria transaÃ§Ã£o.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:142:21)

[0mGET /api/transactions [32m200[0m 27.099 ms - 422[0m
  console.log
    - OK: Empresa Teste 1763160819825 listou apenas sua prÃ³pria transaÃ§Ã£o.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:142:21)

[0mGET /api/transactions [32m200[0m 25.729 ms - 415[0m
  console.log
    - OK: Empresa Teste 1763160820087 listou apenas sua prÃ³pria transaÃ§Ã£o.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:142:21)

  console.log
    
    --- Limpando dados de teste (Teardown) ---

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:148:17)

[0mDELETE /api/auth/users/6917b2f3a63ee6f4ef255ac8 [32m200[0m 72.790 ms - 107[0m
  console.log
    - âœ… Empresa Empresa Teste 1763160819501 e dados associados excluÃ­dos com sucesso.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:155:25)

[LOG] AÃ§Ã£o: DELETE_USER_BY_ID | UsuÃ¡rio: 6917b2f3a63ee6f4ef255ac8
[0mDELETE /api/auth/users/6917b2f3a63ee6f4ef255ad6 [32m200[0m 72.085 ms - 107[0m
  console.log
    - âœ… Empresa Empresa Teste 1763160819825 e dados associados excluÃ­dos com sucesso.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:155:25)

[LOG] AÃ§Ã£o: DELETE_USER_BY_ID | UsuÃ¡rio: 6917b2f3a63ee6f4ef255ad6
[0mDELETE /api/auth/users/6917b2f4a63ee6f4ef255ae4 [32m200[0m 73.155 ms - 107[0m
  console.log
    - âœ… Empresa Empresa Teste 1763160820087 e dados associados excluÃ­dos com sucesso.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:155:25)

PASS Testes/3-security/multi-tenant.test.js
  3. Teste de Isolamento de Dados (Multi-Tenant)
    âˆš deve criar uma transaÃ§Ã£o para cada empresa (156 ms)
    âˆš deve impedir que uma empresa acesse a transaÃ§Ã£o de outra (182 ms)
    âˆš deve garantir que cada empresa liste apenas suas prÃ³prias transaÃ§Ãµes (90 ms)

[LOG] AÃ§Ã£o: DELETE_USER_BY_ID | UsuÃ¡rio: 6917b2f4a63ee6f4ef255ae4
[0mPOST /api/auth/register [32m201[0m 140.175 ms - 357[0m
[LOG] AÃ§Ã£o: REGISTER_COMPANY_USER | UsuÃ¡rio: N/A
[0mPOST /api/auth/login [32m200[0m 102.818 ms - 700[0m
[LOG] AÃ§Ã£o: LOGIN_USER | UsuÃ¡rio: N/A
[0mPOST /api/auth/register [32m201[0m 134.894 ms - 355[0m
[LOG] AÃ§Ã£o: REGISTER_COMPANY_USER | UsuÃ¡rio: N/A
[0mPOST /api/auth/login [32m200[0m 98.139 ms - 698[0m
[LOG] AÃ§Ã£o: LOGIN_USER | UsuÃ¡rio: N/A
[0mPOST /api/auth/register [32m201[0m 145.141 ms - 351[0m
[LOG] AÃ§Ã£o: REGISTER_COMPANY_USER | UsuÃ¡rio: N/A
[0mPOST /api/auth/login [32m200[0m 91.660 ms - 694[0m
[LOG] AÃ§Ã£o: LOGIN_USER | UsuÃ¡rio: N/A
PASS Testes/3-security/persistence.test.js (5.952 s)
  Security: PersistÃªncia de Dados Manuais
    âˆš deve garantir que os usuÃ¡rios de teste manuais permaneÃ§am no banco apÃ³s a execuÃ§Ã£o de `npm test` (5398 ms)

Test Suites: 2 passed, 2 total
Tests:       4 passed, 4 total
Snapshots:   0 total
Time:        7.876 s
Ran all test suites matching Testes/3-security.

--- ğŸ§¹ [GLOBAL TEARDOWN] Finalizando ambiente de teste ---
   - [OK] Dados de teste temporÃ¡rios foram removidos.
âœ… Servidor e conexÃ£o com MongoDB encerrados (stopServer).
--- âœ… [GLOBAL TEARDOWN] Ambiente finalizado com sucesso ---
