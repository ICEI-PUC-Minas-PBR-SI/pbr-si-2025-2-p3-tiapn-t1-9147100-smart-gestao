
--- üöÄ [ETAPA 1 de 4] Iniciando Ambiente de Teste (Jest Environment) ---
   - [PROCESSO] Lendo configura√ß√£o do banco de dados de teste...
   - [ATEN√á√ÉO] Usando banco de dados de DESENVOLVIMENTO para os testes. As cole√ß√µes ser√£o limpas.

--- üöÄ [ETAPA 2 de 4] Limpando e populando o banco de dados de TESTE ---
   - [OK] Dados de teste (empresas e usu√°rios) injetados no ambiente global.
  console.log
    
    --- Teste: Solicitar reset para e-mail inv√°lido ---

      at Object.<anonymous> (Testes/1-auth/password.test.js:25:13)

(node:6364) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
  console.log
    ‚úÖ Falhou como esperado para e-mail inexistente (Status 404).

      at Object.<anonymous> (Testes/1-auth/password.test.js:34:15)

  console.log
    
    --- Teste: Gerar token de reset com sucesso ---

      at Object.<anonymous> (Testes/1-auth/password.test.js:39:13)

  console.log
    
    --- Teste: Resetar senha com token v√°lido ---

      at Object.<anonymous> (Testes/1-auth/password.test.js:55:13)

  console.log
    ‚úÖ Senha resetada com sucesso via API.

      at Object.<anonymous> (Testes/1-auth/password.test.js:72:13)


--- üßπ [ENV] Desconectando do banco de dados ---
--- ‚úÖ [ENV] Ambiente de teste finalizado ---
 FAIL  Testes/1-auth/password.test.js (21.62 s)
  9. M√≥dulo de Recupera√ß√£o de Senha
    ‚àö deve falhar ao solicitar reset para um e-mail inexistente (80 ms)
    √ó deve gerar e salvar um token de reset para um e-mail v√°lido (10056 ms)
    √ó deve resetar a senha com um token v√°lido e permitir login com a nova senha (10169 ms)

  ‚óè 9. M√≥dulo de Recupera√ß√£o de Senha ‚Ä∫ deve gerar e salvar um token de reset para um e-mail v√°lido

    MongooseError: Operation `users.findOne()` buffering timed out after 10000ms

      at Timeout.<anonymous> (node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:187:23)

  ‚óè 9. M√≥dulo de Recupera√ß√£o de Senha ‚Ä∫ deve resetar a senha com um token v√°lido e permitir login com a nova senha

    MongooseError: Operation `users.findOne()` buffering timed out after 10000ms

      at Timeout.<anonymous> (node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:187:23)


--- üöÄ [ETAPA 1 de 4] Iniciando Ambiente de Teste (Jest Environment) ---
   - [PROCESSO] Lendo configura√ß√£o do banco de dados de teste...
   - [ATEN√á√ÉO] Usando banco de dados de DESENVOLVIMENTO para os testes. As cole√ß√µes ser√£o limpas.

--- üöÄ [ETAPA 2 de 4] Limpando e populando o banco de dados de TESTE ---
   - [OK] Dados de teste (empresas e usu√°rios) injetados no ambiente global.

--- üßπ [ENV] Desconectando do banco de dados ---
--- ‚úÖ [ENV] Ambiente de teste finalizado ---
 PASS  Testes/1-auth/auth.test.js
  6. M√≥dulo de Autentica√ß√£o e Sess√£o (Stateful)
    ‚àö deve criar um SessionToken no banco de dados ap√≥s o login (116 ms)
    ‚àö deve invalidar o SessionToken no banco de dados ap√≥s o logout (119 ms)


--- üöÄ [ETAPA 1 de 4] Iniciando Ambiente de Teste (Jest Environment) ---
   - [PROCESSO] Lendo configura√ß√£o do banco de dados de teste...
   - [ATEN√á√ÉO] Usando banco de dados de DESENVOLVIMENTO para os testes. As cole√ß√µes ser√£o limpas.

--- üöÄ [ETAPA 2 de 4] Limpando e populando o banco de dados de TESTE ---
   - [OK] Dados de teste (empresas e usu√°rios) injetados no ambiente global.

--- üßπ [ENV] Desconectando do banco de dados ---
--- ‚úÖ [ENV] Ambiente de teste finalizado ---
 FAIL  Testes/2-features/clients.test.js
  7. M√≥dulo de Clientes/Fornecedores
    √ó deve CRIAR um novo cliente com sucesso (15 ms)
    √ó deve LISTAR os clientes da empresa (7 ms)
    √ó deve ATUALIZAR um cliente existente (6 ms)
    √ó deve EXCLUIR um cliente existente (9 ms)

  ‚óè 7. M√≥dulo de Clientes/Fornecedores ‚Ä∫ deve CRIAR um novo cliente com sucesso

    AxiosError: Request failed with status code 401

      25 |     };
      26 |
    > 27 |     const response = await axios.post(`${API_URL}/clients`, newClient, {
         |                      ^
      28 |       headers: { Authorization: `Bearer ${userToken}` },
      29 |     });
      30 |

      at settle (node_modules/axios/lib/core/settle.js:19:12)
      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:793:11)
      at Axios.request (node_modules/axios/lib/core/Axios.js:45:41)
      at Object.<anonymous> (Testes/2-features/clients.test.js:27:22)

  ‚óè 7. M√≥dulo de Clientes/Fornecedores ‚Ä∫ deve LISTAR os clientes da empresa

    AxiosError: Request failed with status code 401

      36 |
      37 |   it('deve LISTAR os clientes da empresa', async () => {
    > 38 |     const response = await axios.get(`${API_URL}/clients`, {
         |                      ^
      39 |       headers: { Authorization: `Bearer ${userToken}` },
      40 |     });
      41 |

      at settle (node_modules/axios/lib/core/settle.js:19:12)
      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:793:11)
      at Axios.request (node_modules/axios/lib/core/Axios.js:45:41)
      at Object.<anonymous> (Testes/2-features/clients.test.js:38:22)

  ‚óè 7. M√≥dulo de Clientes/Fornecedores ‚Ä∫ deve ATUALIZAR um cliente existente

    AxiosError: Request failed with status code 401

      51 |     };
      52 |
    > 53 |     const response = await axios.put(`${API_URL}/clients/${createdClientId}`, updatedData, {
         |                      ^
      54 |       headers: { Authorization: `Bearer ${userToken}` },
      55 |     });
      56 |

      at settle (node_modules/axios/lib/core/settle.js:19:12)
      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:793:11)
      at Axios.request (node_modules/axios/lib/core/Axios.js:45:41)
      at Object.<anonymous> (Testes/2-features/clients.test.js:53:22)

  ‚óè 7. M√≥dulo de Clientes/Fornecedores ‚Ä∫ deve EXCLUIR um cliente existente

    AxiosError: Request failed with status code 401

      60 |
      61 |   it('deve EXCLUIR um cliente existente', async () => {
    > 62 |     const response = await axios.delete(`${API_URL}/clients/${createdClientId}`, {
         |                      ^
      63 |       headers: { Authorization: `Bearer ${userToken}` },
      64 |     });
      65 |

      at settle (node_modules/axios/lib/core/settle.js:19:12)
      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:793:11)
      at Axios.request (node_modules/axios/lib/core/Axios.js:45:41)
      at Object.<anonymous> (Testes/2-features/clients.test.js:62:22)


--- üöÄ [ETAPA 1 de 4] Iniciando Ambiente de Teste (Jest Environment) ---
   - [PROCESSO] Lendo configura√ß√£o do banco de dados de teste...
   - [ATEN√á√ÉO] Usando banco de dados de DESENVOLVIMENTO para os testes. As cole√ß√µes ser√£o limpas.

--- üöÄ [ETAPA 2 de 4] Limpando e populando o banco de dados de TESTE ---
   - [OK] Dados de teste (empresas e usu√°rios) injetados no ambiente global.

--- üßπ [ENV] Desconectando do banco de dados ---
--- ‚úÖ [ENV] Ambiente de teste finalizado ---
 FAIL  Testes/2-features/goals.test.js
  5. M√≥dulo de Metas (CRUD)
    √ó deve CRIAR uma nova meta com sucesso (11 ms)
    √ó deve LISTAR as metas do usu√°rio logado (2 ms)
    √ó deve ATUALIZAR uma meta existente (1 ms)
    √ó deve EXCLUIR uma meta existente (1 ms)

  ‚óè 5. M√≥dulo de Metas (CRUD) ‚Ä∫ deve CRIAR uma nova meta com sucesso

    AxiosError: Request failed with status code 401

      26 |         };
      27 |
    > 28 |         const response = await axios.post(`${API_URL}/goals`, goalData, {
         |                          ^
      29 |             headers: { Authorization: `Bearer ${userToken}` }
      30 |         });
      31 |

      at settle (node_modules/axios/lib/core/settle.js:19:12)
      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:793:11)
      at Axios.request (node_modules/axios/lib/core/Axios.js:45:41)
      at Object.<anonymous> (Testes/2-features/goals.test.js:28:26)

  ‚óè 5. M√≥dulo de Metas (CRUD) ‚Ä∫ deve LISTAR as metas do usu√°rio logado

    expect(received).toBeDefined()

    Received: undefined

      39 |
      40 |     it('deve LISTAR as metas do usu√°rio logado', async () => {
    > 41 |         expect(createdGoalId).toBeDefined();
         |                               ^
      42 |
      43 |         const response = await axios.get(`${API_URL}/goals`, {
      44 |             headers: { Authorization: `Bearer ${userToken}` }

      at Object.<anonymous> (Testes/2-features/goals.test.js:41:31)

  ‚óè 5. M√≥dulo de Metas (CRUD) ‚Ä∫ deve ATUALIZAR uma meta existente

    expect(received).toBeDefined()

    Received: undefined

      52 |
      53 |     it('deve ATUALIZAR uma meta existente', async () => {
    > 54 |         expect(createdGoalId).toBeDefined();
         |                               ^
      55 |
      56 |         const updatedData = {
      57 |             title: 'Economizar para novo maquin√°rio (URGENTE)',

      at Object.<anonymous> (Testes/2-features/goals.test.js:54:31)

  ‚óè 5. M√≥dulo de Metas (CRUD) ‚Ä∫ deve EXCLUIR uma meta existente

    expect(received).toBeDefined()

    Received: undefined

      69 |
      70 |     it('deve EXCLUIR uma meta existente', async () => {
    > 71 |         expect(createdGoalId).toBeDefined();
         |                               ^
      72 |
      73 |         const response = await axios.delete(`${API_URL}/goals/${createdGoalId}`, {
      74 |             headers: { Authorization: `Bearer ${userToken}` }

      at Object.<anonymous> (Testes/2-features/goals.test.js:71:31)


--- üöÄ [ETAPA 1 de 4] Iniciando Ambiente de Teste (Jest Environment) ---
   - [PROCESSO] Lendo configura√ß√£o do banco de dados de teste...
   - [ATEN√á√ÉO] Usando banco de dados de DESENVOLVIMENTO para os testes. As cole√ß√µes ser√£o limpas.

--- üöÄ [ETAPA 2 de 4] Limpando e populando o banco de dados de TESTE ---
   - [OK] Dados de teste (empresas e usu√°rios) injetados no ambiente global.
  console.log
    
    --- Configurando 3 empresas para o teste multi-tenant ---

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:19:17)

  console.log
    ‚úÖ Empresa 1 (Empresa Teste 1762971970891) cadastrada e logada.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:48:21)

  console.log
    ‚úÖ Empresa 2 (Empresa Teste 1762971971139) cadastrada e logada.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:48:21)

  console.log
    ‚úÖ Empresa 3 (Empresa Teste 1762971971404) cadastrada e logada.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:48:21)

  console.log
    --- Configura√ß√£o multi-tenant conclu√≠da ---

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:50:17)

  console.log
    
    --- Criando transa√ß√µes individuais para cada empresa ---

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:55:17)

  console.log
    Transa√ß√£o criada para Empresa Teste 1762971970891. ID: 6914d1431604e3f31b8ac43e

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:76:21)

  console.log
    Transa√ß√£o criada para Empresa Teste 1762971971139. ID: 6914d1431604e3f31b8ac445

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:76:21)

  console.log
    Transa√ß√£o criada para Empresa Teste 1762971971404. ID: 6914d1431604e3f31b8ac44c

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:76:21)

  console.log
    
    --- Validando isolamento de dados entre todas as empresas ---

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:82:17)

  console.log
    
    Verificando a transa√ß√£o 6914d1431604e3f31b8ac43e da Empresa Teste 1762971970891

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:89:21)

  console.log
    - OK: Empresa Teste 1762971971139 foi bloqueada (Status 404).

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:107:29)

  console.log
    - OK: Empresa Teste 1762971971404 foi bloqueada (Status 404).

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:107:29)

  console.log
    
    Verificando a transa√ß√£o 6914d1431604e3f31b8ac445 da Empresa Teste 1762971971139

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:89:21)

  console.log
    - OK: Empresa Teste 1762971970891 foi bloqueada (Status 404).

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:107:29)

  console.log
    - OK: Empresa Teste 1762971971404 foi bloqueada (Status 404).

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:107:29)

  console.log
    
    Verificando a transa√ß√£o 6914d1431604e3f31b8ac44c da Empresa Teste 1762971971404

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:89:21)

  console.log
    - OK: Empresa Teste 1762971970891 foi bloqueada (Status 404).

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:107:29)

  console.log
    - OK: Empresa Teste 1762971971139 foi bloqueada (Status 404).

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:107:29)

  console.log
    
    --- Validando listagem de transa√ß√µes ---

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:114:17)

  console.log
    - OK: Empresa Teste 1762971970891 listou apenas sua pr√≥pria transa√ß√£o.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:126:21)

  console.log
    - OK: Empresa Teste 1762971971139 listou apenas sua pr√≥pria transa√ß√£o.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:126:21)

  console.log
    - OK: Empresa Teste 1762971971404 listou apenas sua pr√≥pria transa√ß√£o.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:126:21)

  console.log
    
    --- Limpando dados de teste (Teardown) ---

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:132:17)

  console.log
    - ‚úÖ Empresa Empresa Teste 1762971970891 e dados associados exclu√≠dos com sucesso.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:139:25)

  console.log
    - ‚úÖ Empresa Empresa Teste 1762971971139 e dados associados exclu√≠dos com sucesso.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:139:25)

  console.log
    - ‚úÖ Empresa Empresa Teste 1762971971404 e dados associados exclu√≠dos com sucesso.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:139:25)


--- üßπ [ENV] Desconectando do banco de dados ---
--- ‚úÖ [ENV] Ambiente de teste finalizado ---
 PASS  Testes/3-security/multi-tenant.test.js
  3. Teste de Isolamento de Dados em Larga Escala (Multi-Tenant)
    ‚àö deve criar uma transa√ß√£o para cada empresa (153 ms)
    ‚àö deve impedir que uma empresa acesse a transa√ß√£o de outra (179 ms)
    ‚àö deve garantir que cada empresa liste apenas suas pr√≥prias transa√ß√µes (89 ms)


--- üöÄ [ETAPA 1 de 4] Iniciando Ambiente de Teste (Jest Environment) ---
   - [PROCESSO] Lendo configura√ß√£o do banco de dados de teste...
   - [ATEN√á√ÉO] Usando banco de dados de DESENVOLVIMENTO para os testes. As cole√ß√µes ser√£o limpas.

--- üöÄ [ETAPA 2 de 4] Limpando e populando o banco de dados de TESTE ---
   - [OK] Dados de teste (empresas e usu√°rios) injetados no ambiente global.

--- üßπ [ENV] Desconectando do banco de dados ---
--- ‚úÖ [ENV] Ambiente de teste finalizado ---
 FAIL  Testes/2-features/transactions.test.js
  4. M√≥dulo de Transa√ß√µes (CRUD)
    √ó deve CRIAR uma nova transa√ß√£o com sucesso (10 ms)
    √ó deve falhar ao tentar criar uma transa√ß√£o com dados inv√°lidos (6 ms)
    √ó deve LISTAR as transa√ß√µes do usu√°rio logado (1 ms)
    √ó deve OBTER uma transa√ß√£o espec√≠fica pelo ID
    √ó deve ATUALIZAR uma transa√ß√£o existente
    √ó deve EXCLUIR uma transa√ß√£o existente

  ‚óè 4. M√≥dulo de Transa√ß√µes (CRUD) ‚Ä∫ deve CRIAR uma nova transa√ß√£o com sucesso

    AxiosError: Request failed with status code 401

      45 |         };
      46 |
    > 47 |         const response = await axios.post(`${API_URL}/transactions`, transactionData, {
         |                          ^
      48 |             headers: { Authorization: `Bearer ${userToken}` }
      49 |         });
      50 |

      at settle (node_modules/axios/lib/core/settle.js:19:12)
      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:793:11)
      at Axios.request (node_modules/axios/lib/core/Axios.js:45:41)
      at Object.<anonymous> (Testes/2-features/transactions.test.js:47:26)

  ‚óè 4. M√≥dulo de Transa√ß√µes (CRUD) ‚Ä∫ deve falhar ao tentar criar uma transa√ß√£o com dados inv√°lidos

    expect(received).toBe(expected) // Object.is equality

    Expected: 500
    Received: 401

      76 |             fail('A cria√ß√£o de transa√ß√£o com dados inv√°lidos deveria ter falhado.');
      77 |         } catch (error) {
    > 78 |             expect(error.response.status).toBe(500); // Mongoose validation error results in 500 in this setup
         |                                           ^
      79 |         }
      80 |     });
      81 |

      at Object.<anonymous> (Testes/2-features/transactions.test.js:78:43)

  ‚óè 4. M√≥dulo de Transa√ß√µes (CRUD) ‚Ä∫ deve LISTAR as transa√ß√µes do usu√°rio logado

    expect(received).toBeDefined()

    Received: undefined

      82 |     it('deve LISTAR as transa√ß√µes do usu√°rio logado', async () => {
      83 |         // Este teste depende que o anterior tenha criado uma transa√ß√£o
    > 84 |         expect(createdTransactionId).toBeDefined();
         |                                      ^
      85 |
      86 |         const response = await axios.get(`${API_URL}/transactions`, {
      87 |             headers: { Authorization: `Bearer ${userToken}` }

      at Object.<anonymous> (Testes/2-features/transactions.test.js:84:38)

  ‚óè 4. M√≥dulo de Transa√ß√µes (CRUD) ‚Ä∫ deve OBTER uma transa√ß√£o espec√≠fica pelo ID

    expect(received).toBeDefined()

    Received: undefined

       98 |
       99 |     it('deve OBTER uma transa√ß√£o espec√≠fica pelo ID', async () => {
    > 100 |         expect(createdTransactionId).toBeDefined();
          |                                      ^
      101 |
      102 |         const response = await axios.get(`${API_URL}/transactions/${createdTransactionId}`, {
      103 |             headers: { Authorization: `Bearer ${userToken}` }

      at Object.<anonymous> (Testes/2-features/transactions.test.js:100:38)

  ‚óè 4. M√≥dulo de Transa√ß√µes (CRUD) ‚Ä∫ deve ATUALIZAR uma transa√ß√£o existente

    expect(received).toBeDefined()

    Received: undefined

      110 |
      111 |     it('deve ATUALIZAR uma transa√ß√£o existente', async () => {
    > 112 |         expect(createdTransactionId).toBeDefined();
          |                                      ^
      113 |
      114 |         const updatedData = {
      115 |             description: 'Venda de consultoria (Valor Atualizado)',

      at Object.<anonymous> (Testes/2-features/transactions.test.js:112:38)

  ‚óè 4. M√≥dulo de Transa√ß√µes (CRUD) ‚Ä∫ deve EXCLUIR uma transa√ß√£o existente

    expect(received).toBeDefined()

    Received: undefined

      128 |
      129 |     it('deve EXCLUIR uma transa√ß√£o existente', async () => {
    > 130 |         expect(createdTransactionId).toBeDefined();
          |                                      ^
      131 |
      132 |         const response = await axios.delete(`${API_URL}/transactions/${createdTransactionId}`, {
      133 |             headers: { Authorization: `Bearer ${userToken}` }

      at Object.<anonymous> (Testes/2-features/transactions.test.js:130:38)


--- üöÄ [ETAPA 1 de 4] Iniciando Ambiente de Teste (Jest Environment) ---
   - [PROCESSO] Lendo configura√ß√£o do banco de dados de teste...
   - [ATEN√á√ÉO] Usando banco de dados de DESENVOLVIMENTO para os testes. As cole√ß√µes ser√£o limpas.

--- üöÄ [ETAPA 2 de 4] Limpando e populando o banco de dados de TESTE ---
   - [OK] Dados de teste (empresas e usu√°rios) injetados no ambiente global.

--- üßπ [ENV] Desconectando do banco de dados ---
--- ‚úÖ [ENV] Ambiente de teste finalizado ---
 FAIL  Testes/4-reports/reports.test.js
  8. M√≥dulo de Relat√≥rios
    √ó deve EXPORTAR um relat√≥rio de transa√ß√µes em formato PDF (14 ms)

  ‚óè 8. M√≥dulo de Relat√≥rios ‚Ä∫ deve EXPORTAR um relat√≥rio de transa√ß√µes em formato PDF

    AxiosError: Request failed with status code 401

      27 |
      28 |   test('deve EXPORTAR um relat√≥rio de transa√ß√µes em formato PDF', async () => {
    > 29 |     const response = await axios.get(`${API_URL}/reports/export/transactions-pdf`, {
         |                      ^
      30 |       headers: { Authorization: `Bearer ${companyA.token}` },
      31 |       responseType: 'arraybuffer', // Importante para receber arquivos bin√°rios
      32 |     });

      at settle (node_modules/axios/lib/core/settle.js:19:12)
      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:793:11)
      at Axios.request (node_modules/axios/lib/core/Axios.js:45:41)
      at Object.<anonymous> (Testes/4-reports/reports.test.js:29:22)

Test Suites: 5 failed, 2 passed, 7 total
Tests:       17 failed, 6 passed, 23 total
Snapshots:   0 total
Time:        29.033 s, estimated 50 s
Ran all test suites.

--- FIM DOS TESTES AUTOMATIZADOS (Status: Falha) ---
