
--- ðŸš€ [GLOBAL SETUP] Iniciando ambiente de teste ---
Verificando permissÃµes de sistema...
PermissÃµes nÃ£o encontradas. Criando permissÃµes padrÃ£o...
PermissÃµes padrÃ£o criadas com sucesso!
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ (index) â”‚ Nome            â”‚ DescriÃ§Ã£o                                                                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 0       â”‚ 'ROOT'          â”‚ 'SuperusuÃ¡rio. Acesso irrestrito a todos os dados e configuraÃ§Ãµes do sistema.'                   â”‚
â”‚ 1       â”‚ 'ADMIN_COMPANY' â”‚ 'Administrador de uma empresa. Pode gerenciar usuÃ¡rios e todos os dados da sua prÃ³pria empresa.' â”‚
â”‚ 2       â”‚ 'USER_COMPANY'  â”‚ 'UsuÃ¡rio padrÃ£o. Pode criar e gerenciar seus prÃ³prios dados dentro da empresa.'                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â³ Iniciando servidor Smart GestÃ£o (startServer)...
ConexÃ£o com o MongoDB estabelecida com sucesso.
âœ… [1/1] ConexÃ£o com o banco de dados estabelecida!
âœ… Servidor rodando na porta 5000
--- âœ… [GLOBAL SETUP] Ambiente pronto e servidor iniciado ---
(node:25588) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
[0mGET /api/reports/export/transactions-pdf [31m500[0m 50.121 ms - 91[0m
[0mGET /api/reports/export/clients-pdf [32m200[0m 721.341 ms - -[0m
[PDF SAVED FOR TEST] F:\Programacao\GitHub\pbr-si-2025-2-p3-tiapn-t1-9147100-smart-gestao\src\codes\backend\Testes\PDFs\clients\relatorio-clientes-2025-11-14T22-13-06-415Z.pdf
[0mGET /api/reports/export/invoice/6917a96e34db29905b3e85d5 [31m500[0m 55.814 ms - 71[0m
FAIL Testes/4-reports/reports.test.js
  8. MÃ³dulo de RelatÃ³rios
    Ã— deve chamar o serviÃ§o de PDF com os dados corretos para o RELATÃ“RIO DE TRANSAÃ‡Ã•ES (125 ms)
    Ã— deve chamar o serviÃ§o de PDF com os dados corretos para o RELATÃ“RIO DE CLIENTES (740 ms)
    Ã— deve chamar o serviÃ§o de PDF com os dados corretos para a FATURA (61 ms)

  â— 8. MÃ³dulo de RelatÃ³rios â€º deve chamar o serviÃ§o de PDF com os dados corretos para o RELATÃ“RIO DE TRANSAÃ‡Ã•ES

    AxiosError: Request failed with status code 500

    [0m [90m 64 |[39m   test([32m'deve chamar o serviÃ§o de PDF com os dados corretos para o RELATÃ“RIO DE TRANSAÃ‡Ã•ES'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m 65 |[39m     [90m// 1. AÃ§Ã£o: Simula o cliente (frontend) chamando o endpoint para gerar o relatÃ³rio.[39m
    [31m[1m>[22m[39m[90m 66 |[39m     [36mawait[39m axios[33m.[39m[36mget[39m([32m`${API_URL}/reports/export/transactions-pdf`[39m[33m,[39m {
     [90m    |[39m     [31m[1m^[22m[39m
     [90m 67 |[39m       headers[33m:[39m { [33mAuthorization[39m[33m:[39m [32m`Bearer ${companyA.token}`[39m }
     [90m 68 |[39m     })[33m;[39m
     [90m 69 |[39m[0m

      at settle (node_modules/axios/lib/core/settle.js:19:12)
      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:793:11)
      at Axios.request (node_modules/axios/lib/core/Axios.js:45:41)
      at Object.<anonymous> (Testes/4-reports/reports.test.js:66:5)

  â— 8. MÃ³dulo de RelatÃ³rios â€º deve chamar o serviÃ§o de PDF com os dados corretos para o RELATÃ“RIO DE CLIENTES

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

    [0m [90m 88 |[39m
     [90m 89 |[39m     [90m// 2. VerificaÃ§Ã£o Principal: Garante que a funÃ§Ã£o correta do serviÃ§o de PDF foi acionada.[39m
    [31m[1m>[22m[39m[90m 90 |[39m     expect(generateClientsReportPDF)[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m    |[39m                                      [31m[1m^[22m[39m
     [90m 91 |[39m
     [90m 92 |[39m     [90m// 3. ValidaÃ§Ã£o dos Dados: Verifica se os dados passados para a geraÃ§Ã£o do PDF estÃ£o corretos.[39m
     [90m 93 |[39m     [36mconst[39m capturedData [33m=[39m generateClientsReportPDF[33m.[39mmock[33m.[39mcalls[[35m0[39m][[35m0[39m][33m;[39m[0m

      at Object.toHaveBeenCalled (Testes/4-reports/reports.test.js:90:38)

  â— 8. MÃ³dulo de RelatÃ³rios â€º deve chamar o serviÃ§o de PDF com os dados corretos para a FATURA

    AxiosError: Request failed with status code 500

    [0m [90m  99 |[39m     [90m// 1. AÃ§Ã£o: Chama o endpoint de exportaÃ§Ã£o da fatura, usando o ID de uma transaÃ§Ã£o de teste[39m
     [90m 100 |[39m     [90m//    que foi criada no ambiente de setup (`mongo-test-environment.js`).[39m
    [31m[1m>[22m[39m[90m 101 |[39m     [36mawait[39m axios[33m.[39m[36mget[39m([32m`${API_URL}/reports/export/invoice/${companyA.testTransaction._id}`[39m[33m,[39m {
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 102 |[39m       headers[33m:[39m { [33mAuthorization[39m[33m:[39m [32m`Bearer ${companyA.token}`[39m }
     [90m 103 |[39m     })[33m;[39m
     [90m 104 |[39m[0m

      at settle (node_modules/axios/lib/core/settle.js:19:12)
      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:793:11)
      at Axios.request (node_modules/axios/lib/core/Axios.js:45:41)
      at Object.<anonymous> (Testes/4-reports/reports.test.js:101:5)

Test Suites: 1 failed, 1 total
Tests:       3 failed, 3 total
Snapshots:   0 total
Time:        2.632 s
Ran all test suites matching Testes/4-reports.

--- ðŸ§¹ [GLOBAL TEARDOWN] Finalizando ambiente de teste ---
   - [OK] Dados de teste temporÃ¡rios foram removidos.
âœ… Servidor e conexÃ£o com MongoDB encerrados (stopServer).
--- âœ… [GLOBAL TEARDOWN] Ambiente finalizado com sucesso ---
