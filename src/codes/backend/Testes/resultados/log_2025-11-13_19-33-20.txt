
--- ðŸš€ [GLOBAL SETUP] Iniciando ambiente de teste ---
â³ Iniciando servidor Smart GestÃ£o (startServer)...
ConexÃ£o com o MongoDB estabelecida com sucesso.
âœ… [1/3] ConexÃ£o com o banco de dados estabelecida!
Verificando permissÃµes de sistema...
PermissÃµes de sistema jÃ¡ existem. Nenhuma aÃ§Ã£o necessÃ¡ria.
âœ… [2/3] PermissÃµes do sistema validadas/inicializadas.
âœ… [3/3] Servidor rodando na porta 5000
--- âœ… [GLOBAL SETUP] Ambiente pronto e servidor iniciado ---
(node:28008) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
POST /api/clients 201 40.658 ms - 335
[LOG] AÃ§Ã£o: CREATE_CLIENT | UsuÃ¡rio: 69165cb30952800e47e68c0d
GET /api/clients 200 33.154 ms - 582
PUT /api/clients/69165cb40952800e47e68c1d 200 34.880 ms - 358
[LOG] AÃ§Ã£o: UPDATE_CLIENT | UsuÃ¡rio: 69165cb30952800e47e68c0d
DELETE /api/clients/69165cb40952800e47e68c1d 200 31.753 ms - 70
GET /api/clients/69165cb40952800e47e68c1d 404 1.277 ms - 175
[LOG] AÃ§Ã£o: DELETE_CLIENT | UsuÃ¡rio: 69165cb30952800e47e68c0d
DELETE /api/clients/69165cb40952800e47e68c1d 404 25.584 ms - 68
PASS Testes/2-features/clients.test.js
  7. MÃ³dulo de Clientes/Fornecedores
    âˆš deve CRIAR um novo cliente com sucesso (86 ms)
    âˆš deve LISTAR os clientes da empresa (39 ms)
    âˆš deve ATUALIZAR um cliente existente (40 ms)
    âˆš deve EXCLUIR um cliente existente (45 ms)

[LOG] AÃ§Ã£o: DELETE_CLIENT | UsuÃ¡rio: 69165cb30952800e47e68c0d
[LOG] AÃ§Ã£o: CREATE_GOAL | UsuÃ¡rio: 69165cb30952800e47e68c0d
POST /api/goals 201 45.074 ms - 404
GET /api/goals 200 27.273 ms - 406
[LOG] AÃ§Ã£o: UPDATE_GOAL | UsuÃ¡rio: 69165cb30952800e47e68c0d
PUT /api/goals/69165cb50952800e47e68c30 200 45.191 ms - 414
[LOG] AÃ§Ã£o: DELETE_GOAL | UsuÃ¡rio: 69165cb30952800e47e68c0d
DELETE /api/goals/69165cb50952800e47e68c30 200 45.931 ms - 67
GET /api/goals/69165cb50952800e47e68c30 404 25.752 ms - 65
DELETE /api/goals/69165cb50952800e47e68c30 404 25.944 ms - 65
PASS Testes/2-features/goals.test.js
  5. MÃ³dulo de Metas (CRUD)
    âˆš deve CRIAR uma nova meta com sucesso (58 ms)
    âˆš deve LISTAR as metas do usuÃ¡rio logado (30 ms)
    âˆš deve ATUALIZAR uma meta existente (50 ms)
    âˆš deve EXCLUIR uma meta existente (87 ms)

[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 69165cb30952800e47e68c0d
POST /api/transactions 201 43.639 ms - 468
[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 69165cb30952800e47e68c0d
POST /api/transactions 400 13.620 ms - 277
[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 69165cb30952800e47e68c0d
GET /api/transactions 200 27.437 ms - 855
GET /api/transactions/69165cb50952800e47e68c43 200 24.680 ms - 452
[LOG] AÃ§Ã£o: UPDATE_TRANSACTION | UsuÃ¡rio: 69165cb30952800e47e68c0d
PUT /api/transactions/69165cb50952800e47e68c43 200 44.609 ms - 452
[LOG] AÃ§Ã£o: UPDATE_TRANSACTION | UsuÃ¡rio: 69165cb30952800e47e68c0d
[LOG] AÃ§Ã£o: DELETE_TRANSACTION | UsuÃ¡rio: 69165cb30952800e47e68c0d
DELETE /api/transactions/69165cb50952800e47e68c43 200 44.661 ms - 73
[LOG] AÃ§Ã£o: DELETE_TRANSACTION | UsuÃ¡rio: 69165cb30952800e47e68c0d
GET /api/transactions/69165cb50952800e47e68c43 404 24.721 ms - 71
DELETE /api/transactions/69165cb50952800e47e68c43 404 25.110 ms - 71
PASS Testes/2-features/transactions.test.js
  4. MÃ³dulo de TransaÃ§Ãµes (CRUD)
    âˆš deve CRIAR uma nova transaÃ§Ã£o com sucesso (56 ms)
    âˆš deve falhar ao tentar criar uma transaÃ§Ã£o com dados invÃ¡lidos (24 ms)
    âˆš deve LISTAR as transaÃ§Ãµes do usuÃ¡rio logado (30 ms)
    âˆš deve OBTER uma transaÃ§Ã£o especÃ­fica pelo ID (28 ms)
    âˆš deve ATUALIZAR uma transaÃ§Ã£o existente (50 ms)
    âˆš deve EXCLUIR uma transaÃ§Ã£o existente (75 ms)

[LOG] AÃ§Ã£o: DELETE_TRANSACTION | UsuÃ¡rio: 69165cb30952800e47e68c0d
[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 69165cb30952800e47e68c0d
POST /api/transactions 201 43.620 ms - 446
POST /api/transactions/69165cb50952800e47e68c64/upload 404 1.518 ms - 188
[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 69165cb30952800e47e68c0d
[LOG] AÃ§Ã£o: DELETE_TRANSACTION | UsuÃ¡rio: 69165cb30952800e47e68c0d
DELETE /api/transactions/69165cb50952800e47e68c64 200 45.143 ms - 73
[LOG] AÃ§Ã£o: DELETE_TRANSACTION | UsuÃ¡rio: 69165cb30952800e47e68c0d
[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 69165cb30952800e47e68c0d
POST /api/transactions 201 49.051 ms - 444
POST /api/transactions/69165cb60952800e47e68c71/upload 404 0.595 ms - 188
[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 69165cb30952800e47e68c0d
[LOG] AÃ§Ã£o: DELETE_TRANSACTION | UsuÃ¡rio: 69165cb30952800e47e68c0d
DELETE /api/transactions/69165cb60952800e47e68c71 200 42.268 ms - 73
[LOG] AÃ§Ã£o: DELETE_TRANSACTION | UsuÃ¡rio: 69165cb30952800e47e68c0d
[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 69165cb30952800e47e68c0d
POST /api/transactions 201 45.563 ms - 444
POST /api/transactions/69165cb60952800e47e68c7e/upload 404 0.590 ms - 188
[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 69165cb30952800e47e68c0d
[LOG] AÃ§Ã£o: DELETE_TRANSACTION | UsuÃ¡rio: 69165cb30952800e47e68c0d
DELETE /api/transactions/69165cb60952800e47e68c7e 200 43.548 ms - 73
[LOG] AÃ§Ã£o: DELETE_TRANSACTION | UsuÃ¡rio: 69165cb30952800e47e68c0d
[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 69165cb30952800e47e68c0d
POST /api/transactions 201 43.718 ms - 445
POST /api/transactions/69165cb60952800e47e68c8b/upload 404 0.595 ms - 188
[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 69165cb30952800e47e68c0d
[LOG] AÃ§Ã£o: DELETE_TRANSACTION | UsuÃ¡rio: 69165cb30952800e47e68c0d
DELETE /api/transactions/69165cb60952800e47e68c8b 200 43.476 ms - 73
POST /api/transactions/60d5f1f77c3d4a001f5e8e1z/upload 404 0.905 ms - 188
FAIL Testes/2-features/uploads.test.js
  Feature: Uploads
    Upload de PDF
      Ã— Deve permitir o upload de um anexo (PDF) para uma transaÃ§Ã£o (22 ms)
      Ã— Deve permitir a exclusÃ£o de um anexo (PDF) de uma transaÃ§Ã£o (2 ms)
    Upload de Imagem (PNG)
      Ã— Deve permitir o upload de um anexo de imagem (.png) para uma transaÃ§Ã£o (4 ms)
      Ã— Deve permitir a exclusÃ£o de um anexo de imagem (.png)
    Upload de Imagem (JPG)
      Ã— Deve permitir o upload de um anexo de imagem (.jpg) para uma transaÃ§Ã£o (3 ms)
      Ã— Deve permitir a exclusÃ£o de um anexo de imagem (.jpg)
    Upload de Imagem (JPEG)
      Ã— Deve permitir o upload de um anexo de imagem (.jpeg) para uma transaÃ§Ã£o (3 ms)
      Ã— Deve permitir a exclusÃ£o de um anexo de imagem (.jpeg)
    CenÃ¡rios de Erro e Estruturais
      âˆš Deve retornar 404 ao tentar fazer upload para uma transaÃ§Ã£o inexistente (4 ms)

  â— Feature: Uploads â€º Upload de PDF â€º Deve permitir o upload de um anexo (PDF) para uma transaÃ§Ã£o

    AxiosError: Request failed with status code 404

      70 |             form.append('attachment', fs.createReadStream(filePath));
      71 |
    > 72 |             const response = await axios.post(
         |                              ^
      73 |                 `${apiUrl}/transactions/${transactionId}/upload`,
      74 |                 form,
      75 |                 { headers: { ...form.getHeaders(), Authorization: `Bearer ${companyA.token}` } }

      at settle (node_modules/axios/lib/core/settle.js:19:12)
      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:793:11)
      at Axios.request (node_modules/axios/lib/core/Axios.js:45:41)
      at Object.<anonymous> (Testes/2-features/uploads.test.js:72:30)

  â— Feature: Uploads â€º Upload de PDF â€º Deve permitir a exclusÃ£o de um anexo (PDF) de uma transaÃ§Ã£o

    expect(received).toBeDefined()

    Received: undefined

      87 |
      88 |         it('Deve permitir a exclusÃ£o de um anexo (PDF) de uma transaÃ§Ã£o', async () => {
    > 89 |             expect(attachmentPath).toBeDefined();
         |                                    ^
      90 |
      91 |             const response = await axios.delete(
      92 |                 `${apiUrl}/transactions/${transactionId}/upload`,

      at Object.toBeDefined (Testes/2-features/uploads.test.js:89:36)

  â— Feature: Uploads â€º Upload de Imagem (PNG) â€º Deve permitir o upload de um anexo de imagem (.png) para uma transaÃ§Ã£o

    AxiosError: Request failed with status code 404

      144 |             form.append('attachment', fs.createReadStream(filePath));
      145 |
    > 146 |             const response = await axios.post(
          |                              ^
      147 |                 `${apiUrl}/transactions/${transactionId}/upload`,
      148 |                 form,
      149 |                 { headers: { ...form.getHeaders(), Authorization: `Bearer ${companyA.token}` } }

      at settle (node_modules/axios/lib/core/settle.js:19:12)
      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:793:11)
      at Axios.request (node_modules/axios/lib/core/Axios.js:45:41)
      at Object.<anonymous> (Testes/2-features/uploads.test.js:146:30)

  â— Feature: Uploads â€º Upload de Imagem (PNG) â€º Deve permitir a exclusÃ£o de um anexo de imagem (.png)

    expect(received).toBeDefined()

    Received: undefined

      160 |
      161 |         it(`Deve permitir a exclusÃ£o de um anexo de imagem (.${extension})`, async () => {
    > 162 |             expect(attachmentPath).toBeDefined();
          |                                    ^
      163 |             const response = await axios.delete(
      164 |                 `${apiUrl}/transactions/${transactionId}/upload`,
      165 |                 { headers: { Authorization: `Bearer ${companyA.token}` } }

      at Object.toBeDefined (Testes/2-features/uploads.test.js:162:36)

  â— Feature: Uploads â€º Upload de Imagem (JPG) â€º Deve permitir o upload de um anexo de imagem (.jpg) para uma transaÃ§Ã£o

    AxiosError: Request failed with status code 404

      144 |             form.append('attachment', fs.createReadStream(filePath));
      145 |
    > 146 |             const response = await axios.post(
          |                              ^
      147 |                 `${apiUrl}/transactions/${transactionId}/upload`,
      148 |                 form,
      149 |                 { headers: { ...form.getHeaders(), Authorization: `Bearer ${companyA.token}` } }

      at settle (node_modules/axios/lib/core/settle.js:19:12)
      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:793:11)
      at Axios.request (node_modules/axios/lib/core/Axios.js:45:41)
      at Object.<anonymous> (Testes/2-features/uploads.test.js:146:30)

  â— Feature: Uploads â€º Upload de Imagem (JPG) â€º Deve permitir a exclusÃ£o de um anexo de imagem (.jpg)

    expect(received).toBeDefined()

    Received: undefined

      160 |
      161 |         it(`Deve permitir a exclusÃ£o de um anexo de imagem (.${extension})`, async () => {
    > 162 |             expect(attachmentPath).toBeDefined();
          |                                    ^
      163 |             const response = await axios.delete(
      164 |                 `${apiUrl}/transactions/${transactionId}/upload`,
      165 |                 { headers: { Authorization: `Bearer ${companyA.token}` } }

      at Object.toBeDefined (Testes/2-features/uploads.test.js:162:36)

  â— Feature: Uploads â€º Upload de Imagem (JPEG) â€º Deve permitir o upload de um anexo de imagem (.jpeg) para uma transaÃ§Ã£o

    AxiosError: Request failed with status code 404

      144 |             form.append('attachment', fs.createReadStream(filePath));
      145 |
    > 146 |             const response = await axios.post(
          |                              ^
      147 |                 `${apiUrl}/transactions/${transactionId}/upload`,
      148 |                 form,
      149 |                 { headers: { ...form.getHeaders(), Authorization: `Bearer ${companyA.token}` } }

      at settle (node_modules/axios/lib/core/settle.js:19:12)
      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:793:11)
      at Axios.request (node_modules/axios/lib/core/Axios.js:45:41)
      at Object.<anonymous> (Testes/2-features/uploads.test.js:146:30)

  â— Feature: Uploads â€º Upload de Imagem (JPEG) â€º Deve permitir a exclusÃ£o de um anexo de imagem (.jpeg)

    expect(received).toBeDefined()

    Received: undefined

      160 |
      161 |         it(`Deve permitir a exclusÃ£o de um anexo de imagem (.${extension})`, async () => {
    > 162 |             expect(attachmentPath).toBeDefined();
          |                                    ^
      163 |             const response = await axios.delete(
      164 |                 `${apiUrl}/transactions/${transactionId}/upload`,
      165 |                 { headers: { Authorization: `Bearer ${companyA.token}` } }

      at Object.toBeDefined (Testes/2-features/uploads.test.js:162:36)

Test Suites: 1 failed, 3 passed, 4 total
Tests:       8 failed, 15 passed, 23 total
Snapshots:   0 total
Time:        2.128 s
Ran all test suites matching Testes/2-features/.

--- ðŸ§¹ [GLOBAL TEARDOWN] Finalizando ambiente de teste ---
[LOG] AÃ§Ã£o: DELETE_TRANSACTION | UsuÃ¡rio: 69165cb30952800e47e68c0d
   - [OK] Dados de teste temporÃ¡rios foram removidos.
âœ… Servidor e conexÃ£o com MongoDB encerrados (stopServer).
--- âœ… [GLOBAL TEARDOWN] Ambiente finalizado com sucesso ---

--- FIM DOS TESTES AUTOMATIZADOS (Status: Falha) ---
