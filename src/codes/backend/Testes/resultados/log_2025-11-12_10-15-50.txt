
--- ğŸš€ [ETAPA 1 de 4] Iniciando Ambiente de Teste (Jest Environment) ---
   - [PROCESSO] Lendo configuraÃ§Ã£o do banco de dados de teste...
   - [ATENÃ‡ÃƒO] Usando banco de dados de DESENVOLVIMENTO para os testes. As coleÃ§Ãµes serÃ£o limpas.

--- ğŸš€ [ETAPA 2 de 4] Limpando e populando o banco de dados de TESTE ---
   - [OK] Dados de teste (empresas e usuÃ¡rios) criados e salvos em test-setup.json.
(node:16816) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)

--- ğŸ§¹ [ENV] Desconectando do banco de dados ---
--- âœ… [ENV] Ambiente de teste finalizado ---
 FAIL  Testes/2-features/goals.test.js
  5. MÃ³dulo de Metas (CRUD)
    Ã— deve CRIAR uma nova meta com sucesso (110 ms)
    Ã— deve LISTAR as metas do usuÃ¡rio logado (1 ms)
    Ã— deve ATUALIZAR uma meta existente (1 ms)
    Ã— deve EXCLUIR uma meta existente (1 ms)

  â— 5. MÃ³dulo de Metas (CRUD) â€º deve CRIAR uma nova meta com sucesso

    expect(received).toBe(expected) // Object.is equality

    Expected: 201
    Received: 200

      29 |         });
      30 |
    > 31 |         expect(response.status).toBe(201);
         |                                 ^
      32 |         expect(response.data.data).toHaveProperty('_id');
      33 |         expect(response.data.data.title).toBe(goalData.title);
      34 |         expect(response.data.data.targetAmount).toBe(goalData.targetAmount);

      at Object.<anonymous> (Testes/2-features/goals.test.js:31:33)

  â— 5. MÃ³dulo de Metas (CRUD) â€º deve LISTAR as metas do usuÃ¡rio logado

    expect(received).toBeDefined()

    Received: undefined

      38 |
      39 |     it('deve LISTAR as metas do usuÃ¡rio logado', async () => {
    > 40 |         expect(createdGoalId).toBeDefined();
         |                               ^
      41 |
      42 |         const response = await axios.get(`${API_URL}/goals`, {
      43 |             headers: { Authorization: `Bearer ${userToken}` }

      at Object.<anonymous> (Testes/2-features/goals.test.js:40:31)

  â— 5. MÃ³dulo de Metas (CRUD) â€º deve ATUALIZAR uma meta existente

    expect(received).toBeDefined()

    Received: undefined

      51 |
      52 |     it('deve ATUALIZAR uma meta existente', async () => {
    > 53 |         expect(createdGoalId).toBeDefined();
         |                               ^
      54 |
      55 |         const updatedData = {
      56 |             title: 'Economizar para novo maquinÃ¡rio (URGENTE)',

      at Object.<anonymous> (Testes/2-features/goals.test.js:53:31)

  â— 5. MÃ³dulo de Metas (CRUD) â€º deve EXCLUIR uma meta existente

    expect(received).toBeDefined()

    Received: undefined

      68 |
      69 |     it('deve EXCLUIR uma meta existente', async () => {
    > 70 |         expect(createdGoalId).toBeDefined();
         |                               ^
      71 |
      72 |         const response = await axios.delete(`${API_URL}/goals/${createdGoalId}`, {
      73 |             headers: { Authorization: `Bearer ${userToken}` }

      at Object.<anonymous> (Testes/2-features/goals.test.js:70:31)


--- ğŸš€ [ETAPA 1 de 4] Iniciando Ambiente de Teste (Jest Environment) ---
   - [PROCESSO] Lendo configuraÃ§Ã£o do banco de dados de teste...
   - [ATENÃ‡ÃƒO] Usando banco de dados de DESENVOLVIMENTO para os testes. As coleÃ§Ãµes serÃ£o limpas.

--- ğŸš€ [ETAPA 2 de 4] Limpando e populando o banco de dados de TESTE ---
   - [OK] Dados de teste (empresas e usuÃ¡rios) criados e salvos em test-setup.json.
  console.log
    
    --- Configurando 3 empresas para o teste multi-tenant ---

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:19:17)

  console.log
    âœ… Empresa 1 (Empresa Teste 1762953353918) cadastrada e logada.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:48:21)

  console.log
    âœ… Empresa 2 (Empresa Teste 1762953354206) cadastrada e logada.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:48:21)

  console.log
    âœ… Empresa 3 (Empresa Teste 1762953354452) cadastrada e logada.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:48:21)

  console.log
    --- ConfiguraÃ§Ã£o multi-tenant concluÃ­da ---

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:50:17)

  console.log
    
    --- Criando transaÃ§Ãµes individuais para cada empresa ---

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:55:17)

  console.log
    TransaÃ§Ã£o criada para Empresa Teste 1762953353918. ID: 6914888a4d43a814718026e7

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:76:21)

  console.log
    TransaÃ§Ã£o criada para Empresa Teste 1762953354206. ID: 6914888a4d43a814718026ee

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:76:21)

  console.log
    TransaÃ§Ã£o criada para Empresa Teste 1762953354452. ID: 6914888a4d43a814718026f5

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:76:21)

  console.log
    
    --- Validando isolamento de dados entre todas as empresas ---

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:82:17)

  console.log
    
    Verificando a transaÃ§Ã£o 6914888a4d43a814718026e7 da Empresa Teste 1762953353918

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:89:21)

  console.log
    - OK: Empresa Teste 1762953354206 foi bloqueada (Status 404).

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:107:29)

  console.log
    - OK: Empresa Teste 1762953354452 foi bloqueada (Status 404).

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:107:29)

  console.log
    
    Verificando a transaÃ§Ã£o 6914888a4d43a814718026ee da Empresa Teste 1762953354206

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:89:21)

  console.log
    - OK: Empresa Teste 1762953353918 foi bloqueada (Status 404).

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:107:29)

  console.log
    - OK: Empresa Teste 1762953354452 foi bloqueada (Status 404).

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:107:29)

  console.log
    
    Verificando a transaÃ§Ã£o 6914888a4d43a814718026f5 da Empresa Teste 1762953354452

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:89:21)

  console.log
    - OK: Empresa Teste 1762953353918 foi bloqueada (Status 404).

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:107:29)

  console.log
    - OK: Empresa Teste 1762953354206 foi bloqueada (Status 404).

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:107:29)

  console.log
    
    --- Validando listagem de transaÃ§Ãµes ---

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:114:17)

  console.log
    - OK: Empresa Teste 1762953353918 listou apenas sua prÃ³pria transaÃ§Ã£o.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:126:21)

  console.log
    - OK: Empresa Teste 1762953354206 listou apenas sua prÃ³pria transaÃ§Ã£o.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:126:21)

  console.log
    - OK: Empresa Teste 1762953354452 listou apenas sua prÃ³pria transaÃ§Ã£o.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:126:21)

  console.log
    
    --- Limpando dados de teste (Teardown) ---

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:132:17)

  console.log
    - âœ… Empresa Empresa Teste 1762953353918 e dados associados excluÃ­dos com sucesso.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:139:25)

  console.log
    - âœ… Empresa Empresa Teste 1762953354206 e dados associados excluÃ­dos com sucesso.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:139:25)

  console.log
    - âœ… Empresa Empresa Teste 1762953354452 e dados associados excluÃ­dos com sucesso.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:139:25)


--- ğŸ§¹ [ENV] Desconectando do banco de dados ---
--- âœ… [ENV] Ambiente de teste finalizado ---
 PASS  Testes/3-security/multi-tenant.test.js
  3. Teste de Isolamento de Dados em Larga Escala (Multi-Tenant)
    âˆš deve criar uma transaÃ§Ã£o para cada empresa (161 ms)
    âˆš deve impedir que uma empresa acesse a transaÃ§Ã£o de outra (179 ms)
    âˆš deve garantir que cada empresa liste apenas suas prÃ³prias transaÃ§Ãµes (91 ms)


--- ğŸš€ [ETAPA 1 de 4] Iniciando Ambiente de Teste (Jest Environment) ---
   - [PROCESSO] Lendo configuraÃ§Ã£o do banco de dados de teste...
   - [ATENÃ‡ÃƒO] Usando banco de dados de DESENVOLVIMENTO para os testes. As coleÃ§Ãµes serÃ£o limpas.

--- ğŸš€ [ETAPA 2 de 4] Limpando e populando o banco de dados de TESTE ---
   - [OK] Dados de teste (empresas e usuÃ¡rios) criados e salvos em test-setup.json.
  console.log
    
    --- Teste: Solicitar reset para e-mail invÃ¡lido ---

      at Object.<anonymous> (Testes/1-auth/password.test.js:50:13)

  console.log
    âœ… Falhou como esperado para e-mail inexistente (Status 404).

      at Object.<anonymous> (Testes/1-auth/password.test.js:59:15)

  console.log
    
    --- Teste: Gerar token de reset com sucesso ---

      at Object.<anonymous> (Testes/1-auth/password.test.js:64:13)

  console.log
    âœ… Token de reset gerado e salvo no banco de dados.

      at Object.<anonymous> (Testes/1-auth/password.test.js:76:13)

  console.log
    
    --- Teste: Resetar senha com token vÃ¡lido ---

      at Object.<anonymous> (Testes/1-auth/password.test.js:80:13)

  console.log
    âœ… Senha resetada com sucesso via API.

      at Object.<anonymous> (Testes/1-auth/password.test.js:97:13)

  console.log
    âœ… Token de reset foi invalidado no banco.

      at Object.<anonymous> (Testes/1-auth/password.test.js:102:13)

  console.log
    âœ… Login com a nova senha realizado com sucesso.

      at Object.<anonymous> (Testes/1-auth/password.test.js:112:13)


--- ğŸ§¹ [ENV] Desconectando do banco de dados ---
--- âœ… [ENV] Ambiente de teste finalizado ---
 PASS  Testes/1-auth/password.test.js
  9. MÃ³dulo de RecuperaÃ§Ã£o de Senha
    âˆš deve falhar ao solicitar reset para um e-mail inexistente (187 ms)
    âˆš deve gerar e salvar um token de reset para um e-mail vÃ¡lido (91 ms)
    âˆš deve resetar a senha com um token vÃ¡lido e permitir login com a nova senha (291 ms)


--- ğŸš€ [ETAPA 1 de 4] Iniciando Ambiente de Teste (Jest Environment) ---
   - [PROCESSO] Lendo configuraÃ§Ã£o do banco de dados de teste...
   - [ATENÃ‡ÃƒO] Usando banco de dados de DESENVOLVIMENTO para os testes. As coleÃ§Ãµes serÃ£o limpas.

--- ğŸš€ [ETAPA 2 de 4] Limpando e populando o banco de dados de TESTE ---
   - [OK] Dados de teste (empresas e usuÃ¡rios) criados e salvos em test-setup.json.

--- ğŸ§¹ [ENV] Desconectando do banco de dados ---
--- âœ… [ENV] Ambiente de teste finalizado ---
 PASS  Testes/1-auth/auth.test.js
  6. MÃ³dulo de AutenticaÃ§Ã£o e SessÃ£o (Stateful)
    âˆš deve criar um SessionToken no banco de dados apÃ³s o login (306 ms)
    âˆš deve invalidar o SessionToken no banco de dados apÃ³s o logout (152 ms)


--- ğŸš€ [ETAPA 1 de 4] Iniciando Ambiente de Teste (Jest Environment) ---
   - [PROCESSO] Lendo configuraÃ§Ã£o do banco de dados de teste...
   - [ATENÃ‡ÃƒO] Usando banco de dados de DESENVOLVIMENTO para os testes. As coleÃ§Ãµes serÃ£o limpas.

--- ğŸš€ [ETAPA 2 de 4] Limpando e populando o banco de dados de TESTE ---
   - [OK] Dados de teste (empresas e usuÃ¡rios) criados e salvos em test-setup.json.

--- ğŸ§¹ [ENV] Desconectando do banco de dados ---
--- âœ… [ENV] Ambiente de teste finalizado ---
 PASS  Testes/2-features/transactions.test.js
  4. MÃ³dulo de TransaÃ§Ãµes (CRUD)
    âˆš deve CRIAR uma nova transaÃ§Ã£o com sucesso (58 ms)
    âˆš deve falhar ao tentar criar uma transaÃ§Ã£o com dados invÃ¡lidos (25 ms)
    âˆš deve LISTAR as transaÃ§Ãµes do usuÃ¡rio logado (31 ms)
    âˆš deve OBTER uma transaÃ§Ã£o especÃ­fica pelo ID (30 ms)
    âˆš deve ATUALIZAR uma transaÃ§Ã£o existente (59 ms)
    âˆš deve EXCLUIR uma transaÃ§Ã£o existente (80 ms)


--- ğŸš€ [ETAPA 1 de 4] Iniciando Ambiente de Teste (Jest Environment) ---
   - [PROCESSO] Lendo configuraÃ§Ã£o do banco de dados de teste...
   - [ATENÃ‡ÃƒO] Usando banco de dados de DESENVOLVIMENTO para os testes. As coleÃ§Ãµes serÃ£o limpas.

--- ğŸš€ [ETAPA 2 de 4] Limpando e populando o banco de dados de TESTE ---
   - [OK] Dados de teste (empresas e usuÃ¡rios) criados e salvos em test-setup.json.
  console.log
    â¡ï¸  [PASS] Resposta da API: 200, PDF recebido com 2329 bytes e salvo em: F:\Programacao\GitHub\pbr-si-2025-2-p3-tiapn-t1-9147100-smart-gestao\src\codes\backend\Testes\PDFs\pdf_teste_2025-11-12_10-16-01.pdf

      at Object.<anonymous> (Testes/4-reports/reports.test.js:57:13)


--- ğŸ§¹ [ENV] Desconectando do banco de dados ---
--- âœ… [ENV] Ambiente de teste finalizado ---
 PASS  Testes/4-reports/reports.test.js
  8. MÃ³dulo de RelatÃ³rios
    âˆš deve EXPORTAR um relatÃ³rio de transaÃ§Ãµes em formato PDF (81 ms)


--- ğŸš€ [ETAPA 1 de 4] Iniciando Ambiente de Teste (Jest Environment) ---
   - [PROCESSO] Lendo configuraÃ§Ã£o do banco de dados de teste...
   - [ATENÃ‡ÃƒO] Usando banco de dados de DESENVOLVIMENTO para os testes. As coleÃ§Ãµes serÃ£o limpas.

--- ğŸš€ [ETAPA 2 de 4] Limpando e populando o banco de dados de TESTE ---
   - [OK] Dados de teste (empresas e usuÃ¡rios) criados e salvos em test-setup.json.

--- ğŸ§¹ [ENV] Desconectando do banco de dados ---
--- âœ… [ENV] Ambiente de teste finalizado ---
 FAIL  Testes/2-features/clients.test.js
  â— Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (node_modules/@jest/core/build/index.js:1057:18)
      at node_modules/@jest/core/build/index.js:1127:165
      at node_modules/emittery/index.js:363:13
          at Array.map (<anonymous>)
      at Emittery.emit (node_modules/emittery/index.js:361:23)

Test Suites: 2 failed, 5 passed, 7 total
Tests:       4 failed, 15 passed, 19 total
Snapshots:   0 total
Time:        10.306 s
Ran all test suites.

--- FIM DOS TESTES AUTOMATIZADOS (Status: Falha) ---
