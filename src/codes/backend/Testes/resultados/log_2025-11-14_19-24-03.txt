
--- üöÄ [GLOBAL SETUP] Iniciando ambiente de teste ---
Verificando permiss√µes de sistema...
Permiss√µes n√£o encontradas. Criando permiss√µes padr√£o...
Permiss√µes padr√£o criadas com sucesso!
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ (index) ‚îÇ Nome            ‚îÇ Descri√ß√£o                                                                                        ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ 0       ‚îÇ 'ROOT'          ‚îÇ 'Superusu√°rio. Acesso irrestrito a todos os dados e configura√ß√µes do sistema.'                   ‚îÇ
‚îÇ 1       ‚îÇ 'ADMIN_COMPANY' ‚îÇ 'Administrador de uma empresa. Pode gerenciar usu√°rios e todos os dados da sua pr√≥pria empresa.' ‚îÇ
‚îÇ 2       ‚îÇ 'USER_COMPANY'  ‚îÇ 'Usu√°rio padr√£o. Pode criar e gerenciar seus pr√≥prios dados dentro da empresa.'                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚è≥ Iniciando servidor Smart Gest√£o (startServer)...
Conex√£o com o MongoDB estabelecida com sucesso.
‚úÖ [1/1] Conex√£o com o banco de dados estabelecida!
‚úÖ Servidor rodando na porta 5000
--- ‚úÖ [GLOBAL SETUP] Ambiente pronto e servidor iniciado ---
(node:27084) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
[0mPOST /api/auth/login [32m200[0m 118.802 ms - 688[0m
[LOG] A√ß√£o: LOGIN_USER | Usu√°rio: N/A
[0mPOST /api/auth/login [32m200[0m 117.300 ms - 688[0m
[LOG] A√ß√£o: LOGIN_USER | Usu√°rio: N/A
[0mPOST /api/auth/logout [32m200[0m 18.992 ms - 108[0m
PASS Testes/1-auth/auth.test.js
  6. M√≥dulo de Autentica√ß√£o e Sess√£o (Stateful)
    ‚àö deve criar um SessionToken no banco de dados ap√≥s o login (170 ms)
    ‚àö deve invalidar o SessionToken no banco de dados ap√≥s o logout (148 ms)

  console.log
    
    --- Teste: Solicitar reset para e-mail inv√°lido ---

      at Object.log (Testes/1-auth/password.test.js:25:13)

[LOG] A√ß√£o: LOGOUT_USER | Usu√°rio: N/A
[0mPOST /api/auth/forgot-password [33m404[0m 13.928 ms - 69[0m
  console.log
    ‚úÖ Falhou como esperado para e-mail inexistente (Status 404).

      at Object.log (Testes/1-auth/password.test.js:34:15)

  console.log
    
    --- Teste: Gerar token de reset com sucesso ---

      at Object.log (Testes/1-auth/password.test.js:39:13)

[0mPOST /api/auth/forgot-password [32m200[0m 32.513 ms - 164[0m
  console.log
    ‚úÖ Token de reset gerado e salvo no banco de dados.

      at Object.log (Testes/1-auth/password.test.js:49:13)

  console.log
    
    --- Teste: Resetar senha com token v√°lido ---

      at Object.log (Testes/1-auth/password.test.js:53:13)

[0mPOST /api/auth/forgot-password [32m200[0m 29.116 ms - 164[0m
[0mPOST /api/auth/reset-password/4fc380aba00b8de61f593d649c873e518c1f9c292a640c13a0211aca37f7c9cf [32m200[0m 118.192 ms - 68[0m
  console.log
    ‚úÖ Senha resetada com sucesso via API.

      at Object.log (Testes/1-auth/password.test.js:70:13)

[0mPOST /api/auth/reset-password/4fc380aba00b8de61f593d649c873e518c1f9c292a640c13a0211aca37f7c9cf [33m400[0m 13.438 ms - 72[0m
  console.log
    ‚úÖ Token de reset foi invalidado no banco.

      at Object.log (Testes/1-auth/password.test.js:74:13)

[0mPOST /api/auth/login [32m200[0m 104.392 ms - 688[0m
  console.log
    ‚úÖ Login com a nova senha realizado com sucesso.

      at Object.log (Testes/1-auth/password.test.js:84:13)

PASS Testes/1-auth/password.test.js
  9. M√≥dulo de Recupera√ß√£o de Senha
    ‚àö deve falhar ao solicitar reset para um e-mail inexistente (56 ms)
    ‚àö deve gerar e salvar um token de reset para um e-mail v√°lido (40 ms)
    ‚àö deve resetar a senha com um token v√°lido e permitir login com a nova senha (284 ms)

[LOG] A√ß√£o: LOGIN_USER | Usu√°rio: N/A
[0mPOST /api/clients [32m201[0m 32.399 ms - 329[0m
[LOG] A√ß√£o: CREATE_CLIENT | Usu√°rio: 6917ac078c05736fb0ef492e
[0mGET /api/clients [32m200[0m 29.973 ms - 573[0m
[0mPUT /api/clients/6917ac098c05736fb0ef495b [32m200[0m 44.070 ms - 331[0m
[LOG] A√ß√£o: UPDATE_CLIENT | Usu√°rio: 6917ac078c05736fb0ef492e
[0mDELETE /api/clients/6917ac098c05736fb0ef495b [32m200[0m 42.672 ms - 70[0m
PASS Testes/2-features/clients.test.js
  7. M√≥dulo de Clientes/Fornecedores
    ‚àö deve CRIAR um novo cliente com sucesso (47 ms)
    ‚àö deve LISTAR os clientes da empresa (33 ms)
    ‚àö deve ATUALIZAR um cliente existente (50 ms)
    ‚àö deve EXCLUIR um cliente existente (49 ms)

[LOG] A√ß√£o: DELETE_CLIENT | Usu√°rio: 6917ac078c05736fb0ef492e
[LOG] A√ß√£o: CREATE_META | Usu√°rio: 6917ac078c05736fb0ef492e
[0mPOST /api/goals [32m201[0m 50.244 ms - 404[0m
[LOG] A√ß√£o: CREATE_GOAL | Usu√°rio: 6917ac078c05736fb0ef492e
[0mGET /api/goals [32m200[0m 27.999 ms - 406[0m
[LOG] A√ß√£o: UPDATE_META | Usu√°rio: 6917ac078c05736fb0ef492e
[0mPUT /api/goals/6917ac0a8c05736fb0ef496c [32m200[0m 62.634 ms - 414[0m
[LOG] A√ß√£o: UPDATE_GOAL | Usu√°rio: 6917ac078c05736fb0ef492e
[LOG] A√ß√£o: DELETE_META | Usu√°rio: 6917ac078c05736fb0ef492e
[0mDELETE /api/goals/6917ac0a8c05736fb0ef496c [32m200[0m 58.066 ms - 67[0m
[LOG] A√ß√£o: DELETE_GOAL | Usu√°rio: 6917ac078c05736fb0ef492e
[0mGET /api/goals/null [33m404[0m 13.756 ms - 53[0m
PASS Testes/2-features/goals.test.js
  5. M√≥dulo de Metas (CRUD)
    ‚àö deve CRIAR uma nova meta com sucesso (75 ms)
    ‚àö deve LISTAR as metas do usu√°rio logado (36 ms)
    ‚àö deve ATUALIZAR uma meta existente (67 ms)
    ‚àö deve EXCLUIR uma meta existente (89 ms)

[LOG] A√ß√£o: CREATE_TRANSACTION | Usu√°rio: 6917ac078c05736fb0ef492e
[0mPOST /api/transactions [32m201[0m 46.991 ms - 468[0m
[LOG] A√ß√£o: CREATE_TRANSACTION | Usu√°rio: 6917ac078c05736fb0ef492e
[0mPOST /api/transactions [33m400[0m 15.366 ms - 277[0m
[LOG] A√ß√£o: CREATE_TRANSACTION | Usu√°rio: 6917ac078c05736fb0ef492e
[0mGET /api/transactions [32m200[0m 26.157 ms - 855[0m
[0mGET /api/transactions/6917ac0a8c05736fb0ef4984 [32m200[0m 38.153 ms - 452[0m
[LOG] A√ß√£o: UPDATE_TRANSACTION | Usu√°rio: 6917ac078c05736fb0ef492e
[0mPUT /api/transactions/6917ac0a8c05736fb0ef4984 [32m200[0m 60.023 ms - 452[0m
[LOG] A√ß√£o: UPDATE_TRANSACTION | Usu√°rio: 6917ac078c05736fb0ef492e
[LOG] A√ß√£o: DELETE_TRANSACTION | Usu√°rio: 6917ac078c05736fb0ef492e
[0mDELETE /api/transactions/6917ac0a8c05736fb0ef4984 [32m200[0m 61.538 ms - 73[0m
[LOG] A√ß√£o: DELETE_TRANSACTION | Usu√°rio: 6917ac078c05736fb0ef492e
[0mGET /api/transactions/6917ac0a8c05736fb0ef4984 [33m404[0m 42.171 ms - 71[0m
PASS Testes/2-features/transactions.test.js
  4. M√≥dulo de Transa√ß√µes (CRUD)
    ‚àö deve CRIAR uma nova transa√ß√£o com sucesso (61 ms)
    ‚àö deve falhar ao tentar criar uma transa√ß√£o com dados inv√°lidos (31 ms)
    ‚àö deve LISTAR as transa√ß√µes do usu√°rio logado (31 ms)
    ‚àö deve OBTER uma transa√ß√£o espec√≠fica pelo ID (42 ms)
    ‚àö deve ATUALIZAR uma transa√ß√£o existente (66 ms)
    ‚àö deve EXCLUIR uma transa√ß√£o existente (112 ms)

[LOG] A√ß√£o: CREATE_TRANSACTION | Usu√°rio: 6917ac078c05736fb0ef492e
[0mPOST /api/transactions [32m201[0m 48.209 ms - 446[0m
[LOG] A√ß√£o: CREATE_TRANSACTION | Usu√°rio: 6917ac078c05736fb0ef492e
[0mPOST /api/transactions/6917ac0b8c05736fb0ef49a5/upload [32m200[0m 71.338 ms - 513[0m
[LOG] A√ß√£o: UPLOAD_ATTACHMENT | Usu√°rio: 6917ac078c05736fb0ef492e
[0mDELETE /api/transactions/6917ac0b8c05736fb0ef49a5/upload [32m200[0m 58.304 ms - 442[0m
[LOG] A√ß√£o: DELETE_ATTACHMENT | Usu√°rio: 6917ac078c05736fb0ef492e
[LOG] A√ß√£o: DELETE_TRANSACTION | Usu√°rio: 6917ac078c05736fb0ef492e
[0mDELETE /api/transactions/6917ac0b8c05736fb0ef49a5 [32m200[0m 57.516 ms - 73[0m
[LOG] A√ß√£o: DELETE_TRANSACTION | Usu√°rio: 6917ac078c05736fb0ef492e
[LOG] A√ß√£o: CREATE_TRANSACTION | Usu√°rio: 6917ac078c05736fb0ef492e
[0mPOST /api/transactions [32m201[0m 45.675 ms - 444[0m
[LOG] A√ß√£o: CREATE_TRANSACTION | Usu√°rio: 6917ac078c05736fb0ef492e
[0mPOST /api/transactions/6917ac0b8c05736fb0ef49bf/upload [32m200[0m 56.352 ms - 511[0m
[LOG] A√ß√£o: UPLOAD_ATTACHMENT | Usu√°rio: 6917ac078c05736fb0ef492e
[0mDELETE /api/transactions/6917ac0b8c05736fb0ef49bf/upload [32m200[0m 56.473 ms - 440[0m
[LOG] A√ß√£o: DELETE_ATTACHMENT | Usu√°rio: 6917ac078c05736fb0ef492e
[LOG] A√ß√£o: DELETE_TRANSACTION | Usu√°rio: 6917ac078c05736fb0ef492e
[0mDELETE /api/transactions/6917ac0b8c05736fb0ef49bf [32m200[0m 59.617 ms - 73[0m
[LOG] A√ß√£o: DELETE_TRANSACTION | Usu√°rio: 6917ac078c05736fb0ef492e
[LOG] A√ß√£o: CREATE_TRANSACTION | Usu√°rio: 6917ac078c05736fb0ef492e
[0mPOST /api/transactions [32m201[0m 45.888 ms - 444[0m
[LOG] A√ß√£o: CREATE_TRANSACTION | Usu√°rio: 6917ac078c05736fb0ef492e
[0mPOST /api/transactions/6917ac0b8c05736fb0ef49d9/upload [32m200[0m 57.132 ms - 512[0m
[LOG] A√ß√£o: UPLOAD_ATTACHMENT | Usu√°rio: 6917ac078c05736fb0ef492e
[0mDELETE /api/transactions/6917ac0b8c05736fb0ef49d9/upload [32m200[0m 54.822 ms - 440[0m
[LOG] A√ß√£o: DELETE_ATTACHMENT | Usu√°rio: 6917ac078c05736fb0ef492e
[LOG] A√ß√£o: DELETE_TRANSACTION | Usu√°rio: 6917ac078c05736fb0ef492e
[0mDELETE /api/transactions/6917ac0b8c05736fb0ef49d9 [32m200[0m 58.184 ms - 73[0m
[LOG] A√ß√£o: DELETE_TRANSACTION | Usu√°rio: 6917ac078c05736fb0ef492e
[LOG] A√ß√£o: CREATE_TRANSACTION | Usu√°rio: 6917ac078c05736fb0ef492e
[0mPOST /api/transactions [32m201[0m 50.667 ms - 445[0m
[LOG] A√ß√£o: CREATE_TRANSACTION | Usu√°rio: 6917ac078c05736fb0ef492e
[0mPOST /api/transactions/6917ac0c8c05736fb0ef49f3/upload [32m200[0m 56.498 ms - 514[0m
[LOG] A√ß√£o: UPLOAD_ATTACHMENT | Usu√°rio: 6917ac078c05736fb0ef492e
[0mDELETE /api/transactions/6917ac0c8c05736fb0ef49f3/upload [32m200[0m 55.054 ms - 441[0m
[LOG] A√ß√£o: DELETE_ATTACHMENT | Usu√°rio: 6917ac078c05736fb0ef492e
[LOG] A√ß√£o: DELETE_TRANSACTION | Usu√°rio: 6917ac078c05736fb0ef492e
[0mDELETE /api/transactions/6917ac0c8c05736fb0ef49f3 [32m200[0m 58.179 ms - 73[0m
[LOG] A√ß√£o: DELETE_TRANSACTION | Usu√°rio: 6917ac078c05736fb0ef492e
[0mPOST /api/transactions/60d5f1f77c3d4a001f5e8e1z/upload [33m404[0m 14.072 ms - 53[0m
PASS Testes/2-features/uploads.test.js
  Feature: Uploads
    Upload de PDF
      ‚àö Deve permitir o upload de um anexo (PDF) para uma transa√ß√£o (85 ms)
      ‚àö Deve permitir a exclus√£o de um anexo (PDF) de uma transa√ß√£o (63 ms)
    Upload de Imagem (PNG)
      ‚àö Deve permitir o upload de um anexo de imagem (.png) para uma transa√ß√£o (62 ms)
      ‚àö Deve permitir a exclus√£o de um anexo de imagem (.png) (62 ms)
    Upload de Imagem (JPG)
      ‚àö Deve permitir o upload de um anexo de imagem (.jpg) para uma transa√ß√£o (62 ms)
      ‚àö Deve permitir a exclus√£o de um anexo de imagem (.jpg) (59 ms)
    Upload de Imagem (JPEG)
      ‚àö Deve permitir o upload de um anexo de imagem (.jpeg) para uma transa√ß√£o (61 ms)
      ‚àö Deve permitir a exclus√£o de um anexo de imagem (.jpeg) (59 ms)
    Cen√°rios de Erro e Estruturais
      ‚àö Deve retornar 404 ao tentar fazer upload para uma transa√ß√£o inexistente (33 ms)

  console.log
    
    --- Configurando 3 empresas para o teste multi-tenant ---

      at Object.log (Testes/3-security/multi-tenant.test.js:35:17)

[0mPOST /api/auth/register [32m201[0m 231.006 ms - 355[0m
[LOG] A√ß√£o: REGISTER_COMPANY_USER | Usu√°rio: N/A
[0mPOST /api/auth/login [32m200[0m 210.763 ms - 698[0m
  console.log
    ‚úÖ Empresa 1 (Empresa Teste 1763159052591) cadastrada e logada.

      at Object.log (Testes/3-security/multi-tenant.test.js:64:21)

[LOG] A√ß√£o: LOGIN_USER | Usu√°rio: N/A
[0mPOST /api/auth/register [32m201[0m 159.948 ms - 355[0m
[LOG] A√ß√£o: REGISTER_COMPANY_USER | Usu√°rio: N/A
[0mPOST /api/auth/login [32m200[0m 171.388 ms - 698[0m
  console.log
    ‚úÖ Empresa 2 (Empresa Teste 1763159053050) cadastrada e logada.

      at Object.log (Testes/3-security/multi-tenant.test.js:64:21)

[LOG] A√ß√£o: LOGIN_USER | Usu√°rio: N/A
[0mPOST /api/auth/register [32m201[0m 163.743 ms - 355[0m
[LOG] A√ß√£o: REGISTER_COMPANY_USER | Usu√°rio: N/A
[0mPOST /api/auth/login [32m200[0m 140.694 ms - 698[0m
  console.log
    ‚úÖ Empresa 3 (Empresa Teste 1763159053397) cadastrada e logada.

      at Object.log (Testes/3-security/multi-tenant.test.js:64:21)

  console.log
    --- Configura√ß√£o multi-tenant conclu√≠da ---

      at Object.log (Testes/3-security/multi-tenant.test.js:66:17)

  console.log
    
    --- Criando transa√ß√µes individuais para cada empresa ---

      at Object.log (Testes/3-security/multi-tenant.test.js:71:17)

[LOG] A√ß√£o: LOGIN_USER | Usu√°rio: N/A
[LOG] A√ß√£o: CREATE_TRANSACTION | Usu√°rio: 6917ac0c8c05736fb0ef4a12
[0mPOST /api/transactions [32m201[0m 45.110 ms - 437[0m
  console.log
    Transa√ß√£o criada para Empresa Teste 1763159052591. ID: 6917ac0d8c05736fb0ef4a38

      at Object.log (Testes/3-security/multi-tenant.test.js:92:21)

[LOG] A√ß√£o: CREATE_TRANSACTION | Usu√°rio: 6917ac0c8c05736fb0ef4a12
[LOG] A√ß√£o: CREATE_TRANSACTION | Usu√°rio: 6917ac0d8c05736fb0ef4a20
[0mPOST /api/transactions [32m201[0m 45.400 ms - 436[0m
  console.log
    Transa√ß√£o criada para Empresa Teste 1763159053050. ID: 6917ac0d8c05736fb0ef4a3f

      at Object.log (Testes/3-security/multi-tenant.test.js:92:21)

[LOG] A√ß√£o: CREATE_TRANSACTION | Usu√°rio: 6917ac0d8c05736fb0ef4a20
[LOG] A√ß√£o: CREATE_TRANSACTION | Usu√°rio: 6917ac0d8c05736fb0ef4a2e
[0mPOST /api/transactions [32m201[0m 44.574 ms - 429[0m
  console.log
    Transa√ß√£o criada para Empresa Teste 1763159053397. ID: 6917ac0d8c05736fb0ef4a46

      at Object.log (Testes/3-security/multi-tenant.test.js:92:21)

  console.log
    
    --- Validando isolamento de dados entre todas as empresas ---

      at Object.log (Testes/3-security/multi-tenant.test.js:98:17)

  console.log
    
    Verificando a transa√ß√£o 6917ac0d8c05736fb0ef4a38 da Empresa Teste 1763159052591

      at Object.log (Testes/3-security/multi-tenant.test.js:105:21)

[LOG] A√ß√£o: CREATE_TRANSACTION | Usu√°rio: 6917ac0d8c05736fb0ef4a2e
[0mGET /api/transactions/6917ac0d8c05736fb0ef4a38 [33m404[0m 25.948 ms - 38[0m
  console.log
    - OK: Empresa Teste 1763159053050 foi bloqueada (Status 404).

      at Object.log (Testes/3-security/multi-tenant.test.js:123:29)

[0mGET /api/transactions/6917ac0d8c05736fb0ef4a38 [33m404[0m 25.482 ms - 38[0m
  console.log
    - OK: Empresa Teste 1763159053397 foi bloqueada (Status 404).

      at Object.log (Testes/3-security/multi-tenant.test.js:123:29)

  console.log
    
    Verificando a transa√ß√£o 6917ac0d8c05736fb0ef4a3f da Empresa Teste 1763159053050

      at Object.log (Testes/3-security/multi-tenant.test.js:105:21)

[0mGET /api/transactions/6917ac0d8c05736fb0ef4a3f [33m404[0m 25.505 ms - 38[0m
  console.log
    - OK: Empresa Teste 1763159052591 foi bloqueada (Status 404).

      at Object.log (Testes/3-security/multi-tenant.test.js:123:29)

[0mGET /api/transactions/6917ac0d8c05736fb0ef4a3f [33m404[0m 25.518 ms - 38[0m
  console.log
    - OK: Empresa Teste 1763159053397 foi bloqueada (Status 404).

      at Object.log (Testes/3-security/multi-tenant.test.js:123:29)

  console.log
    
    Verificando a transa√ß√£o 6917ac0d8c05736fb0ef4a46 da Empresa Teste 1763159053397

      at Object.log (Testes/3-security/multi-tenant.test.js:105:21)

[0mGET /api/transactions/6917ac0d8c05736fb0ef4a46 [33m404[0m 25.784 ms - 38[0m
  console.log
    - OK: Empresa Teste 1763159052591 foi bloqueada (Status 404).

      at Object.log (Testes/3-security/multi-tenant.test.js:123:29)

[0mGET /api/transactions/6917ac0d8c05736fb0ef4a46 [33m404[0m 25.541 ms - 38[0m
  console.log
    - OK: Empresa Teste 1763159053050 foi bloqueada (Status 404).

      at Object.log (Testes/3-security/multi-tenant.test.js:123:29)

  console.log
    
    --- Validando listagem de transa√ß√µes ---

      at Object.log (Testes/3-security/multi-tenant.test.js:130:17)

[0mGET /api/transactions [32m200[0m 26.637 ms - 423[0m
  console.log
    - OK: Empresa Teste 1763159052591 listou apenas sua pr√≥pria transa√ß√£o.

      at Object.log (Testes/3-security/multi-tenant.test.js:142:21)

[0mGET /api/transactions [32m200[0m 26.983 ms - 422[0m
  console.log
    - OK: Empresa Teste 1763159053050 listou apenas sua pr√≥pria transa√ß√£o.

      at Object.log (Testes/3-security/multi-tenant.test.js:142:21)

[0mGET /api/transactions [32m200[0m 39.324 ms - 415[0m
  console.log
    - OK: Empresa Teste 1763159053397 listou apenas sua pr√≥pria transa√ß√£o.

      at Object.log (Testes/3-security/multi-tenant.test.js:142:21)

  console.log
    
    --- Limpando dados de teste (Teardown) ---

      at Object.log (Testes/3-security/multi-tenant.test.js:148:17)

[0mDELETE /api/auth/users/6917ac0c8c05736fb0ef4a12 [32m200[0m 73.160 ms - 107[0m
  console.log
    - ‚úÖ Empresa Empresa Teste 1763159052591 e dados associados exclu√≠dos com sucesso.

      at Object.log (Testes/3-security/multi-tenant.test.js:155:25)

[LOG] A√ß√£o: DELETE_USER_BY_ID | Usu√°rio: 6917ac0c8c05736fb0ef4a12
[0mDELETE /api/auth/users/6917ac0d8c05736fb0ef4a20 [32m200[0m 74.262 ms - 107[0m
  console.log
    - ‚úÖ Empresa Empresa Teste 1763159053050 e dados associados exclu√≠dos com sucesso.

      at Object.log (Testes/3-security/multi-tenant.test.js:155:25)

[LOG] A√ß√£o: DELETE_USER_BY_ID | Usu√°rio: 6917ac0d8c05736fb0ef4a20
[0mDELETE /api/auth/users/6917ac0d8c05736fb0ef4a2e [32m200[0m 72.746 ms - 107[0m
PASS Testes/3-security/multi-tenant.test.js
  3. Teste de Isolamento de Dados (Multi-Tenant)
    ‚àö deve criar uma transa√ß√£o para cada empresa (156 ms)
    ‚àö deve impedir que uma empresa acesse a transa√ß√£o de outra (194 ms)
    ‚àö deve garantir que cada empresa liste apenas suas pr√≥prias transa√ß√µes (106 ms)

  console.log
    - ‚úÖ Empresa Empresa Teste 1763159053397 e dados associados exclu√≠dos com sucesso.

      at Object.log (Testes/3-security/multi-tenant.test.js:155:25)

[LOG] A√ß√£o: DELETE_USER_BY_ID | Usu√°rio: 6917ac0d8c05736fb0ef4a2e
[0mPOST /api/auth/register [32m201[0m 192.194 ms - 357[0m
[LOG] A√ß√£o: REGISTER_COMPANY_USER | Usu√°rio: N/A
[0mPOST /api/auth/login [32m200[0m 117.378 ms - 700[0m
[LOG] A√ß√£o: LOGIN_USER | Usu√°rio: N/A
[0mPOST /api/auth/register [32m201[0m 155.813 ms - 355[0m
[LOG] A√ß√£o: REGISTER_COMPANY_USER | Usu√°rio: N/A
[0mPOST /api/auth/login [32m200[0m 105.854 ms - 698[0m
[LOG] A√ß√£o: LOGIN_USER | Usu√°rio: N/A
[0mPOST /api/auth/register [32m201[0m 151.854 ms - 351[0m
[LOG] A√ß√£o: REGISTER_COMPANY_USER | Usu√°rio: N/A
[0mPOST /api/auth/login [32m200[0m 110.036 ms - 694[0m
[LOG] A√ß√£o: LOGIN_USER | Usu√°rio: N/A
PASS Testes/3-security/persistence.test.js (9.344 s)
  Security: Persist√™ncia de Dados Manuais
    ‚àö deve garantir que os usu√°rios de teste manuais permane√ßam no banco ap√≥s a execu√ß√£o de `npm test` (8283 ms)

FAIL Testes/4-reports/reports.test.js
  ‚óè Test suite failed to run

    Jest encountered an unexpected token

    Jest failed to parse a file. This happens e.g. when your code or its dependencies use non-standard JavaScript syntax, or when Jest is not configured to support such syntax.

    Out of the box Jest supports Babel, which will be used to transform your files into valid JS based on your Babel configuration.

    By default "node_modules" folder is ignored by transformers.

    Here's what you can do:
     ‚Ä¢ If you are trying to use ECMAScript Modules, see https://jestjs.io/docs/ecmascript-modules for how to enable it.
     ‚Ä¢ If you are trying to use TypeScript, see https://jestjs.io/docs/getting-started#using-typescript
     ‚Ä¢ To have some of your "node_modules" files transformed, you can specify a custom "transformIgnorePatterns" in your config.
     ‚Ä¢ If you need a custom transformation, specify a "transform" option in your config.
     ‚Ä¢ If you simply want to mock your non-JS modules (e.g. binary assets) you can stub them out with the "moduleNameMapper" config option.

    You'll find more details and examples of these config options in the docs:
    https://jestjs.io/docs/configuration
    For information about custom transformations, see:
    https://jestjs.io/docs/code-transformation

    Details:

    SyntaxError: F:\Programacao\GitHub\pbr-si-2025-2-p3-tiapn-t1-9147100-smart-gestao\src\codes\backend\Testes\4-reports\reports.test.js: Unterminated string constant. (44:7)

    [0m [90m 42 |[39m   })[33m;[39m
     [90m 43 |[39m
    [31m[1m>[22m[39m[90m 44 |[39m   test([32m'deve chamar o servi√ß.od();[39m
     [90m    |[39m        [31m[1m^[22m[39m
     [90m 45 |[39m
     [90m 46 |[39m     [90m// 3. Valida√ß√£o dos Dados: Captura os argumentos com os quais a fun√ß√£o foi chamada para inspecion√°-los.[39m
     [90m 47 |[39m     [36mconst[39m capturedData [33m=[39m generateFinancialReportPDF[33m.[39mmock[33m.[39mcalls[[35m0[39m][[35m0[39m][33m;[39m[0m

      at constructor (node_modules/@babel/parser/src/parse-error.ts:95:45)
      at Parser.toParseError [as raise] (node_modules/@babel/parser/src/tokenizer/index.ts:1507:19)
      at Object.raise [as unterminated] (node_modules/@babel/parser/src/tokenizer/index.ts:1617:18)
      at unterminated (node_modules/@babel/babel-helper-string-parser/src/index.ts:115:16)
      at Parser.readStringContents [as readString] (node_modules/@babel/parser/src/tokenizer/index.ts:1340:46)
      at Parser.readString [as getTokenFromCode] (node_modules/@babel/parser/src/tokenizer/index.ts:995:14)
      at Parser.getTokenFromCode [as nextToken] (node_modules/@babel/parser/src/tokenizer/index.ts:279:10)
      at Parser.nextToken [as next] (node_modules/@babel/parser/src/tokenizer/index.ts:122:10)
      at Parser.next [as parseCoverCallAndAsyncArrowHead] (node_modules/@babel/parser/src/parser/expression.ts:902:10)
      at Parser.parseCoverCallAndAsyncArrowHead [as parseSubscript] (node_modules/@babel/parser/src/parser/expression.ts:804:19)
      at Parser.parseSubscript [as parseSubscripts] (node_modules/@babel/parser/src/parser/expression.ts:763:19)
      at Parser.parseSubscripts [as parseExprSubscripts] (node_modules/@babel/parser/src/parser/expression.ts:748:17)
      at Parser.parseExprSubscripts [as parseUpdate] (node_modules/@babel/parser/src/parser/expression.ts:721:21)
      at Parser.parseUpdate [as parseMaybeUnary] (node_modules/@babel/parser/src/parser/expression.ts:683:23)
      at Parser.parseMaybeUnary [as parseMaybeUnaryOrPrivate] (node_modules/@babel/parser/src/parser/expression.ts:417:14)
      at Parser.parseMaybeUnaryOrPrivate [as parseExprOps] (node_modules/@babel/parser/src/parser/expression.ts:429:23)
      at Parser.parseExprOps [as parseMaybeConditional] (node_modules/@babel/parser/src/parser/expression.ts:384:23)
      at Parser.parseMaybeConditional [as parseMaybeAssign] (node_modules/@babel/parser/src/parser/expression.ts:301:21)
      at Parser.parseMaybeAssign [as parseExpressionBase] (node_modules/@babel/parser/src/parser/expression.ts:226:23)
      at parseExpressionBase (node_modules/@babel/parser/src/parser/expression.ts:217:39)
      at Parser.callback [as allowInAnd] (node_modules/@babel/parser/src/parser/expression.ts:3197:16)
      at Parser.allowInAnd [as parseExpression] (node_modules/@babel/parser/src/parser/expression.ts:217:17)
      at Parser.parseExpression [as parseStatementContent] (node_modules/@babel/parser/src/parser/statement.ts:688:23)
      at Parser.parseStatementContent [as parseStatementLike] (node_modules/@babel/parser/src/parser/statement.ts:482:17)
      at Parser.parseStatementLike [as parseStatementListItem] (node_modules/@babel/parser/src/parser/statement.ts:431:17)
      at Parser.parseStatementListItem [as parseBlockOrModuleBlockBody] (node_modules/@babel/parser/src/parser/statement.ts:1444:16)
      at Parser.parseBlockOrModuleBlockBody [as parseBlockBody] (node_modules/@babel/parser/src/parser/statement.ts:1417:10)
      at Parser.parseBlockBody [as parseBlock] (node_modules/@babel/parser/src/parser/statement.ts:1385:10)
      at Parser.parseBlock [as parseFunctionBody] (node_modules/@babel/parser/src/parser/expression.ts:2626:24)
      at Parser.parseFunctionBody [as parseArrowExpression] (node_modules/@babel/parser/src/parser/expression.ts:2563:10)
      at Parser.parseArrowExpression [as parseAsyncArrowFromCallExpression] (node_modules/@babel/parser/src/parser/expression.ts:1067:10)
      at Parser.parseAsyncArrowFromCallExpression [as parseCoverCallAndAsyncArrowHead] (node_modules/@babel/parser/src/parser/expression.ts:942:27)
      at Parser.parseCoverCallAndAsyncArrowHead [as parseSubscript] (node_modules/@babel/parser/src/parser/expression.ts:804:19)
      at Parser.parseSubscript [as parseSubscripts] (node_modules/@babel/parser/src/parser/expression.ts:763:19)
      at Parser.parseSubscripts [as parseExprSubscripts] (node_modules/@babel/parser/src/parser/expression.ts:748:17)
      at Parser.parseExprSubscripts [as parseUpdate] (node_modules/@babel/parser/src/parser/expression.ts:721:21)
      at Parser.parseUpdate [as parseMaybeUnary] (node_modules/@babel/parser/src/parser/expression.ts:683:23)
      at Parser.parseMaybeUnary [as parseMaybeUnaryOrPrivate] (node_modules/@babel/parser/src/parser/expression.ts:417:14)
      at Parser.parseMaybeUnaryOrPrivate [as parseExprOps] (node_modules/@babel/parser/src/parser/expression.ts:429:23)
      at Parser.parseExprOps [as parseMaybeConditional] (node_modules/@babel/parser/src/parser/expression.ts:384:23)
      at Parser.parseMaybeConditional [as parseMaybeAssign] (node_modules/@babel/parser/src/parser/expression.ts:301:21)
      at parseMaybeAssign (node_modules/@babel/parser/src/parser/expression.ts:257:12)
      at Parser.callback [as allowInAnd] (node_modules/@babel/parser/src/parser/expression.ts:3202:12)
      at Parser.allowInAnd [as parseMaybeAssignAllowIn] (node_modules/@babel/parser/src/parser/expression.ts:256:17)
      at Parser.parseMaybeAssignAllowIn [as parseMaybeAssignAllowInOrVoidPattern] (node_modules/@babel/parser/src/parser/expression.ts:3316:17)
      at Parser.parseMaybeAssignAllowInOrVoidPattern [as parseExprListItem] (node_modules/@babel/parser/src/parser/expression.ts:2798:18)
      at Parser.parseExprListItem [as parseCallExpressionArguments] (node_modules/@babel/parser/src/parser/expression.ts:1042:14)
      at Parser.parseCallExpressionArguments [as parseCoverCallAndAsyncArrowHead] (node_modules/@babel/parser/src/parser/expression.ts:922:29)
      at Parser.parseCoverCallAndAsyncArrowHead [as parseSubscript] (node_modules/@babel/parser/src/parser/expression.ts:804:19)
      at Parser.parseSubscript [as parseSubscripts] (node_modules/@babel/parser/src/parser/expression.ts:763:19)
      at Parser.parseSubscripts [as parseExprSubscripts] (node_modules/@babel/parser/src/parser/expression.ts:748:17)
      at Parser.parseExprSubscripts [as parseUpdate] (node_modules/@babel/parser/src/parser/expression.ts:721:21)
      at Parser.parseUpdate [as parseMaybeUnary] (node_modules/@babel/parser/src/parser/expression.ts:683:23)
      at Parser.parseMaybeUnary [as parseMaybeUnaryOrPrivate] (node_modules/@babel/parser/src/parser/expression.ts:417:14)
      at Parser.parseMaybeUnaryOrPrivate [as parseExprOps] (node_modules/@babel/parser/src/parser/expression.ts:429:23)
      at Parser.parseExprOps [as parseMaybeConditional] (node_modules/@babel/parser/src/parser/expression.ts:384:23)
      at Parser.parseMaybeConditional [as parseMaybeAssign] (node_modules/@babel/parser/src/parser/expression.ts:301:21)
      at Parser.parseMaybeAssign [as parseExpressionBase] (node_modules/@babel/parser/src/parser/expression.ts:226:23)
      at parseExpressionBase (node_modules/@babel/parser/src/parser/expression.ts:217:39)
      at Parser.callback [as allowInAnd] (node_modules/@babel/parser/src/parser/expression.ts:3197:16)
      at Parser.allowInAnd [as parseExpression] (node_modules/@babel/parser/src/parser/expression.ts:217:17)
      at Parser.parseExpression [as parseStatementContent] (node_modules/@babel/parser/src/parser/statement.ts:688:23)
      at Parser.parseStatementContent [as parseStatementLike] (node_modules/@babel/parser/src/parser/statement.ts:482:17)
      at Parser.parseStatementLike [as parseModuleItem] (node_modules/@babel/parser/src/parser/statement.ts:419:17)
      at Parser.parseModuleItem [as parseBlockOrModuleBlockBody] (node_modules/@babel/parser/src/parser/statement.ts:1443:16)
      at Parser.parseBlockOrModuleBlockBody [as parseBlockBody] (node_modules/@babel/parser/src/parser/statement.ts:1417:10)
      at Parser.parseBlockBody [as parseProgram] (node_modules/@babel/parser/src/parser/statement.ts:229:10)
      at Parser.parseProgram [as parseTopLevel] (node_modules/@babel/parser/src/parser/statement.ts:203:25)
      at Parser.parseTopLevel [as parse] (node_modules/@babel/parser/src/parser/index.ts:88:25)
      at parse (node_modules/@babel/parser/src/index.ts:86:38)
      at parser (node_modules/@babel/core/src/parser/index.ts:29:19)
          at parser.next (<anonymous>)
      at normalizeFile (node_modules/@babel/core/src/transformation/normalize-file.ts:50:24)
          at normalizeFile.next (<anonymous>)
      at run (node_modules/@babel/core/src/transformation/index.ts:41:36)
          at run.next (<anonymous>)
      at transform (node_modules/@babel/core/src/transform.ts:29:20)
          at transform.next (<anonymous>)
      at step (node_modules/gensync/index.js:261:32)
      at node_modules/gensync/index.js:273:13
      at async.call.result.err.err (node_modules/gensync/index.js:223:11)
      at node_modules/gensync/index.js:189:28
      at cb (node_modules/@babel/core/src/gensync-utils/async.ts:90:7)
      at node_modules/gensync/index.js:113:33
      at step (node_modules/gensync/index.js:287:14)
      at node_modules/gensync/index.js:273:13
      at async.call.result.err.err (node_modules/gensync/index.js:223:11)
      at node_modules/gensync/index.js:37:40

Test Suites: 1 failed, 8 passed, 9 total
Tests:       32 passed, 32 total
Snapshots:   0 total
Time:        16.207 s
Ran all test suites.

--- üßπ [GLOBAL TEARDOWN] Finalizando ambiente de teste ---
   - [OK] Dados de teste tempor√°rios foram removidos.
‚úÖ Servidor e conex√£o com MongoDB encerrados (stopServer).
--- ‚úÖ [GLOBAL TEARDOWN] Ambiente finalizado com sucesso ---
