
--- üöÄ [ETAPA 1 de 4] Iniciando Ambiente de Teste (Jest Environment) ---
   - [PROCESSO] Lendo configura√ß√£o do banco de dados de teste...
   - [ATEN√á√ÉO] Usando banco de dados de DESENVOLVIMENTO para os testes. As cole√ß√µes ser√£o limpas.

--- üöÄ [ETAPA 2 de 4] Limpando e populando o banco de dados de TESTE ---
   - [OK] Dados de teste (empresas e usu√°rios) criados e salvos em test-setup.json.
(node:29404) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
  console.log
    
    --- Configurando 3 empresas para o teste multi-tenant ---

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:19:17)

  console.log
    ‚úÖ Empresa 1 (Empresa Teste 1762991944338) cadastrada e logada.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:48:21)

  console.log
    ‚úÖ Empresa 2 (Empresa Teste 1762991944688) cadastrada e logada.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:48:21)

  console.log
    ‚úÖ Empresa 3 (Empresa Teste 1762991944943) cadastrada e logada.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:48:21)

  console.log
    --- Configura√ß√£o multi-tenant conclu√≠da ---

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:50:17)

  console.log
    
    --- Criando transa√ß√µes individuais para cada empresa ---

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:55:17)

  console.log
    Transa√ß√£o criada para Empresa Teste 1762991944338. ID: 69151f49b82cca07c7b4bce3

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:76:21)

  console.log
    Transa√ß√£o criada para Empresa Teste 1762991944688. ID: 69151f49b82cca07c7b4bcea

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:76:21)

  console.log
    Transa√ß√£o criada para Empresa Teste 1762991944943. ID: 69151f49b82cca07c7b4bcf1

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:76:21)

  console.log
    
    --- Validando isolamento de dados entre todas as empresas ---

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:82:17)

  console.log
    
    Verificando a transa√ß√£o 69151f49b82cca07c7b4bce3 da Empresa Teste 1762991944338

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:89:21)

  console.log
    - OK: Empresa Teste 1762991944688 foi bloqueada (Status 404).

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:107:29)

  console.log
    - OK: Empresa Teste 1762991944943 foi bloqueada (Status 404).

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:107:29)

  console.log
    
    Verificando a transa√ß√£o 69151f49b82cca07c7b4bcea da Empresa Teste 1762991944688

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:89:21)

  console.log
    - OK: Empresa Teste 1762991944338 foi bloqueada (Status 404).

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:107:29)

  console.log
    - OK: Empresa Teste 1762991944943 foi bloqueada (Status 404).

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:107:29)

  console.log
    
    Verificando a transa√ß√£o 69151f49b82cca07c7b4bcf1 da Empresa Teste 1762991944943

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:89:21)

  console.log
    - OK: Empresa Teste 1762991944338 foi bloqueada (Status 404).

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:107:29)

  console.log
    - OK: Empresa Teste 1762991944688 foi bloqueada (Status 404).

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:107:29)

  console.log
    
    --- Validando listagem de transa√ß√µes ---

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:114:17)

  console.log
    - OK: Empresa Teste 1762991944338 listou apenas sua pr√≥pria transa√ß√£o.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:126:21)

  console.log
    - OK: Empresa Teste 1762991944688 listou apenas sua pr√≥pria transa√ß√£o.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:126:21)

  console.log
    - OK: Empresa Teste 1762991944943 listou apenas sua pr√≥pria transa√ß√£o.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:126:21)

  console.log
    
    --- Limpando dados de teste (Teardown) ---

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:132:17)

  console.log
    - ‚úÖ Empresa Empresa Teste 1762991944338 e dados associados exclu√≠dos com sucesso.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:139:25)

  console.log
    - ‚úÖ Empresa Empresa Teste 1762991944688 e dados associados exclu√≠dos com sucesso.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:139:25)

  console.log
    - ‚úÖ Empresa Empresa Teste 1762991944943 e dados associados exclu√≠dos com sucesso.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:139:25)


--- üßπ [ENV] Desconectando do banco de dados ---
--- ‚úÖ [ENV] Ambiente de teste finalizado ---
 PASS  Testes/3-security/multi-tenant.test.js
  3. Teste de Isolamento de Dados em Larga Escala (Multi-Tenant)
    ‚àö deve criar uma transa√ß√£o para cada empresa (177 ms)
    ‚àö deve impedir que uma empresa acesse a transa√ß√£o de outra (192 ms)
    ‚àö deve garantir que cada empresa liste apenas suas pr√≥prias transa√ß√µes (98 ms)


--- üöÄ [ETAPA 1 de 4] Iniciando Ambiente de Teste (Jest Environment) ---
   - [PROCESSO] Lendo configura√ß√£o do banco de dados de teste...
   - [ATEN√á√ÉO] Usando banco de dados de DESENVOLVIMENTO para os testes. As cole√ß√µes ser√£o limpas.

--- üöÄ [ETAPA 2 de 4] Limpando e populando o banco de dados de TESTE ---
   - [OK] Dados de teste (empresas e usu√°rios) criados e salvos em test-setup.json.
  console.log
    
    --- Teste: Solicitar reset para e-mail inv√°lido ---

      at Object.<anonymous> (Testes/1-auth/password.test.js:26:13)

  console.log
    ‚úÖ Falhou como esperado para e-mail inexistente (Status 404).

      at Object.<anonymous> (Testes/1-auth/password.test.js:35:15)

  console.log
    
    --- Teste: Gerar token de reset com sucesso ---

      at Object.<anonymous> (Testes/1-auth/password.test.js:40:13)

  console.log
    ‚úÖ Token de reset gerado e salvo no banco de dados.

      at Object.<anonymous> (Testes/1-auth/password.test.js:54:13)

  console.log
    
    --- Teste: Resetar senha com token v√°lido ---

      at Object.<anonymous> (Testes/1-auth/password.test.js:58:13)

  console.log
    ‚úÖ Senha resetada com sucesso via API.

      at Object.<anonymous> (Testes/1-auth/password.test.js:75:13)

  console.log
    ‚úÖ Token de reset foi invalidado no banco.

      at Object.<anonymous> (Testes/1-auth/password.test.js:82:13)

  console.log
    ‚úÖ Login com a nova senha realizado com sucesso.

      at Object.<anonymous> (Testes/1-auth/password.test.js:92:13)


--- üßπ [ENV] Desconectando do banco de dados ---
--- ‚úÖ [ENV] Ambiente de teste finalizado ---
 PASS  Testes/1-auth/password.test.js
  9. M√≥dulo de Recupera√ß√£o de Senha
    ‚àö deve falhar ao solicitar reset para um e-mail inexistente (30 ms)
    ‚àö deve gerar e salvar um token de reset para um e-mail v√°lido (55 ms)
    ‚àö deve resetar a senha com um token v√°lido e permitir login com a nova senha (280 ms)


--- üöÄ [ETAPA 1 de 4] Iniciando Ambiente de Teste (Jest Environment) ---
   - [PROCESSO] Lendo configura√ß√£o do banco de dados de teste...
   - [ATEN√á√ÉO] Usando banco de dados de DESENVOLVIMENTO para os testes. As cole√ß√µes ser√£o limpas.

--- üöÄ [ETAPA 2 de 4] Limpando e populando o banco de dados de TESTE ---
   - [OK] Dados de teste (empresas e usu√°rios) criados e salvos em test-setup.json.

--- üßπ [ENV] Desconectando do banco de dados ---
--- ‚úÖ [ENV] Ambiente de teste finalizado ---
 PASS  Testes/2-features/clients.test.js
  7. M√≥dulo de Clientes/Fornecedores
    ‚àö deve CRIAR um novo cliente com sucesso (46 ms)
    ‚àö deve LISTAR os clientes da empresa (31 ms)
    ‚àö deve ATUALIZAR um cliente existente (38 ms)
    ‚àö deve EXCLUIR um cliente existente (46 ms)


--- üöÄ [ETAPA 1 de 4] Iniciando Ambiente de Teste (Jest Environment) ---
   - [PROCESSO] Lendo configura√ß√£o do banco de dados de teste...
   - [ATEN√á√ÉO] Usando banco de dados de DESENVOLVIMENTO para os testes. As cole√ß√µes ser√£o limpas.

--- üöÄ [ETAPA 2 de 4] Limpando e populando o banco de dados de TESTE ---
   - [OK] Dados de teste (empresas e usu√°rios) criados e salvos em test-setup.json.

--- üßπ [ENV] Desconectando do banco de dados ---
--- ‚úÖ [ENV] Ambiente de teste finalizado ---
 PASS  Testes/2-features/transactions.test.js
  4. M√≥dulo de Transa√ß√µes (CRUD)
    ‚àö deve CRIAR uma nova transa√ß√£o com sucesso (62 ms)
    ‚àö deve falhar ao tentar criar uma transa√ß√£o com dados inv√°lidos (22 ms)
    ‚àö deve LISTAR as transa√ß√µes do usu√°rio logado (32 ms)
    ‚àö deve OBTER uma transa√ß√£o espec√≠fica pelo ID (31 ms)
    ‚àö deve ATUALIZAR uma transa√ß√£o existente (51 ms)
    ‚àö deve EXCLUIR uma transa√ß√£o existente (88 ms)


--- üöÄ [ETAPA 1 de 4] Iniciando Ambiente de Teste (Jest Environment) ---
   - [PROCESSO] Lendo configura√ß√£o do banco de dados de teste...
   - [ATEN√á√ÉO] Usando banco de dados de DESENVOLVIMENTO para os testes. As cole√ß√µes ser√£o limpas.

--- üöÄ [ETAPA 2 de 4] Limpando e populando o banco de dados de TESTE ---
   - [OK] Dados de teste (empresas e usu√°rios) criados e salvos em test-setup.json.

--- üßπ [ENV] Desconectando do banco de dados ---
--- ‚úÖ [ENV] Ambiente de teste finalizado ---
 PASS  Testes/2-features/goals.test.js
  5. M√≥dulo de Metas (CRUD)
    ‚àö deve CRIAR uma nova meta com sucesso (60 ms)
    ‚àö deve LISTAR as metas do usu√°rio logado (33 ms)
    ‚àö deve ATUALIZAR uma meta existente (72 ms)
    ‚àö deve EXCLUIR uma meta existente (85 ms)


--- üöÄ [ETAPA 1 de 4] Iniciando Ambiente de Teste (Jest Environment) ---
   - [PROCESSO] Lendo configura√ß√£o do banco de dados de teste...
   - [ATEN√á√ÉO] Usando banco de dados de DESENVOLVIMENTO para os testes. As cole√ß√µes ser√£o limpas.

--- üöÄ [ETAPA 2 de 4] Limpando e populando o banco de dados de TESTE ---
   - [OK] Dados de teste (empresas e usu√°rios) criados e salvos em test-setup.json.

--- üßπ [ENV] Desconectando do banco de dados ---
--- ‚úÖ [ENV] Ambiente de teste finalizado ---
 PASS  Testes/1-auth/auth.test.js
  6. M√≥dulo de Autentica√ß√£o e Sess√£o (Stateful)
    ‚àö deve criar um SessionToken no banco de dados ap√≥s o login (109 ms)
    ‚àö deve invalidar o SessionToken no banco de dados ap√≥s o logout (121 ms)


--- üöÄ [ETAPA 1 de 4] Iniciando Ambiente de Teste (Jest Environment) ---
   - [PROCESSO] Lendo configura√ß√£o do banco de dados de teste...
   - [ATEN√á√ÉO] Usando banco de dados de DESENVOLVIMENTO para os testes. As cole√ß√µes ser√£o limpas.

--- üöÄ [ETAPA 2 de 4] Limpando e populando o banco de dados de TESTE ---
   - [OK] Dados de teste (empresas e usu√°rios) criados e salvos em test-setup.json.

--- üßπ [ENV] Desconectando do banco de dados ---
--- ‚úÖ [ENV] Ambiente de teste finalizado ---
 FAIL  Testes/4-reports/reports.test.js
  8. M√≥dulo de Relat√≥rios
    √ó deve EXPORTAR um relat√≥rio de transa√ß√µes, validar seu conte√∫do e salv√°-lo (105 ms)
    √ó deve EXPORTAR um relat√≥rio de clientes, validar seu conte√∫do e salv√°-lo (1 ms)
    √ó deve EXPORTAR uma fatura de transa√ß√£o, validar seu conte√∫do e salv√°-la (1 ms)

  ‚óè 8. M√≥dulo de Relat√≥rios ‚Ä∫ deve EXPORTAR um relat√≥rio de transa√ß√µes, validar seu conte√∫do e salv√°-lo

    TypeError: pdf.default is not a function

      39 |
      40 |     // Valida o conte√∫do do PDF
    > 41 |     const pdfData = await pdf.default(pdfBuffer);
         |                                      ^
      42 |     expect(pdfData.text).toContain('Relat√≥rio de Transa√ß√µes');
      43 |     expect(pdfData.text).toContain(companyA.name); // Verifica se o nome da empresa est√° no relat√≥rio.
      44 |

      at Object.<anonymous> (Testes/4-reports/reports.test.js:41:38)

  ‚óè 8. M√≥dulo de Relat√≥rios ‚Ä∫ deve EXPORTAR um relat√≥rio de clientes, validar seu conte√∫do e salv√°-lo

    TypeError: Cannot read properties of undefined (reading 'create')

      63 |   test('deve EXPORTAR um relat√≥rio de clientes, validar seu conte√∫do e salv√°-lo', async () => {
      64 |     // Utiliza a conex√£o global para evitar erros de timeout.
    > 65 |     const testClient = await global.mongooseConnection.models.Client.create({
         |                                                                      ^
      66 |       companyId: companyA.companyId,
      67 |       name: `Cliente PDF ${faker.person.lastName()}`,
      68 |       email: faker.internet.email(),

      at Object.<anonymous> (Testes/4-reports/reports.test.js:65:70)

  ‚óè 8. M√≥dulo de Relat√≥rios ‚Ä∫ deve EXPORTAR uma fatura de transa√ß√£o, validar seu conte√∫do e salv√°-la

    TypeError: Cannot read properties of undefined (reading 'create')

      86 |   test('deve EXPORTAR uma fatura de transa√ß√£o, validar seu conte√∫do e salv√°-la', async () => {
      87 |     // Utiliza a conex√£o global para evitar erros de timeout.
    > 88 |     const testTransaction = await global.mongooseConnection.models.Transaction.create({
         |                                                                                ^
      89 |       companyId: companyA.companyId,
      90 |       userId: companyA.userId,
      91 |       description: 'Servi√ßo de Consultoria para Fatura PDF',

      at Object.<anonymous> (Testes/4-reports/reports.test.js:88:80)

Test Suites: 1 failed, 6 passed, 7 total
Tests:       3 failed, 22 passed, 25 total
Snapshots:   0 total
Time:        14.076 s
Ran all test suites.

--- FIM DOS TESTES AUTOMATIZADOS (Status: Falha) ---
