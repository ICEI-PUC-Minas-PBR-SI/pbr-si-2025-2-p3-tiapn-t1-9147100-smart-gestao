
--- üöÄ [ETAPA 1 de 4] Iniciando Ambiente de Teste (Jest Environment) ---
   - [PROCESSO] Lendo configura√ß√£o do banco de dados de teste...
   - [ATEN√á√ÉO] Usando banco de dados de DESENVOLVIMENTO para os testes. As cole√ß√µes ser√£o limpas.

--- üöÄ [ETAPA 2 de 4] Limpando e populando o banco de dados de TESTE ---
   - [OK] Dados de teste (empresas e usu√°rios) criados e salvos em test-setup.json.
(node:29424) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)

--- üßπ [ENV] Desconectando do banco de dados ---
--- ‚úÖ [ENV] Ambiente de teste finalizado ---
 PASS  Testes/2-features/clients.test.js
  7. M√≥dulo de Clientes/Fornecedores
    ‚àö deve CRIAR um novo cliente com sucesso (86 ms)
    ‚àö deve LISTAR os clientes da empresa (34 ms)
    ‚àö deve ATUALIZAR um cliente existente (41 ms)
    ‚àö deve EXCLUIR um cliente existente (45 ms)


--- üöÄ [ETAPA 1 de 4] Iniciando Ambiente de Teste (Jest Environment) ---
   - [PROCESSO] Lendo configura√ß√£o do banco de dados de teste...
   - [ATEN√á√ÉO] Usando banco de dados de DESENVOLVIMENTO para os testes. As cole√ß√µes ser√£o limpas.

--- üöÄ [ETAPA 2 de 4] Limpando e populando o banco de dados de TESTE ---
   - [OK] Dados de teste (empresas e usu√°rios) criados e salvos em test-setup.json.

--- üßπ [ENV] Desconectando do banco de dados ---
--- ‚úÖ [ENV] Ambiente de teste finalizado ---
 FAIL  Testes/2-features/goals.test.js
  5. M√≥dulo de Metas (CRUD)
    √ó deve CRIAR uma nova meta com sucesso (69 ms)
    √ó deve LISTAR as metas do usu√°rio logado (1 ms)
    √ó deve ATUALIZAR uma meta existente (1 ms)
    √ó deve EXCLUIR uma meta existente (1 ms)

  ‚óè 5. M√≥dulo de Metas (CRUD) ‚Ä∫ deve CRIAR uma nova meta com sucesso

    expect(received).toBe(expected) // Object.is equality

    Expected: 201
    Received: 200

      30 |         });
      31 |
    > 32 |         expect(response.status).toBe(201);
         |                                 ^
      33 |         expect(response.data.data).toHaveProperty('_id');
      34 |         expect(response.data.data.title).toBe(goalData.title);
      35 |         expect(response.data.data.targetAmount).toBe(goalData.targetAmount);

      at Object.<anonymous> (Testes/2-features/goals.test.js:32:33)

  ‚óè 5. M√≥dulo de Metas (CRUD) ‚Ä∫ deve LISTAR as metas do usu√°rio logado

    expect(received).toBeDefined()

    Received: undefined

      39 |
      40 |     it('deve LISTAR as metas do usu√°rio logado', async () => {
    > 41 |         expect(createdGoalId).toBeDefined();
         |                               ^
      42 |
      43 |         const response = await axios.get(`${API_URL}/goals`, {
      44 |             headers: { Authorization: `Bearer ${userToken}` }

      at Object.<anonymous> (Testes/2-features/goals.test.js:41:31)

  ‚óè 5. M√≥dulo de Metas (CRUD) ‚Ä∫ deve ATUALIZAR uma meta existente

    expect(received).toBeDefined()

    Received: undefined

      52 |
      53 |     it('deve ATUALIZAR uma meta existente', async () => {
    > 54 |         expect(createdGoalId).toBeDefined();
         |                               ^
      55 |
      56 |         const updatedData = {
      57 |             title: 'Economizar para novo maquin√°rio (URGENTE)',

      at Object.<anonymous> (Testes/2-features/goals.test.js:54:31)

  ‚óè 5. M√≥dulo de Metas (CRUD) ‚Ä∫ deve EXCLUIR uma meta existente

    expect(received).toBeDefined()

    Received: undefined

      69 |
      70 |     it('deve EXCLUIR uma meta existente', async () => {
    > 71 |         expect(createdGoalId).toBeDefined();
         |                               ^
      72 |
      73 |         const response = await axios.delete(`${API_URL}/goals/${createdGoalId}`, {
      74 |             headers: { Authorization: `Bearer ${userToken}` }

      at Object.<anonymous> (Testes/2-features/goals.test.js:71:31)


--- üöÄ [ETAPA 1 de 4] Iniciando Ambiente de Teste (Jest Environment) ---
   - [PROCESSO] Lendo configura√ß√£o do banco de dados de teste...
   - [ATEN√á√ÉO] Usando banco de dados de DESENVOLVIMENTO para os testes. As cole√ß√µes ser√£o limpas.

--- üöÄ [ETAPA 2 de 4] Limpando e populando o banco de dados de TESTE ---
   - [OK] Dados de teste (empresas e usu√°rios) criados e salvos em test-setup.json.
  console.log
    
    --- Configurando 3 empresas para o teste multi-tenant ---

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:19:17)

  console.log
    ‚úÖ Empresa 1 (Empresa Teste 1762988668581) cadastrada e logada.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:48:21)

  console.log
    ‚úÖ Empresa 2 (Empresa Teste 1762988668887) cadastrada e logada.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:48:21)

  console.log
    ‚úÖ Empresa 3 (Empresa Teste 1762988669151) cadastrada e logada.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:48:21)

  console.log
    --- Configura√ß√£o multi-tenant conclu√≠da ---

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:50:17)

  console.log
    
    --- Criando transa√ß√µes individuais para cada empresa ---

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:55:17)

  console.log
    Transa√ß√£o criada para Empresa Teste 1762988668581. ID: 6915127d64cc8a4161fa16d4

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:76:21)

  console.log
    Transa√ß√£o criada para Empresa Teste 1762988668887. ID: 6915127d64cc8a4161fa16db

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:76:21)

  console.log
    Transa√ß√£o criada para Empresa Teste 1762988669151. ID: 6915127d64cc8a4161fa16e2

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:76:21)

  console.log
    
    --- Validando isolamento de dados entre todas as empresas ---

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:82:17)

  console.log
    
    Verificando a transa√ß√£o 6915127d64cc8a4161fa16d4 da Empresa Teste 1762988668581

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:89:21)

  console.log
    - OK: Empresa Teste 1762988668887 foi bloqueada (Status 404).

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:107:29)

  console.log
    - OK: Empresa Teste 1762988669151 foi bloqueada (Status 404).

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:107:29)

  console.log
    
    Verificando a transa√ß√£o 6915127d64cc8a4161fa16db da Empresa Teste 1762988668887

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:89:21)

  console.log
    - OK: Empresa Teste 1762988668581 foi bloqueada (Status 404).

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:107:29)

  console.log
    - OK: Empresa Teste 1762988669151 foi bloqueada (Status 404).

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:107:29)

  console.log
    
    Verificando a transa√ß√£o 6915127d64cc8a4161fa16e2 da Empresa Teste 1762988669151

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:89:21)

  console.log
    - OK: Empresa Teste 1762988668581 foi bloqueada (Status 404).

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:107:29)

  console.log
    - OK: Empresa Teste 1762988668887 foi bloqueada (Status 404).

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:107:29)

  console.log
    
    --- Validando listagem de transa√ß√µes ---

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:114:17)

  console.log
    - OK: Empresa Teste 1762988668581 listou apenas sua pr√≥pria transa√ß√£o.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:126:21)

  console.log
    - OK: Empresa Teste 1762988668887 listou apenas sua pr√≥pria transa√ß√£o.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:126:21)

  console.log
    - OK: Empresa Teste 1762988669151 listou apenas sua pr√≥pria transa√ß√£o.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:126:21)

  console.log
    
    --- Limpando dados de teste (Teardown) ---

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:132:17)

  console.log
    - ‚úÖ Empresa Empresa Teste 1762988668581 e dados associados exclu√≠dos com sucesso.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:139:25)

  console.log
    - ‚úÖ Empresa Empresa Teste 1762988668887 e dados associados exclu√≠dos com sucesso.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:139:25)

  console.log
    - ‚úÖ Empresa Empresa Teste 1762988669151 e dados associados exclu√≠dos com sucesso.

      at Object.<anonymous> (Testes/3-security/multi-tenant.test.js:139:25)


--- üßπ [ENV] Desconectando do banco de dados ---
--- ‚úÖ [ENV] Ambiente de teste finalizado ---
 PASS  Testes/3-security/multi-tenant.test.js
  3. Teste de Isolamento de Dados em Larga Escala (Multi-Tenant)
    ‚àö deve criar uma transa√ß√£o para cada empresa (155 ms)
    ‚àö deve impedir que uma empresa acesse a transa√ß√£o de outra (181 ms)
    ‚àö deve garantir que cada empresa liste apenas suas pr√≥prias transa√ß√µes (88 ms)


--- üöÄ [ETAPA 1 de 4] Iniciando Ambiente de Teste (Jest Environment) ---
   - [PROCESSO] Lendo configura√ß√£o do banco de dados de teste...
   - [ATEN√á√ÉO] Usando banco de dados de DESENVOLVIMENTO para os testes. As cole√ß√µes ser√£o limpas.

--- üöÄ [ETAPA 2 de 4] Limpando e populando o banco de dados de TESTE ---
   - [OK] Dados de teste (empresas e usu√°rios) criados e salvos em test-setup.json.
  console.log
    
    --- Teste: Solicitar reset para e-mail inv√°lido ---

      at Object.<anonymous> (Testes/1-auth/password.test.js:26:13)

  console.log
    ‚úÖ Falhou como esperado para e-mail inexistente (Status 404).

      at Object.<anonymous> (Testes/1-auth/password.test.js:35:15)

  console.log
    
    --- Teste: Gerar token de reset com sucesso ---

      at Object.<anonymous> (Testes/1-auth/password.test.js:40:13)

  console.log
    ‚úÖ Token de reset gerado e salvo no banco de dados.

      at Object.<anonymous> (Testes/1-auth/password.test.js:53:13)

  console.log
    
    --- Teste: Resetar senha com token v√°lido ---

      at Object.<anonymous> (Testes/1-auth/password.test.js:57:13)

  console.log
    ‚úÖ Senha resetada com sucesso via API.

      at Object.<anonymous> (Testes/1-auth/password.test.js:74:13)

  console.log
    ‚úÖ Token de reset foi invalidado no banco.

      at Object.<anonymous> (Testes/1-auth/password.test.js:80:13)

  console.log
    ‚úÖ Login com a nova senha realizado com sucesso.

      at Object.<anonymous> (Testes/1-auth/password.test.js:90:13)


--- üßπ [ENV] Desconectando do banco de dados ---
--- ‚úÖ [ENV] Ambiente de teste finalizado ---
 PASS  Testes/1-auth/password.test.js
  9. M√≥dulo de Recupera√ß√£o de Senha
    ‚àö deve falhar ao solicitar reset para um e-mail inexistente (37 ms)
    ‚àö deve gerar e salvar um token de reset para um e-mail v√°lido (53 ms)
    ‚àö deve resetar a senha com um token v√°lido e permitir login com a nova senha (240 ms)


--- üöÄ [ETAPA 1 de 4] Iniciando Ambiente de Teste (Jest Environment) ---
   - [PROCESSO] Lendo configura√ß√£o do banco de dados de teste...
   - [ATEN√á√ÉO] Usando banco de dados de DESENVOLVIMENTO para os testes. As cole√ß√µes ser√£o limpas.

--- üöÄ [ETAPA 2 de 4] Limpando e populando o banco de dados de TESTE ---
   - [OK] Dados de teste (empresas e usu√°rios) criados e salvos em test-setup.json.

--- üßπ [ENV] Desconectando do banco de dados ---
--- ‚úÖ [ENV] Ambiente de teste finalizado ---
 PASS  Testes/2-features/transactions.test.js
  4. M√≥dulo de Transa√ß√µes (CRUD)
    ‚àö deve CRIAR uma nova transa√ß√£o com sucesso (75 ms)
    ‚àö deve falhar ao tentar criar uma transa√ß√£o com dados inv√°lidos (21 ms)
    ‚àö deve LISTAR as transa√ß√µes do usu√°rio logado (31 ms)
    ‚àö deve OBTER uma transa√ß√£o espec√≠fica pelo ID (30 ms)
    ‚àö deve ATUALIZAR uma transa√ß√£o existente (52 ms)
    ‚àö deve EXCLUIR uma transa√ß√£o existente (77 ms)


--- üöÄ [ETAPA 1 de 4] Iniciando Ambiente de Teste (Jest Environment) ---
   - [PROCESSO] Lendo configura√ß√£o do banco de dados de teste...
   - [ATEN√á√ÉO] Usando banco de dados de DESENVOLVIMENTO para os testes. As cole√ß√µes ser√£o limpas.

--- üöÄ [ETAPA 2 de 4] Limpando e populando o banco de dados de TESTE ---
   - [OK] Dados de teste (empresas e usu√°rios) criados e salvos em test-setup.json.

--- üßπ [ENV] Desconectando do banco de dados ---
--- ‚úÖ [ENV] Ambiente de teste finalizado ---
 PASS  Testes/1-auth/auth.test.js
  6. M√≥dulo de Autentica√ß√£o e Sess√£o (Stateful)
    ‚àö deve criar um SessionToken no banco de dados ap√≥s o login (103 ms)
    ‚àö deve invalidar o SessionToken no banco de dados ap√≥s o logout (116 ms)


--- üöÄ [ETAPA 1 de 4] Iniciando Ambiente de Teste (Jest Environment) ---
   - [PROCESSO] Lendo configura√ß√£o do banco de dados de teste...
   - [ATEN√á√ÉO] Usando banco de dados de DESENVOLVIMENTO para os testes. As cole√ß√µes ser√£o limpas.

--- üöÄ [ETAPA 2 de 4] Limpando e populando o banco de dados de TESTE ---
   - [OK] Dados de teste (empresas e usu√°rios) criados e salvos em test-setup.json.
  console.log
    ‚û°Ô∏è  [PASS] Resposta da API: 200, PDF recebido com 2329 bytes e salvo em: F:\Programacao\GitHub\pbr-si-2025-2-p3-tiapn-t1-9147100-smart-gestao\src\codes\backend\Testes\PDFs\pdf_teste_2025-11-12_20-04-34.pdf

      at Object.<anonymous> (Testes/4-reports/reports.test.js:57:13)


--- üßπ [ENV] Desconectando do banco de dados ---
--- ‚úÖ [ENV] Ambiente de teste finalizado ---
 PASS  Testes/4-reports/reports.test.js
  8. M√≥dulo de Relat√≥rios
    ‚àö deve EXPORTAR um relat√≥rio de transa√ß√µes em formato PDF (83 ms)

Test Suites: 1 failed, 6 passed, 7 total
Tests:       4 failed, 19 passed, 23 total
Snapshots:   0 total
Time:        9.754 s, estimated 10 s
Ran all test suites.

--- FIM DOS TESTES AUTOMATIZADOS (Status: Falha) ---
