
--- ðŸš€ [GLOBAL SETUP] Iniciando ambiente de teste ---
â³ Iniciando servidor Smart GestÃ£o (startServer)...
ConexÃ£o com o MongoDB estabelecida com sucesso.
âœ… [1/3] ConexÃ£o com o banco de dados estabelecida!
Verificando permissÃµes de sistema...
PermissÃµes de sistema jÃ¡ existem. Nenhuma aÃ§Ã£o necessÃ¡ria.
âœ… [2/3] PermissÃµes do sistema validadas/inicializadas.
âœ… [3/3] Servidor rodando na porta 5000
--- âœ… [GLOBAL SETUP] Ambiente pronto e servidor iniciado ---
(node:11496) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
POST /api/clients 201 34.978 ms - 319
[LOG] AÃ§Ã£o: CREATE_CLIENT | UsuÃ¡rio: 69165b7b17e19f4ee707e862
GET /api/clients 200 26.675 ms - 561
PUT /api/clients/69165b7c17e19f4ee707e872 200 32.631 ms - 358
[LOG] AÃ§Ã£o: UPDATE_CLIENT | UsuÃ¡rio: 69165b7b17e19f4ee707e862
DELETE /api/clients/69165b7c17e19f4ee707e872 200 28.964 ms - 70
GET /api/clients/69165b7c17e19f4ee707e872 404 1.218 ms - 175
[LOG] AÃ§Ã£o: DELETE_CLIENT | UsuÃ¡rio: 69165b7b17e19f4ee707e862
DELETE /api/clients/69165b7c17e19f4ee707e872 404 25.913 ms - 68
PASS Testes/2-features/clients.test.js
  7. MÃ³dulo de Clientes/Fornecedores
    âˆš deve CRIAR um novo cliente com sucesso (75 ms)
    âˆš deve LISTAR os clientes da empresa (30 ms)
    âˆš deve ATUALIZAR um cliente existente (37 ms)
    âˆš deve EXCLUIR um cliente existente (44 ms)

[LOG] AÃ§Ã£o: DELETE_CLIENT | UsuÃ¡rio: 69165b7b17e19f4ee707e862
[LOG] AÃ§Ã£o: CREATE_GOAL | UsuÃ¡rio: 69165b7b17e19f4ee707e862
POST /api/goals 201 43.565 ms - 404
GET /api/goals 200 26.906 ms - 406
[LOG] AÃ§Ã£o: UPDATE_GOAL | UsuÃ¡rio: 69165b7b17e19f4ee707e862
PUT /api/goals/69165b7c17e19f4ee707e885 200 46.113 ms - 414
[LOG] AÃ§Ã£o: DELETE_GOAL | UsuÃ¡rio: 69165b7b17e19f4ee707e862
DELETE /api/goals/69165b7c17e19f4ee707e885 200 44.987 ms - 67
GET /api/goals/69165b7c17e19f4ee707e885 404 26.341 ms - 65
DELETE /api/goals/69165b7c17e19f4ee707e885 404 25.473 ms - 65
PASS Testes/2-features/goals.test.js
  5. MÃ³dulo de Metas (CRUD)
    âˆš deve CRIAR uma nova meta com sucesso (55 ms)
    âˆš deve LISTAR as metas do usuÃ¡rio logado (31 ms)
    âˆš deve ATUALIZAR uma meta existente (50 ms)
    âˆš deve EXCLUIR uma meta existente (89 ms)

[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 69165b7b17e19f4ee707e862
POST /api/transactions 201 59.392 ms - 468
[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 69165b7b17e19f4ee707e862
POST /api/transactions 400 13.582 ms - 277
[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 69165b7b17e19f4ee707e862
GET /api/transactions 200 26.996 ms - 855
GET /api/transactions/69165b7d17e19f4ee707e898 200 25.313 ms - 452
[LOG] AÃ§Ã£o: UPDATE_TRANSACTION | UsuÃ¡rio: 69165b7b17e19f4ee707e862
PUT /api/transactions/69165b7d17e19f4ee707e898 200 43.788 ms - 452
[LOG] AÃ§Ã£o: UPDATE_TRANSACTION | UsuÃ¡rio: 69165b7b17e19f4ee707e862
[LOG] AÃ§Ã£o: DELETE_TRANSACTION | UsuÃ¡rio: 69165b7b17e19f4ee707e862
DELETE /api/transactions/69165b7d17e19f4ee707e898 200 43.469 ms - 73
[LOG] AÃ§Ã£o: DELETE_TRANSACTION | UsuÃ¡rio: 69165b7b17e19f4ee707e862
GET /api/transactions/69165b7d17e19f4ee707e898 404 24.925 ms - 71
DELETE /api/transactions/69165b7d17e19f4ee707e898 404 24.713 ms - 71
PASS Testes/2-features/transactions.test.js
  4. MÃ³dulo de TransaÃ§Ãµes (CRUD)
    âˆš deve CRIAR uma nova transaÃ§Ã£o com sucesso (71 ms)
    âˆš deve falhar ao tentar criar uma transaÃ§Ã£o com dados invÃ¡lidos (25 ms)
    âˆš deve LISTAR as transaÃ§Ãµes do usuÃ¡rio logado (30 ms)
    âˆš deve OBTER uma transaÃ§Ã£o especÃ­fica pelo ID (31 ms)
    âˆš deve ATUALIZAR uma transaÃ§Ã£o existente (47 ms)
    âˆš deve EXCLUIR uma transaÃ§Ã£o existente (73 ms)

[LOG] AÃ§Ã£o: DELETE_TRANSACTION | UsuÃ¡rio: 69165b7b17e19f4ee707e862
[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 69165b7b17e19f4ee707e862
POST /api/transactions 201 48.222 ms - 446
POST /api/transactions/69165b7d17e19f4ee707e8b9/upload 404 1.204 ms - 188
[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 69165b7b17e19f4ee707e862
[LOG] AÃ§Ã£o: DELETE_TRANSACTION | UsuÃ¡rio: 69165b7b17e19f4ee707e862
DELETE /api/transactions/69165b7d17e19f4ee707e8b9 200 43.628 ms - 73
[LOG] AÃ§Ã£o: DELETE_TRANSACTION | UsuÃ¡rio: 69165b7b17e19f4ee707e862
[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 69165b7b17e19f4ee707e862
POST /api/transactions 201 43.264 ms - 444
POST /api/transactions/69165b7d17e19f4ee707e8c6/upload 404 0.544 ms - 188
[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 69165b7b17e19f4ee707e862
[LOG] AÃ§Ã£o: DELETE_TRANSACTION | UsuÃ¡rio: 69165b7b17e19f4ee707e862
DELETE /api/transactions/69165b7d17e19f4ee707e8c6 200 42.541 ms - 73
[LOG] AÃ§Ã£o: DELETE_TRANSACTION | UsuÃ¡rio: 69165b7b17e19f4ee707e862
[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 69165b7b17e19f4ee707e862
POST /api/transactions 201 44.998 ms - 444
POST /api/transactions/69165b7d17e19f4ee707e8d3/upload 404 0.837 ms - 188
[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 69165b7b17e19f4ee707e862
[LOG] AÃ§Ã£o: DELETE_TRANSACTION | UsuÃ¡rio: 69165b7b17e19f4ee707e862
DELETE /api/transactions/69165b7d17e19f4ee707e8d3 200 50.087 ms - 73
[LOG] AÃ§Ã£o: DELETE_TRANSACTION | UsuÃ¡rio: 69165b7b17e19f4ee707e862
[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 69165b7b17e19f4ee707e862
POST /api/transactions 201 43.934 ms - 445
POST /api/transactions/69165b7e17e19f4ee707e8e0/upload 404 0.636 ms - 188
[LOG] AÃ§Ã£o: CREATE_TRANSACTION | UsuÃ¡rio: 69165b7b17e19f4ee707e862
[LOG] AÃ§Ã£o: DELETE_TRANSACTION | UsuÃ¡rio: 69165b7b17e19f4ee707e862
DELETE /api/transactions/69165b7e17e19f4ee707e8e0 200 43.694 ms - 73
POST /api/transactions/60d5f1f77c3d4a001f5e8e1z/upload 404 0.822 ms - 188
FAIL Testes/2-features/uploads.test.js
  Feature: Uploads
    Upload de PDF
      Ã— Deve permitir o upload de um anexo (PDF) para uma transaÃ§Ã£o (15 ms)
      Ã— Deve permitir a exclusÃ£o de um anexo (PDF) de uma transaÃ§Ã£o (1 ms)
    Upload de Imagem (PNG)
      Ã— Deve permitir o upload de um anexo de imagem (.png) para uma transaÃ§Ã£o (3 ms)
      Ã— Deve permitir a exclusÃ£o de um anexo de imagem (.png) (1 ms)
    Upload de Imagem (JPG)
      Ã— Deve permitir o upload de um anexo de imagem (.jpg) para uma transaÃ§Ã£o (5 ms)
      Ã— Deve permitir a exclusÃ£o de um anexo de imagem (.jpg)
    Upload de Imagem (JPEG)
      Ã— Deve permitir o upload de um anexo de imagem (.jpeg) para uma transaÃ§Ã£o (3 ms)
      Ã— Deve permitir a exclusÃ£o de um anexo de imagem (.jpeg) (1 ms)
    CenÃ¡rios de Erro e Estruturais
      âˆš Deve retornar 404 ao tentar fazer upload para uma transaÃ§Ã£o inexistente (6 ms)

  â— Feature: Uploads â€º Upload de PDF â€º Deve permitir o upload de um anexo (PDF) para uma transaÃ§Ã£o

    AxiosError: Request failed with status code 404

      70 |             form.append('attachment', fs.createReadStream(filePath));
      71 |
    > 72 |             const response = await axios.post(
         |                              ^
      73 |                 `${apiUrl}/transactions/${transactionId}/upload`,
      74 |                 form,
      75 |                 { headers: { ...form.getHeaders(), Authorization: `Bearer ${companyA.token}` } }

      at settle (node_modules/axios/lib/core/settle.js:19:12)
      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:793:11)
      at Axios.request (node_modules/axios/lib/core/Axios.js:45:41)
      at Object.<anonymous> (Testes/2-features/uploads.test.js:72:30)

  â— Feature: Uploads â€º Upload de PDF â€º Deve permitir a exclusÃ£o de um anexo (PDF) de uma transaÃ§Ã£o

    expect(received).toBeDefined()

    Received: undefined

      87 |
      88 |         it('Deve permitir a exclusÃ£o de um anexo (PDF) de uma transaÃ§Ã£o', async () => {
    > 89 |             expect(attachmentPath).toBeDefined();
         |                                    ^
      90 |
      91 |             const response = await axios.delete(
      92 |                 `${apiUrl}/transactions/${transactionId}/upload`,

      at Object.toBeDefined (Testes/2-features/uploads.test.js:89:36)

  â— Feature: Uploads â€º Upload de Imagem (PNG) â€º Deve permitir o upload de um anexo de imagem (.png) para uma transaÃ§Ã£o

    AxiosError: Request failed with status code 404

      144 |             form.append('attachment', fs.createReadStream(filePath));
      145 |
    > 146 |             const response = await axios.post(
          |                              ^
      147 |                 `${apiUrl}/transactions/${transactionId}/upload`,
      148 |                 form,
      149 |                 { headers: { ...form.getHeaders(), Authorization: `Bearer ${companyA.token}` } }

      at settle (node_modules/axios/lib/core/settle.js:19:12)
      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:793:11)
      at Axios.request (node_modules/axios/lib/core/Axios.js:45:41)
      at Object.<anonymous> (Testes/2-features/uploads.test.js:146:30)

  â— Feature: Uploads â€º Upload de Imagem (PNG) â€º Deve permitir a exclusÃ£o de um anexo de imagem (.png)

    expect(received).toBeDefined()

    Received: undefined

      160 |
      161 |         it(`Deve permitir a exclusÃ£o de um anexo de imagem (.${extension})`, async () => {
    > 162 |             expect(attachmentPath).toBeDefined();
          |                                    ^
      163 |             const response = await axios.delete(
      164 |                 `${apiUrl}/transactions/${transactionId}/upload`,
      165 |                 { headers: { Authorization: `Bearer ${companyA.token}` } }

      at Object.toBeDefined (Testes/2-features/uploads.test.js:162:36)

  â— Feature: Uploads â€º Upload de Imagem (JPG) â€º Deve permitir o upload de um anexo de imagem (.jpg) para uma transaÃ§Ã£o

    AxiosError: Request failed with status code 404

      144 |             form.append('attachment', fs.createReadStream(filePath));
      145 |
    > 146 |             const response = await axios.post(
          |                              ^
      147 |                 `${apiUrl}/transactions/${transactionId}/upload`,
      148 |                 form,
      149 |                 { headers: { ...form.getHeaders(), Authorization: `Bearer ${companyA.token}` } }

      at settle (node_modules/axios/lib/core/settle.js:19:12)
      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:793:11)
      at Axios.request (node_modules/axios/lib/core/Axios.js:45:41)
      at Object.<anonymous> (Testes/2-features/uploads.test.js:146:30)

  â— Feature: Uploads â€º Upload de Imagem (JPG) â€º Deve permitir a exclusÃ£o de um anexo de imagem (.jpg)

    expect(received).toBeDefined()

    Received: undefined

      160 |
      161 |         it(`Deve permitir a exclusÃ£o de um anexo de imagem (.${extension})`, async () => {
    > 162 |             expect(attachmentPath).toBeDefined();
          |                                    ^
      163 |             const response = await axios.delete(
      164 |                 `${apiUrl}/transactions/${transactionId}/upload`,
      165 |                 { headers: { Authorization: `Bearer ${companyA.token}` } }

      at Object.toBeDefined (Testes/2-features/uploads.test.js:162:36)

  â— Feature: Uploads â€º Upload de Imagem (JPEG) â€º Deve permitir o upload de um anexo de imagem (.jpeg) para uma transaÃ§Ã£o

    AxiosError: Request failed with status code 404

      144 |             form.append('attachment', fs.createReadStream(filePath));
      145 |
    > 146 |             const response = await axios.post(
          |                              ^
      147 |                 `${apiUrl}/transactions/${transactionId}/upload`,
      148 |                 form,
      149 |                 { headers: { ...form.getHeaders(), Authorization: `Bearer ${companyA.token}` } }

      at settle (node_modules/axios/lib/core/settle.js:19:12)
      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:793:11)
      at Axios.request (node_modules/axios/lib/core/Axios.js:45:41)
      at Object.<anonymous> (Testes/2-features/uploads.test.js:146:30)

  â— Feature: Uploads â€º Upload de Imagem (JPEG) â€º Deve permitir a exclusÃ£o de um anexo de imagem (.jpeg)

    expect(received).toBeDefined()

    Received: undefined

      160 |
      161 |         it(`Deve permitir a exclusÃ£o de um anexo de imagem (.${extension})`, async () => {
    > 162 |             expect(attachmentPath).toBeDefined();
          |                                    ^
      163 |             const response = await axios.delete(
      164 |                 `${apiUrl}/transactions/${transactionId}/upload`,
      165 |                 { headers: { Authorization: `Bearer ${companyA.token}` } }

      at Object.toBeDefined (Testes/2-features/uploads.test.js:162:36)

Test Suites: 1 failed, 3 passed, 4 total
Tests:       8 failed, 15 passed, 23 total
Snapshots:   0 total
Time:        2.324 s
Ran all test suites matching Testes/2-features/.

--- ðŸ§¹ [GLOBAL TEARDOWN] Finalizando ambiente de teste ---
[LOG] AÃ§Ã£o: DELETE_TRANSACTION | UsuÃ¡rio: 69165b7b17e19f4ee707e862
   - [OK] Dados de teste temporÃ¡rios foram removidos.
âœ… Servidor e conexÃ£o com MongoDB encerrados (stopServer).
--- âœ… [GLOBAL TEARDOWN] Ambiente finalizado com sucesso ---

--- FIM DOS TESTES AUTOMATIZADOS (Status: Falha) ---
